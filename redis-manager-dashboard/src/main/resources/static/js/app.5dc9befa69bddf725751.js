webpackJsonp([1],{"/uQB":function(e,t){},"36zs":function(e,t){},"4/hK":function(e,t){},"4RNS":function(e,t){},"6FzU":function(e,t){},"7xIN":function(e,t){},"9sqw":function(e,t){},As7w:function(e,t){},C6nx:function(e,t){},I1Y8:function(e,t){},IAAo:function(e,t){},JwGp:function(e,t){},Kuh7:function(e,t){},Lgoy:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("pFYg"),s=a.n(r),n=a("8U58");a("4/hK");var i={props:{value:{type:String,default:""},options:{type:Object,default:function(){return{mode:"text/javascript",lineNumbers:!0,lineWrapping:!0}}}},data:function(){return{skipNextChangeEvent:!1}},ready:function(){var e=this;this.editor=n.fromTextArea(this.$el.querySelector("textarea"),this.options),this.editor.setValue(this.value),this.editor.on("change",function(t){e.skipNextChangeEvent?e.skipNextChangeEvent=!1:(e.value=t.getValue(),e.$emit&&e.$emit("change",t.getValue()))})},mounted:function(){var e=this;this.editor=n.fromTextArea(this.$el.querySelector("textarea"),this.options),this.editor.setValue(this.value),this.editor.on("change",function(t){e.skipNextChangeEvent?e.skipNextChangeEvent=!1:e.$emit&&(e.$emit("change",t.getValue()),e.$emit("input",t.getValue()))})},watch:{value:function(e,t){if(e!==this.editor.getValue()){this.skipNextChangeEvent=!0;var a=this.editor.getScrollInfo();this.editor.setValue(e),this.editor.scrollTo(a.left,a.top)}},options:function(e,t){if("object"===(void 0===e?"undefined":s()(e)))for(var a in e)e.hasOwnProperty(a)&&this.editor.setOption(a,e[a])}},beforeDestroy:function(){this.editor&&this.editor.toTextArea()}},l=a("VU/8")(i,{render:function(){return this.$createElement,this._self._c,this._m(0)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"vue-codemirror-wrap"},[t("textarea")])}]},!1,function(e){a("NAmH")},null,null);t.default=l.exports},LnKd:function(e,t){},LnUS:function(e,t){},MQwG:function(e,t){},NAmH:function(e,t){},NHnr:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("7+uW"),s=a("NYxO"),n=a("424j"),i=a("mtWM"),l=a.n(i);function o(e){return null==e||"undefined"===e||""===e||"null"===e}function u(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}function c(e){return/^1[3|4|5|7|8][0-9]{9}$/.test(e)}function d(e){return/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\:([0-9]|[1-9]\d|[1-9]\d{2}|[1-9]\d{3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$/.test(e)}var p=a("zL8q"),m=a.n(p);function f(e,t){var a={showClose:!0,message:e,offset:60};o(t)||(a.type=t),"success"===t?p.Message.success(a):"warning"===t?p.Message.warning(a):"error"===t?p.Message.error(a):p.Message.info(a)}var v={info:function(e){return f(e,null)},success:function(e){return f(e,"success")},warning:function(e){return f(e,"warning")},error:function(e){return f(e,"error")}},h=a("/ocq"),g={data:function(){return{user:{},authorization:{},rules:{userName:[{required:!0,message:"Please enter user name",trigger:"blur"}],password:[{required:!0,message:"Please enter password",trigger:"blur"}]}}},methods:{getAuthorization:function(){var e=this;vt.get("/system/getAuthorization",null,function(t){var a=t.data.data;a.server+=a.server.endsWith("/")?"":"/",e.authorization=a},function(e){v.error("Get authorization failed")})},signIn:function(e){var t=this;this.$refs[e].validate(function(e){e&&vt.post("/user/login",t.user,function(e){var a=e.data;0==a.code?(yt.dispatch("setUser",a.data),t.$router.push({name:"index"})):v.error("User name or password wrong")},function(e){v.error(e)})})}},mounted:function(){this.getAuthorization(),yt.dispatch("setUser",{userRole:2}),yt.dispatch("setCurrentGroup",{}),yt.dispatch("setGroupList",[])}},b={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",{staticStyle:{"background-image":"linear-gradient(0deg,#1ac5fa,#2ba3de 51%,#1d71f2)"}},[r("img",{staticStyle:{position:"absolute","z-index":"0",left:"0",top:"32%",width:"100%",opacity:"0.1"},attrs:{src:a("cf+J")}}),e._v(" "),r("div",{staticClass:"login-wrapper"},[r("el-card",{staticClass:"content-wrapper",attrs:{shadow:"hover"}},[r("div",{attrs:{slot:"header"},slot:"header"},[r("b",[e._v("Sign In")])]),e._v(" "),r("div",[r("el-form",{ref:"user",attrs:{model:e.user,rules:e.rules}},[r("el-form-item",{attrs:{prop:"userName"}},[r("el-input",{attrs:{"prefix-icon":"el-icon-user",placeholder:"User Name"},model:{value:e.user.userName,callback:function(t){e.$set(e.user,"userName","string"==typeof t?t.trim():t)},expression:"user.userName"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"password"}},[r("el-input",{attrs:{"prefix-icon":"el-icon-key",type:"password",placeholder:"Password","show-password":""},model:{value:e.user.password,callback:function(t){e.$set(e.user,"password","string"==typeof t?t.trim():t)},expression:"user.password"}})],1),e._v(" "),r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:function(t){return e.signIn("user")}}},[e._v("Sign In")])],1),e._v(" "),e.authorization.enabled?r("el-form-item",[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"success"}},[r("el-link",{staticStyle:{color:"#fff"},attrs:{href:e.authorization.server+e.authorization.siteKey,underline:!1}},[e._v(e._s(e.authorization.companyName)+" Sign In")])],1)],1):e._e()],1)],1),e._v(" "),r("div",{staticClass:"link-wrapper"},[r("span",[r("span",[e._v("More about")]),e._v(" "),r("el-link",{staticClass:"doc-link",attrs:{type:"primary",target:"_blank",href:"https://github.com/ngbdf/redis-manager/",underline:!1}},[e._v("Redis Manager")])],1)])])],1)])},staticRenderFns:[]},_=a("VU/8")(g,b,!1,function(e){a("V7r3")},"data-v-cfca07b0",null).exports;function y(e){var t=new Date(e),a=t.getFullYear(),r=t.getMonth()+1,s=t.getDate(),n=t.getHours(),i=t.getMinutes(),l=t.getSeconds();return a+"-"+C(r)+"-"+C(s)+" "+C(n)+":"+C(i)+":"+C(l)}function C(e){return e<10?"0"+e:e}function w(e,t){var a=yt.getters.getCurrentGroup.groupId;if(o(a))mt.push({name:"404"});else{var r="/cluster/getCluster/"+a+"/"+e;vt.get(r,null,function(e){var a=e.data;0===a.code?t(a.data):(mt.push({name:"404"}),v.error("Get clsuter failed"))},function(e){v.error(e)})}}var k={props:{clusterId:{type:Number}},data:function(){var e=this;return{cluster:{nodeList:[{value:""}]},rules:{clusterName:[{required:!0,validator:function(t,a,r){if(o(a)||o(a.trim()))return r(new Error("Please enter cluster name"));var s="/cluster/validateClusterName/"+a;vt.get(s,null,function(t){var s=t.data;if(0!=s.code){var n=s.data;return e.clusterId==n.clusterId&&a==n.clusterName&&r(),r(new Error(a+" has exist"))}r()},function(e){return r(new Error("Network error, "+e))})},trigger:"blur"}],redisNode:[{required:!0,validator:function(e,t,a){return o(t)||o(t.trim())?a(new Error("Please enter redis node")):d(t)?void a():a(new Error("Incorrect format"))},trigger:"blur"},{required:!0,validator:function(t,a,r){var s={redisPassword:e.cluster.redisPassword},n=a.split(":"),i={host:n[0],port:n[1]};s.redisNode=i,vt.post("/validate/redisNode",s,function(e){if(0!=e.data.code)return r(new Error("Connection refused."));r()},function(e){return r(new Error("Network error, "+e))})},trigger:"blur"}],installationEnvironment:[{required:!0,validator:function(e,t,a){if(o(t))return a(new Error("Please select environment"));a()},trigger:"change"}]},saveClusterLoading:!1}},methods:{saveCluster:function(e){var t=this;this.$refs[e].validate(function(a){if(a){var r=t.currentGroup;if(o(r)||o(r.groupId))return;t.cluster.groupId=r.groupId,t.cluster.userId=yt.getters.getUserId;var s="";t.cluster.nodeList.forEach(function(e){s+=e.value+","}),t.cluster.nodes=s;var n;n=o(t.clusterId)?"/cluster/importCluster":"/cluster/updateCluster",t.saveClusterLoading=!0,vt.post(n,t.cluster,function(a){0==a.data.code?(t.$refs[e].resetFields(),t.$router.push({name:"dashboard",params:{groupId:r.groupId}}),t.$emit("closeDialog",!1)):console.error("Save cluster failed"),t.saveClusterLoading=!1},function(e){t.saveClusterLoading=!1,console.error(e)})}})},removeNode:function(e){if(!(this.cluster.nodeList.length<=1)){var t=this.cluster.nodeList.indexOf(e);-1!==t&&this.cluster.nodeList.splice(t,1)}},addNode:function(){this.cluster.nodeList.length>=20||this.cluster.nodeList.push({value:"",key:Date.now()})},nodesToNodeList:function(e){var t=[];return e.split(",").forEach(function(e){o(e)||t.push({value:e})}),t}},computed:{currentGroup:function(){return yt.getters.getCurrentGroup},installationEnvironmentList:function(){return yt.getters.getInstallationEnvironmentList}},mounted:function(){var e=this;o(this.clusterId)?this.cluster={nodeList:[{value:""}]}:w(this.clusterId,function(t){var a=e.nodesToNodeList(t.nodes);t.nodeList=a,e.cluster=t})}},I=a("VU/8")(k,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.saveClusterLoading,expression:"saveClusterLoading"}]},[a("el-form",{ref:"cluster",attrs:{model:e.cluster,rules:e.rules,"label-width":"130px",size:"small"}},[a("el-form-item",{attrs:{label:"Group Name"}},[a("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.currentGroup.groupName))])],1),e._v(" "),a("el-form-item",{attrs:{label:"Cluster Name",prop:"clusterName"}},[a("el-input",{attrs:{maxlength:"30","show-word-limit":"",autocomplete:"off"},model:{value:e.cluster.clusterName,callback:function(t){e.$set(e.cluster,"clusterName",t)},expression:"cluster.clusterName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Redis Password",prop:"redisPassword"}},[a("el-input",{attrs:{maxlength:"255","show-password":"",autocomplete:"off"},model:{value:e.cluster.redisPassword,callback:function(t){e.$set(e.cluster,"redisPassword","string"==typeof t?t.trim():t)},expression:"cluster.redisPassword"}})],1),e._v(" "),e._l(e.cluster.nodeList,function(t,r){return a("el-form-item",{key:t.key,attrs:{label:"Redis Node "+(r+1),prop:"nodeList."+r+".value",rules:e.rules.redisNode}},[a("el-input",{model:{value:t.value,callback:function(a){e.$set(t,"value","string"==typeof a?a.trim():a)},expression:"node.value"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-delete"},on:{click:function(a){return a.preventDefault(),e.removeNode(t)}},slot:"append"})],1)],1)}),e._v(" "),a("el-form-item",{attrs:{label:"Environment",prop:"installationEnvironment"}},[a("el-radio-group",{model:{value:e.cluster.installationEnvironment,callback:function(t){e.$set(e.cluster,"installationEnvironment",t)},expression:"cluster.installationEnvironment"}},e._l(e.installationEnvironmentList,function(t){return a("el-radio",{key:t.type,attrs:{label:t.type}},[e._v(e._s(t.name))])}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"Cluster Info",prop:"clusterInfo"}},[a("el-input",{model:{value:e.cluster.clusterInfo,callback:function(t){e.$set(e.cluster,"clusterInfo",t)},expression:"cluster.clusterInfo"}})],1)],2),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){return e.addNode()}}},[e._v("New Node")]),e._v(" "),null==e.clusterId||""==e.clusterId?a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveCluster("cluster")}}},[e._v("Confirm")]):a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveCluster("cluster")}}},[e._v("Update")])],1)],1)},staticRenderFns:[]},!1,function(e){a("lPf+")},"data-v-55496dbc",null).exports;a("uk2G");var x={components:{editCluster:I},data:function(){return{isCollapse:!1,active:!0,permission:!0,importVisible:!1,selectGroupId:""}},methods:{signOut:function(){var e=this;vt.post("/user/signOut",null,function(t){e.$router.push({name:"login"})},function(e){v.error(e)})},toDashboard:function(){this.$router.push({name:"dashboard",params:{groupId:this.selectGroupId}})},toInstallation:function(){this.$router.push({name:"installation",params:{groupId:this.selectGroupId}})},toChannelManage:function(){this.$router.push({name:"channel-manage",params:{groupId:this.selectGroupId}})},toJobList:function(){this.$router.push({name:"jobList",params:{groupId:this.selectGroupId}})},toRct:function(){this.$router.push({name:"Config"})},toTaskProgress:function(){this.$router.push({name:"TaskProgress"})},toRuleManage:function(){this.$router.push({name:"rule-manage",params:{groupId:this.selectGroupId}})},toMachineManage:function(){this.$router.push({name:"machine-manage",params:{groupId:this.selectGroupId}})},toGroupManage:function(){this.$router.push({name:"group-manage"})},toEditHistory:function(){this.$router.push({name:"edit-history",params:{groupId:this.selectGroupId}})},toUserManage:function(){this.$router.push({name:"user-manage",params:{groupId:this.selectGroupId}})},selectGroup:function(){var e=this;if(o(this.selectGroupId))v.error("Select group failed");else{this.groupList.forEach(function(t){e.selectGroupId===t.groupId&&e.getUserRole(t)});var t=this.$route.path;("/"===t||t.indexOf("redis-monitor")>0||t.indexOf("group-manage")>0)&&this.toDashboard()}},getUserRole:function(e){var t={userId:this.currentUser.userId,groupId:e.groupId};vt.post("/user/getUserRole",t,function(t){var a=t.data;0==a.code&&(yt.dispatch("setUserRole",a.data),yt.dispatch("setCurrentGroup",e))},function(e){v.error(e)})},handleCommand:function(e){"profile"==e&&this.toUserProfile()},toUserProfile:function(){this.$router.push({name:"profile",params:{userId:this.currentUser.userId}})},toDataOperation:function(){this.$router.push({name:"data-operation",params:{groupId:this.selectGroupId}})},handleOpen:function(e,t){},handleClose:function(e,t){},errorHandler:function(){return!0},collapseHandler:function(){this.isCollapse=!this.isCollapse},getGroupList:function(){var e=this,t=yt.getters.getUser;vt.post("/group/getGroupList",t,function(t){if(0==t.data.code){var a=t.data.data;a.forEach(function(e){e.time=y(e.updateTime)}),yt.dispatch("setGroupList",a);var r=e.currentGroup,s=yt.getters.getUser;(o(r)||o(r.groupId))&&a.forEach(function(t){t.groupId==s.groupId&&(e.selectGroupId=s.groupId,yt.dispatch("setCurrentGroup",t),e.getUserRole(t))})}else v.error("Get group list failed")},function(e){v.error(e)})},closeDialog:function(e){var t=this;this.active=!1,this.$nextTick(function(){return t.active=!0}),this.importVisible=e},getUserFromSession:function(){var e=this;vt.get("/user/getUserFromSession",null,function(t){var a=t.data;0==a.code?yt.dispatch("setUser",a.data):e.signOut()},function(e){v.error("Auto get user failed.")})}},computed:{currentUser:function(){return yt.getters.getUser},currentGroup:function(){return yt.getters.getCurrentGroup},groupList:function(){return yt.getters.getGroupList}},mounted:function(){this.getUserFromSession(),this.getGroupList();var e;e=o(this.currentGroup)||o(this.currentGroup.groupId)?this.currentUser.groupId:this.currentGroup.groupId,this.selectGroupId=e,"/"==this.$route.path&&this.toDashboard()},created:function(){var e,t,a,r,s,n;e=function(e){yt.dispatch("setUserIp",e)},t=new(window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection)({iceServers:[]}),a=function(){},r={},s=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/g,n=function(t){r[t]||e(t),r[t]=!0},t.createDataChannel(""),t.createOffer().then(function(e){e.sdp.split("\n").forEach(function(e){e.indexOf("candidate")<0||e.match(s).forEach(n)}),t.setLocalDescription(e,a,a)}).catch(function(e){}),t.onicecandidate=function(e){e&&e.candidate&&e.candidate.candidate&&e.candidate.candidate.match(s)&&e.candidate.candidate.match(s).forEach(n)}}},L={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",{attrs:{id:"index"}},[r("el-header",{staticClass:"header header-wrapper"},[r("div",{staticClass:"grid-content logo-wrapper"},[r("i",{staticClass:"el-icon-s-fold aside-operation",on:{click:e.collapseHandler}}),e._v(" "),r("img",{staticStyle:{width:"150px",height:"15px"},attrs:{src:a("nhBv")}})]),e._v(" "),r("div",{staticClass:"grid-content right-content",attrs:{id:"right-content"}},[r("el-select",{staticClass:"group-select",attrs:{placeholder:"Select Group",size:"mini"},on:{change:function(t){return e.selectGroup()}},model:{value:e.selectGroupId,callback:function(t){e.selectGroupId=t},expression:"selectGroupId"}},e._l(e.groupList,function(e){return r("el-option",{key:e.groupId,attrs:{label:e.groupName,value:e.groupId}})}),1),e._v(" "),e.permission?r("div",[r("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.importVisible=!0}}},[e._v("Import Cluster")])],1):e._e(),e._v(" "),r("div",{staticClass:"links",attrs:{id:"links"}},[r("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),r("el-link",{attrs:{underline:!1,href:"https://github.com/ngbdf/redis-manager/",target:"_blank"}},[r("i",{staticClass:"el-icon-ali-git link-icon",attrs:{title:"Github"}})]),e._v(" "),r("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),r("el-link",{attrs:{underline:!1,href:"https://github.com/ngbdf/redis-manager/wiki",target:"_blank"}},[r("i",{staticClass:"el-icon-tickets link-icon",attrs:{title:"Document"}})]),e._v(" "),r("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),r("el-link",{attrs:{underline:!1,href:"https://github.com/ngbdf/redis-manager/issues/new",target:"_blank"}},[r("i",{staticClass:"el-icon-ali-feedback link-icon",attrs:{title:"Feedback"}})])],1),e._v(" "),r("div",{staticClass:"user-info"},[r("el-dropdown",{staticClass:"user-dropdown",on:{command:e.handleCommand}},[r("el-image",{attrs:{src:e.currentUser.avatar,fit:"cover"},on:{error:e.errorHandler}},[e._v(e._s(e.currentUser.userName))]),e._v(" "),r("el-dropdown-menu",{staticStyle:{"min-width":"180px"},attrs:{slot:"dropdown"},slot:"dropdown"},[r("el-dropdown-item",{attrs:{disabled:""}},[e._v("\n              Signed in as\n              "),r("b",[e._v(e._s(e.currentUser.userName))])]),e._v(" "),r("el-dropdown-item",{attrs:{command:"profile",divided:""}},[e._v("Profile")]),e._v(" "),r("el-dropdown-item",{attrs:{divided:""},nativeOn:{click:function(t){return e.signOut(t)}}},[e._v("Sign out")])],1)],1)],1)],1)]),e._v(" "),r("el-container",{staticClass:"aside-main-wrapper"},[r("el-aside",{class:{"is-collapse":e.isCollapse},staticStyle:{width:"200px"}},[r("el-row",[r("el-col",{attrs:{span:24}},[r("el-menu",{attrs:{"default-active":"1",collapse:e.isCollapse,"collapse-transition":!1,"background-color":"#2a3542","text-color":"#909399","active-text-color":"#fff"},on:{open:e.handleOpen,close:e.handleClose}},[r("el-menu-item",{attrs:{index:"1"},on:{click:function(t){return e.toDashboard()}}},[r("i",{staticClass:"el-icon-discover"}),e._v(" "),r("span",{attrs:{slot:"title"},slot:"title"},[e._v("Dashboard")])]),e._v(" "),e.currentUser.userRole<2?r("el-submenu",{attrs:{index:"2"}},[r("template",{slot:"title"},[r("i",{staticClass:"el-icon-bell"}),e._v(" "),r("span",[e._v("Alert Manage")])]),e._v(" "),r("el-menu-item-group",[r("el-menu-item",{attrs:{index:"2-1"},on:{click:function(t){return e.toChannelManage()}}},[e._v("Channel Manage")]),e._v(" "),r("el-menu-item",{attrs:{index:"2-2"},on:{click:function(t){return e.toRuleManage()}}},[e._v("Rule Manage")])],1)],2):e._e(),e._v(" "),e.currentUser.userRole<2?r("el-submenu",{attrs:{index:"3"}},[r("template",{slot:"title"},[r("i",{staticClass:"el-icon-setting"}),e._v(" "),r("span",{attrs:{slot:"title"},slot:"title"},[e._v("Installation")])]),e._v(" "),r("el-menu-item-group",[r("el-menu-item",{attrs:{index:"3-1"},on:{click:function(t){return e.toInstallation()}}},[e._v("Installation")]),e._v(" "),r("el-menu-item",{attrs:{index:"3-2"},on:{click:function(t){return e.toMachineManage()}}},[e._v("Machine Manage")])],1)],2):e._e(),e._v(" "),e.currentUser.userRole<2?r("el-submenu",{attrs:{index:"4"}},[r("template",{slot:"title"},[r("i",{staticClass:"el-icon-cpu"}),e._v(" "),r("span",[e._v("RCT")])]),e._v(" "),r("el-menu-item-group",[r("el-menu-item",{attrs:{index:"4-1"},on:{click:function(t){return e.toRct()}}},[e._v("Config")])],1),e._v(" "),r("el-menu-item-group",[r("el-menu-item",{attrs:{index:"4-2"},on:{click:function(t){return e.toJobList()}}},[e._v("Job List")])],1)],2):e._e(),e._v(" "),r("el-submenu",{attrs:{index:"5"}},[r("template",{slot:"title"},[r("i",{staticClass:"el-icon-takeaway-box"}),e._v(" "),r("span",[e._v("Tools")])]),e._v(" "),r("el-menu-item-group",[e.currentUser.userRole<2?r("el-menu-item",{attrs:{index:"5-1"},on:{click:function(t){return e.toDataOperation()}}},[e._v("Data Operation")]):e._e()],1)],2),e._v(" "),e.currentUser.userRole<1?r("el-menu-item",{attrs:{index:"6"},on:{click:function(t){return e.toGroupManage()}}},[r("i",{staticClass:"el-icon-user-solid"}),e._v(" "),r("span",{attrs:{slot:"title"},slot:"title"},[e._v("Group Manage")])]):e._e(),e._v(" "),e.currentUser.userRole<2?r("el-menu-item",{attrs:{index:"7"},on:{click:function(t){return e.toUserManage()}}},[r("i",{staticClass:"el-icon-user"}),e._v(" "),r("span",{attrs:{slot:"title"},slot:"title"},[e._v("User Manage")])]):e._e(),e._v(" "),e.currentUser.userRole<2?r("el-menu-item",{attrs:{index:"8"},on:{click:function(t){return e.toEditHistory()}}},[r("i",{staticClass:"el-icon-edit"}),e._v(" "),r("span",{attrs:{slot:"title"},slot:"title"},[e._v("Edit History")])]):e._e()],1)],1)],1)],1),e._v(" "),r("el-main",{staticClass:"main",class:{"main-margin":e.isCollapse},staticStyle:{"margin-left":"200px"}},[r("transition",{attrs:{name:"fade",mode:"out-in"}},[e.active?r("router-view"):e._e()],1)],1)],1),e._v(" "),e.importVisible?r("el-dialog",{attrs:{title:"Import Cluster",visible:e.importVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.importVisible=t}}},[r("editCluster",{on:{closeDialog:e.closeDialog}})],1):e._e()],1)},staticRenderFns:[]},N=a("VU/8")(x,L,!1,function(e){a("6FzU")},null,null).exports,S=a("mvHQ"),R=a.n(S),P=a("gZhU");a("8U58"),a("4/hK"),a("5IAE"),a("jQeI"),a("PsxY"),a("Mixr"),a("gSgD");var M={components:{codemirror:P.codemirror},props:{cluster:{}},data:function(){return{dbList:[],autoCommandParam:{clusterId:this.cluster.clusterId,count:100},result:"",codemirrorOptions:{mode:"application/json",readOnly:!0,autoRefresh:!0,scrollbarStyle:"null",theme:"xq-light",lineNumbers:!0},queryLoading:!1}},methods:{getDBList:function(e){var t=this,a="/data/getDBList/"+e;vt.get(a,null,function(e){var a=e.data;0==a.code?a.data.forEach(function(e){var a=e.database;t.dbList.push({keys:e.keys,database:a.slice(2)})}):v.error(a.message)},function(e){v.error(e)})},queryRedis:function(e){var t=this;this.result="","cluster"==this.cluster.redisMode&&(e.database=0),o(e.database)?v.warning("Please select database"):o(e.key)?v.warning("Please enter redis key"):(this.queryLoading=!0,vt.post("/data/query",e,function(e){var a=e.data;if(0==a.code){var r=a.data,s={};s.ttl=r.ttl,s.type=r.type,s.value=r.value,t.result=R()(s,null,2)}else v.error(a.message);t.queryLoading=!1},function(e){t.queryLoading=!1,v.error(e)}))},scanRedis:function(e){var t=this;this.result="","cluster"==this.cluster.redisMode&&(e.database=0),o(e.database)?v.warning("Please select database"):(this.queryLoading=!0,vt.post("/data/scan",e,function(e){var a=e.data;0==a.code?a.data.forEach(function(e){t.result+=e+"\n"}):v.error(a.message),t.queryLoading=!1},function(e){t.queryLoading=!1,v.error(e)}))}},mounted:function(){this.getDBList(this.cluster.clusterId),"cluster"==this.cluster.redisMode&&(this.autoCommandParam.database="db0")}},z=a("VU/8")(M,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.queryLoading,expression:"queryLoading"}],staticClass:"query-wrapper",attrs:{id:"query"}},[a("div",{staticClass:"input-wrapper"},[a("el-input",{staticClass:"input-with-select",attrs:{size:"small",placeholder:"Redis Key",clearable:""},model:{value:e.autoCommandParam.key,callback:function(t){e.$set(e.autoCommandParam,"key","string"==typeof t?t.trim():t)},expression:"autoCommandParam.key"}},[a("el-select",{staticStyle:{width:"50px"},attrs:{slot:"prepend",placeholder:"Select DB"},slot:"prepend",model:{value:e.autoCommandParam.database,callback:function(t){e.$set(e.autoCommandParam,"database",t)},expression:"autoCommandParam.database"}},e._l(e.dbList,function(t){return a("el-option",{key:t.database,attrs:{label:"db"+t.database,value:t.database}},[a("span",{staticStyle:{float:"left"}},[e._v("db"+e._s(t.database))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.keys))])])}),1)],1),e._v(" "),a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{size:"small",type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.queryRedis(e.autoCommandParam)}}},[e._v("Query")]),e._v(" "),a("el-button",{attrs:{size:"small",icon:"el-icon-search"},on:{click:function(t){return e.scanRedis(e.autoCommandParam)}}},[e._v("Scan")])],1),e._v(" "),a("codemirror",{staticClass:"result-wrapper",attrs:{options:e.codemirrorOptions},model:{value:e.result,callback:function(t){e.result=t},expression:"result"}})],1)},staticRenderFns:[]},!1,function(e){a("nLbs")},"data-v-b55808ce",null).exports,A={components:{query:z,editCluster:I},data:function(){return{overview:{userNumber:0,healthNumber:0,badNumber:0,alertNumber:0},clusterList:[],cluster:{},queryVisible:!1,editClusterId:"",editClusterVisible:!1,deleteClusterVisible:!1,clusterListLoading:!1}},methods:{toMonitor:function(e){this.$router.push({name:"redis-monitor",params:{clusterId:e}})},toManage:function(e){this.$router.push({name:"redis-manage",params:{clusterId:e}})},toAlertManage:function(e){this.$router.push({name:"alert-manage",params:{clusterId:e}})},handleQuery:function(e){this.cluster=e,this.queryVisible=!0},getOverview:function(e){var t=this,a="/group/overview/"+e;o(e)||vt.get(a,null,function(e){var a=e.data;if(0==a.code){var r=a.data;t.overview.alertNumber=r.alertNumber,t.overview.userNumber=r.userNumber}else v.error("Get group overview failed")},function(e){v.error(e)})},getClusterList:function(e){var t=this,a="/cluster/getClusterList/"+e;this.clusterListLoading=!0,o(e)||vt.get(a,null,function(e){var a=e.data;if(0==a.code){var r=a.data,s=0,n=0;r.forEach(function(e){"HEALTH"==e.clusterState?s++:n++}),t.overview.healthNumber=s,t.overview.badNumber=n,t.clusterList=r}else v.error("Get cluster list failed");t.clusterListLoading=!1},function(e){t.clusterListLoading=!1,v.error(e)})},editCluster:function(e){this.editClusterId=e,this.editClusterVisible=!0},showDeleteCluster:function(e){var t=this;this.clusterList.forEach(function(a){a.clusterId==e&&(t.cluster=a,t.deleteClusterVisible=!0)})},deleteCluster:function(e){var t=this,a={clusterId:e,groupId:this.currentGroupId};vt.post("/cluster/deleteCluster",a,function(e){0==e.data.code?(t.cluster={},t.getClusterList(t.currentGroupId),t.deleteClusterVisible=!1):v.error("Delete cluster failed")},function(e){v.error(e)})},closeEditClusterDialog:function(e){this.editClusterVisible=e,this.getClusterList(this.currentGroupId)}},computed:{currentGroupId:function(){return yt.getters.getCurrentGroup.groupId},currentUser:function(){return yt.getters.getUser}},watch:{currentGroupId:function(e){this.getClusterList(e),this.getOverview(e),this.$router.push({name:"dashboard",params:{groupId:e}})}},mounted:function(){var e=this.currentGroupId;this.getClusterList(e),this.getOverview(e),this.userRole=yt.getters.getUserRole}},E=a("VU/8")(A,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.clusterListLoading,expression:"clusterListLoading"}]},[a("el-row",{staticClass:"card-panel-group",attrs:{gutter:20}},[a("el-col",{attrs:{xl:6,lg:6,md:12,sm:12}},[a("div",{staticClass:"card-panel"},[a("div",{staticClass:"card-panel-icon-wrapper card-panel-icon-user"},[a("i",{staticClass:"el-icon-user"})]),e._v(" "),a("div",{staticClass:"card-panel-info-wrapper"},[a("div",{staticClass:"card-panel-info-key"},[e._v("User Number")]),e._v(" "),a("div",{staticClass:"card-panel-info-value"},[e._v(e._s(e.overview.userNumber))])])])]),e._v(" "),a("el-col",{attrs:{xl:6,lg:6,md:12,sm:12}},[a("div",{staticClass:"card-panel"},[a("div",{staticClass:"card-panel-icon-wrapper card-panel-icon-health"},[a("i",{staticClass:"el-icon-sunny"})]),e._v(" "),a("div",{staticClass:"card-panel-info-wrapper"},[a("div",{staticClass:"card-panel-info-key"},[e._v("Health Number")]),e._v(" "),a("div",{staticClass:"card-panel-info-value"},[e._v(e._s(e.overview.healthNumber))])])])]),e._v(" "),a("el-col",{attrs:{xl:6,lg:6,md:12,sm:12}},[a("div",{staticClass:"card-panel"},[a("div",{staticClass:"card-panel-icon-wrapper card-panel-icon-bad"},[a("i",{staticClass:"el-icon-heavy-rain"})]),e._v(" "),a("div",{staticClass:"card-panel-info-wrapper"},[a("div",{staticClass:"card-panel-info-key"},[e._v("Bad Number")]),e._v(" "),a("div",{staticClass:"card-panel-info-value"},[e._v(e._s(e.overview.badNumber))])])])]),e._v(" "),a("el-col",{attrs:{xl:6,lg:6,md:12,sm:12}},[a("div",{staticClass:"card-panel"},[a("div",{staticClass:"card-panel-icon-wrapper card-panel-icon-alert"},[a("i",{staticClass:"el-icon-bell"})]),e._v(" "),a("div",{staticClass:"card-panel-info-wrapper"},[a("div",{staticClass:"card-panel-info-key"},[e._v("Alert Number")]),e._v(" "),a("div",{staticClass:"card-panel-info-value"},[e._v(e._s(e.overview.alertNumber))])])])])],1),e._v(" "),a("el-row",{attrs:{gutter:20}},e._l(e.clusterList,function(t){return a("el-col",{key:t.clusterId,attrs:{xs:24,sm:12,md:12,lg:8,xl:6}},[a("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[a("div",{staticClass:"box-card-title",attrs:{slot:"header"},slot:"header"},[a("span",[e._v(e._s(t.clusterName))]),e._v(" "),null!=t.redisPassword&&""!=t.redisPassword?a("i",{staticClass:"el-icon-lock health",staticStyle:{float:"right",padding:"3px 0"}}):e._e()]),e._v(" "),a("div",[a("div",{staticClass:"text item"},[e._v("\n            State:\n            "),"HEALTH"==t.clusterState?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(t.clusterState))]):a("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v(e._s(t.clusterState))])],1),e._v(" "),a("div",{staticClass:"text item"},[e._v("\n            Model:\n            "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.redisMode))])],1),e._v(" "),a("div",{staticClass:"text item"},[e._v("\n            Version:\n            "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.redisVersion))])],1),e._v(" "),a("div",{staticClass:"text item"},[e._v("\n            Nodes:\n            "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.clusterKnownNodes))])],1),e._v(" "),"sentinel"!=t.redisMode?a("div",{staticClass:"text item"},[e._v("\n            Master:\n            "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.clusterSize))])],1):a("div",{staticClass:"text item"},[e._v("\n            Sentinel OK:\n            "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.sentinelOk))])],1),e._v(" "),"sentinel"!=t.redisMode?a("div",{staticClass:"text item"},[e._v("\n            Total Momery:\n            "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.totalUsedMemory)+"MB")])],1):a("div",{staticClass:"text item"},[e._v("\n            Sentinel Masters:\n            "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.sentinelMasters))])],1),e._v(" "),"cluster"==t.redisMode?a("div",{staticClass:"text item"},[e._v("\n            Slots Assigned(ok/assigned):\n            "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.clusterSlotsOk)+"/"+e._s(t.clusterSlotsAssigned))])],1):e._e(),e._v(" "),"standalone"==t.redisMode?a("div",{staticClass:"text item"},[e._v("\n            DB Size:\n            "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.dbSize))])],1):e._e(),e._v(" "),"sentinel"==t.redisMode?a("div",{staticClass:"text item"},[e._v("\n            Master OK:\n            "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.masterOk))])],1):e._e(),e._v(" "),a("div",{staticClass:"text item"},[e._v("\n            Environment:\n            "),0==t.installationEnvironment?a("el-tag",{attrs:{size:"mini"}},[e._v("Docker")]):1==t.installationEnvironment?a("el-tag",{attrs:{size:"mini"}},[e._v("Machine")]):3==t.installationEnvironment?a("el-tag",{attrs:{size:"mini"}},[e._v("Humpback")]):e._e()],1),e._v(" "),a("div",{staticClass:"text item"},[e._v("\n            From:\n            "),0==t.installationType?a("el-tag",{attrs:{size:"mini"}},[e._v("Redis Manager")]):a("el-tag",{attrs:{size:"mini"}},[e._v("Import")])],1)]),e._v(" "),a("div",{staticClass:"card-bottom"},[a("el-button",{attrs:{size:"mini",title:"Query",icon:"el-icon-search",circle:"",disabled:"sentinel"==t.redisMode},on:{click:function(a){return e.handleQuery(t)}}}),e._v(" "),a("el-button",{attrs:{size:"mini",title:"Monitor",type:"primary",icon:"el-icon-view",circle:""},on:{click:function(a){return e.toMonitor(t.clusterId)}}}),e._v(" "),e.currentUser.userRole<2?a("el-button",{attrs:{size:"mini",title:"Alert",type:"warning",icon:"el-icon-bell",circle:""},on:{click:function(a){return e.toAlertManage(t.clusterId)}}}):e._e(),e._v(" "),e.currentUser.userRole<2?a("el-button",{attrs:{size:"mini",title:"Manage",type:"danger",icon:"el-icon-setting",circle:""},on:{click:function(a){return e.toManage(t.clusterId)}}}):e._e(),e._v(" "),e.currentUser.userRole<2?a("el-dropdown",{staticClass:"more-operation",attrs:{trigger:"click"}},[a("el-button",{attrs:{size:"mini",title:"Edit or delete",type:"info",icon:"el-icon-more",circle:""}}),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{staticClass:"edit",attrs:{icon:"el-icon-edit-outline"},nativeOn:{click:function(a){return e.editCluster(t.clusterId)}}},[e._v("Edit")]),e._v(" "),a("el-dropdown-item",{staticClass:"delete",attrs:{icon:"el-icon-delete"},nativeOn:{click:function(a){return e.showDeleteCluster(t.clusterId)}}},[e._v("Delete")])],1)],1):e._e()],1)])],1)}),1),e._v(" "),e.queryVisible?a("el-dialog",{attrs:{title:"Query "+e.cluster.clusterName,visible:e.queryVisible,"close-on-click-modal":!1,width:"50%"},on:{"update:visible":function(t){e.queryVisible=t}}},[a("query",{attrs:{cluster:e.cluster}})],1):e._e(),e._v(" "),e.editClusterVisible?a("el-dialog",{attrs:{title:"Edit Cluster",visible:e.editClusterVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editClusterVisible=t}}},[a("editCluster",{attrs:{clusterId:e.editClusterId},on:{closeDialog:e.closeEditClusterDialog}})],1):e._e(),e._v(" "),a("el-dialog",{attrs:{title:"Delete Cluster",visible:e.deleteClusterVisible,width:"30%"},on:{"update:visible":function(t){e.deleteClusterVisible=t}}},[a("span",[e._v("\n      Are you sure to delete\n      "),a("b",[e._v(e._s(e.cluster.clusterName))]),e._v(" ?\n    ")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteCluster(e.cluster.clusterId)}}},[e._v("Delete")])],1)])],1)},staticRenderFns:[]},!1,function(e){a("bY8h")},"data-v-b77e4de2",null).exports,V=a("bOdI"),T=a.n(V),D=(a("P7ry"),{props:{sentinelMaster:{}},data:function(){return{infoList:[],search:""}},methods:{getSentinelMasterInfo:function(){var e=this;vt.post("/sentinel/getSentinelMasterInfo",this.sentinelMaster,function(t){var a=t.data;0==a.code?e.infoList=a.data:v.error("Get sentinel master info failed")},function(e){v.error(e)})}},mounted:function(){this.getSentinelMasterInfo()}}),U=a("VU/8")(D,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"info-wrapper"},e._l(e.infoList,function(t){return a("div",{key:t.key,staticClass:"info-item"},[a("span",[a("span",{staticClass:"key"},[e._v(e._s(t.key)+":")]),e._v(" "),a("span",{staticClass:"value"},[e._v(e._s(t.value))])])])}),0)},staticRenderFns:[]},!1,function(e){a("ejuE")},"data-v-eae314b4",null).exports,G=a("uk2G"),$=a("Icdr");a("4UDB"),a("Oq2I"),a("miEh"),a("80cc");var F={props:{nodeInfoParam:{},infoItem:""},data:function(){return{echartsData:[],echartsItemDataxAxis:[],noNodeInfoData:!0,lineColor:["#3888fa","#FF005A","#ffb980","#40c9c6","#b6a2de","#d87a80","#34bfa3","#5ab1ef","#3888fa","#ffba00","#c9c0cb","#FF005A","#3888fa","#FF005A","#ffb980","#40c9c6"],areaStyleColor:["rgba(56, 136, 250, 0.1)","rgba(250, 0, 90, 0.1)","rgba(64, 201, 198, 0.1)","rgba(255, 185, 128, 0.1)"],monitorDataLoading:!1}},methods:{initCharts:function(e){this.buildEchartsData(e);var t=this.buildSeries(this.echartsData),a=G();if((new Date).getTime(),!o(this)){var r=document.getElementById(this.infoItem);if(!o(r)){var s=$.init(r);s.clear(),s=$.init(r);var n=this.infoItem;"used_memory"!=n&&"used_memory_rss"!=n&&"used_memory_overhead"!=n&&"used_memory_dataset"!=n||(n+="(MB)"),s.setOption({title:{text:n,left:35},legend:{type:"scroll",bottom:0},grid:{left:20,right:20,bottom:50,top:50,containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross"},padding:[5,10],position:function(e,t,a,r,s){var n={top:-10};return n[["left","right"][+(e[0]<s.viewSize[0]/2)]]=5,n}},toolbox:{feature:{saveAsImage:{}}},xAxis:{data:this.echartsItemDataxAxis},yAxis:{axisTick:{show:!0}},series:t}),a.listenTo(document.getElementById(this.infoItem),function(e){setTimeout(function(){s.resize()},0)}),window.addEventListener("resize",function(){setTimeout(function(){s.resize()},0)})}}},getNodeInfoDataList:function(e){var t=this;this.monitorDataLoading=!0,vt.post("/monitor/getInfoItemMonitorData",e,function(e){var a=e.data;if(0==a.code){var r=a.data;t.noNodeInfoData=!1,t.initCharts(r)}else v.error("Get node info list failed");t.monitorDataLoading=!1},function(e){t.monitorDataLoading=!1,v.error(e)})},buildSeries:function(e){var t=e.length;if(0!=t){for(var a=[],r=0;r<t;r++){var s=this.lineColor[r%t],n=(this.areaStyleColor[r%t],e[r]);a.push({name:n.name,itemStyle:{normal:{color:s,lineStyle:{color:s,width:1.5}}},smooth:!0,type:"line",data:n.data,animationDuration:2800,animationEasing:"cubicInOut",symbol:"none"})}return a}},buildEchartsData:function(e){var t=this;this.echartsData=[],this.echartsItemDataxAxis=[];var a=this.infoItem;e.forEach(function(e){var r=e[0],s={name:r.node+" "+r.role.toLowerCase(),data:[]},n=0==t.echartsItemDataxAxis.length;e.forEach(function(e){var r,i,l,o,u,c;for(var d in n&&t.echartsItemDataxAxis.push((r=e.updateTime,l=(i=new Date(r)).getMonth()+1,o=i.getDate(),u=i.getHours(),c=i.getMinutes(),C(l)+"/"+C(o)+" "+C(u)+":"+C(c))),e)a.replace(/[^a-zA-Z]/g,"",/\s/g,"",/[0-9]/g,"").toLowerCase()==d.toLowerCase()&&s.data.push(e[d])}),t.echartsData.push(s)})}},watch:{nodeInfoParam:{handler:function(){var e=JSON.parse(R()(this.nodeInfoParam));e.infoItem=this.infoItem,this.getNodeInfoDataList(e)},deep:!0}}},O=a("VU/8")(F,{render:function(){var e=this.$createElement,t=this._self._c||e;return t("el-col",{directives:[{name:"loading",rawName:"v-loading",value:this.monitorDataLoading,expression:"monitorDataLoading"}],staticClass:"chart-item",attrs:{xl:12,lg:12,md:24,sm:24}},[t("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[t("div",{staticClass:"chart",class:{"chart-no-data":this.noNodeInfoData},attrs:{id:this.infoItem}})])],1)},staticRenderFns:[]},!1,function(e){a("TMx1")},"data-v-eebba92a",null).exports;a("uk2G"),a("Icdr"),a("4UDB"),a("Oq2I"),a("miEh"),a("80cc");var J={components:{query:z,echartsItem:O,sentinelMasterInfo:U},data:function(){var e;return e={queryVisible:!1,cluster:{},redisNodeList:[],slowLogRedisNodeList:[],timeTypeList:[{value:0,label:"Minute"},{value:1,label:"Hour"}],pickerOptions:{shortcuts:[{text:"Last 15 Min",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-9e5),e.$emit("pick",[a,t])}},{text:"Last 30 Min",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-18e5),e.$emit("pick",[a,t])}},{text:"Last 1 Hour",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-36e5),e.$emit("pick",[a,t])}},{text:"Last 3 Hours",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-108e5),e.$emit("pick",[a,t])}},{text:"Last 6 Hours",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-216e5),e.$emit("pick",[a,t])}},{text:"Last 12 Hours",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-432e5),e.$emit("pick",[a,t])}},{text:"Last 1 Day",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-864e5),e.$emit("pick",[a,t])}},{text:"Last 2 Days",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-1728e5),e.$emit("pick",[a,t])}},{text:"Last 3 Days",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e5),e.$emit("pick",[a,t])}},{text:"Last Week",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"Last Mooth",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}}]},infoItemList:["used_memory","used_memory_rss","used_memory_overhead","used_memory_dataset","mem_fragmentation_ratio","connections_received","rejected_connections","connected_clients","blocked_clients","commands_processed","instantaneous_ops_per_sec","sync_full","sync_partial_ok","sync_partial_err","keyspace_hits_ratio","keys","expires","cpu_sys","cpu_user"],selectedInfoItemList:["used_memory","used_memory_rss","mem_fragmentation_ratio","connected_clients","commands_processed","instantaneous_ops_per_sec","keyspace_hits_ratio","keys","expires"],nodeInfoParam:{nodeList:[],timeType:0,timeRange:[new Date-9e5,new Date]},nodeType:"",nodes:[],slowLogVisible:!1,slowLogList:[],timer:0,slowLogParam:{}},T()(e,"slowLogList",[]),T()(e,"clusterLoading",!1),T()(e,"slowLogLoading",!1),T()(e,"conditionSelectedLoading",!1),T()(e,"isSentinelMode",!1),T()(e,"sentinelMasterList",[]),T()(e,"sentinelMaster",{}),T()(e,"sentinelMasterInfoVisible",!1),e},methods:{handleQuery:function(e){this.queryVisible=!0},pickerDateTime:function(){var e=this.nodeInfoParam.timeRange,t=e[0],a=e[1];this.nodeInfoParam.startTime=t,this.nodeInfoParam.endTime=a},getAllNodeList:function(e){var t=this,a="/node-manage/getAllNodeList/"+e;this.slowLogRedisNodeList.push({label:"All"}),vt.get(a,null,function(e){var a=e.data;if(0==a.code){var r=[];a.data.forEach(function(e){var a=e.host+":"+e.port,s=e.nodeRole.toLowerCase(),n={node:a,role:s,value:a,label:a+" "+s};r.push(n),t.slowLogRedisNodeList.push(n)}),t.redisNodeList=r,t.nodeType="ALL_MASTER"}else v.error(a.message)},function(e){v.error(e)})},timedRefresh:function(){var e=this;this.timer?clearInterval(this.timer):this.timer=setInterval(function(){e.refresh()},3e5)},refresh:function(){var e=this.nodeInfoParam,t=e.timeRange,a=t[1]-t[0];e.timeRange=[new Date-a,new Date],e.startTime=new Date-a,e.endTime=new Date,this.nodeInfoParam=e},getSlowLogList:function(e){var t=this;this.slowLogLoading=!0,vt.post("/monitor/getSlowLogList",e,function(e){var a=e.data;if(0==a.code){var r=a.data;r.forEach(function(e){e.dateTime=y(e.dateTime)}),t.slowLogList=r}else v.error(a.message);t.slowLogLoading=!1},function(e){t.slowLogLoading=!1,v.error(e)})},monitorItemChange:function(e){var t=this;setTimeout(function(){t.refresh()},300)},getSentinelMasterList:function(e){var t=this,a="/sentinel/getSentinelMasterList/"+e;vt.get(a,null,function(e){var a=e.data;0==a.code&&(t.sentinelMasterList=a.data)},function(e){v.error(e)})}},watch:{nodes:{handler:function(){var e=this.nodeInfoParam,t=[];this.nodes.length>0&&(this.nodes.forEach(function(e){t.push(e)}),e.nodeList=t,this.nodeInfoParam=e)}},nodeType:{handler:function(){if("NODE"!=this.nodeType){var e=this.nodeInfoParam,t=[];"ALL_MASTER"==this.nodeType&&this.redisNodeList.forEach(function(e){"master"==e.role&&t.push(e.node)}),"ALL_MASTER"!=this.nodeType&&"ALL"!=this.nodeType||(this.nodes=[]),e.nodeList=t,this.nodeInfoParam=e}else this.nodes=[]}},slowLogParam:{handler:function(){this.getSlowLogList(this.slowLogParam)},deep:!0}},mounted:function(){var e=this,t=this.$route.params.clusterId;w(t,function(a){if(e.cluster=a,parseInt(a.redisVersion.substring(0))<4)for(var r=0;r<e.selectedInfoItemList.length;r++){var s=e.selectedInfoItemList[r];"used_memory_overhead"!=s&&"used_memory_dataset"!=s||e.selectedInfoItemList.splice(r,r)}e.getAllNodeList(e.cluster.clusterId),e.nodeInfoParam.clusterId=t,e.slowLogParam.clusterId=t,e.pickerDateTime(),e.timedRefresh(),e.isSentinelMode="sentinel"==a.redisMode,e.isSentinelMode&&(e.getSentinelMasterList(t),e.infoItemList=["connections_received","rejected_connections","connected_clients","blocked_clients","commands_processed","instantaneous_ops_per_sec","cpu_sys","cpu_user"],e.selectedInfoItemList=e.infoItemList)})},destroyed:function(){clearInterval(this.timer)}},q=a("VU/8")(J,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"monitor"}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.clusterLoading,expression:"clusterLoading"}],staticClass:"body-wrapper"},[a("el-row",[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"monitor-title"},[a("span",[a("span",{staticClass:"cluster-name"},[e._v(e._s(e.cluster.clusterName))]),e._v(" "),"HEALTH"==e.cluster.clusterState?a("i",{staticClass:"el-icon-sunny health"}):a("i",{staticClass:"el-icon-heavy-rain bad",attrs:{title:"Status"}})]),e._v(" "),a("div",[a("el-button",{attrs:{size:"mini",type:"primary",title:"Query",icon:"el-icon-search",disabled:e.isSentinelMode},on:{click:function(t){return e.handleQuery(e.cluster.clusterId)}}},[e._v("Query")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"warning",icon:"el-icon-ali-slow",title:"Slow log",disabled:e.isSentinelMode},on:{click:function(t){e.slowLogVisible=!0}}},[e._v("Slow Log")])],1)])])],1),e._v(" "),a("div",{staticClass:"base-info-wrapper"},[a("el-row",{staticClass:"base-info"},[a("el-col",{attrs:{xl:3,lg:4,md:6,sm:8}},[a("div",{staticClass:"base-info-item"},[e._v("\n            Mode:\n            "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.redisMode))])],1)]),e._v(" "),a("el-col",{attrs:{xl:3,lg:4,md:6,sm:8}},[a("div",{staticClass:"base-info-item"},[e._v("\n            Version:\n            "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.redisVersion))])],1)]),e._v(" "),a("el-col",{attrs:{xl:3,lg:4,md:6,sm:8}},[a("div",{staticClass:"base-info-item"},[e._v("\n            Nodes:\n            "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.clusterKnownNodes))])],1)]),e._v(" "),e.isSentinelMode?e._e():a("el-col",{attrs:{xl:3,lg:4,md:6,sm:8}},[a("div",{staticClass:"base-info-item"},[e._v("\n            Master:\n            "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.clusterSize))])],1)]),e._v(" "),e.isSentinelMode?e._e():a("el-col",{attrs:{xl:3,lg:4,md:6,sm:8}},[a("div",{staticClass:"base-info-item"},[e._v("\n            Total Memory:\n            "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.totalUsedMemory)+"MB")])],1)]),e._v(" "),e.isSentinelMode?e._e():a("el-col",{attrs:{xl:3,lg:4,md:6,sm:8}},[a("div",{staticClass:"base-info-item"},[e._v("\n            Total Keys:\n            "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.totalKeys))])],1)]),e._v(" "),e.isSentinelMode?e._e():a("el-col",{attrs:{xl:3,lg:4,md:6,sm:8}},[a("div",{staticClass:"base-info-item"},[e._v("\n            Total Expires:\n            "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.totalExpires))])],1)]),e._v(" "),e.isSentinelMode?a("el-col",{attrs:{xl:3,lg:4,md:6,sm:8}},[a("div",{staticClass:"base-info-item"},[e._v("\n            Sentinel OK:\n            "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.sentinelOk))])],1)]):e._e(),e._v(" "),e.isSentinelMode?a("el-col",{attrs:{xl:3,lg:4,md:6,sm:8}},[a("div",{staticClass:"base-info-item"},[e._v("\n            Sentinel Masters:\n            "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.sentinelMasters))])],1)]):e._e(),e._v(" "),e.isSentinelMode?a("el-col",{attrs:{xl:3,lg:4,md:6,sm:8}},[a("div",{staticClass:"base-info-item"},[e._v("\n            Master OK:\n            "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.masterOk))])],1)]):e._e()],1)],1)],1),e._v(" "),e.isSentinelMode?a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.clusterLoading,expression:"clusterLoading"}],staticClass:"body-wrapper",staticStyle:{"margin-top":"20px"}},[a("div",{staticClass:"base-info-wrapper"},[a("el-table",{attrs:{data:e.sentinelMasterList}},[a("el-table-column",{attrs:{property:"name",label:"Master Name"}}),e._v(" "),a("el-table-column",{attrs:{property:"status",label:"Status"},scopedSlots:e._u([{key:"default",fn:function(t){return["ok"==t.row.status?a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.status))]):a("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v(e._s(t.row.status))])]}}],null,!1,1725191865)}),e._v(" "),a("el-table-column",{attrs:{property:"flags",label:"Flags"},scopedSlots:e._u([{key:"default",fn:function(t){return["master"==t.row.flags?a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.flags))]):a("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v(e._s(t.row.flags))])]}}],null,!1,1275231818)}),e._v(" "),a("el-table-column",{attrs:{prop:"monitor",label:"Monitor",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.monitor?a("i",{staticClass:"el-icon-success status-icon normal-status"}):a("i",{staticClass:"el-icon-error status-icon normal-bad"})]}}],null,!1,1044783768)}),e._v(" "),a("el-table-column",{attrs:{label:"Master Node"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.host)+":"+e._s(t.row.port))]}}],null,!1,2675805811)}),e._v(" "),a("el-table-column",{attrs:{property:"lastMasterNode",label:"Last Master Node"}}),e._v(" "),a("el-table-column",{attrs:{property:"numSlaves",label:"Num Slaves"}}),e._v(" "),a("el-table-column",{attrs:{property:"sentinels",label:"Sentinels"}}),e._v(" "),a("el-table-column",{attrs:{label:"Detail"},scopedSlots:e._u([{key:"default",fn:function(t){return a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){e.sentinelMasterInfoVisible=!0,e.sentinelMaster=t.row}}},[e._v("Detail")])}}],null,!1,3640876897)})],1)],1)]):e._e(),e._v(" "),a("div",{staticStyle:{"margin-top":"20px"}},[a("div",{staticClass:"monitor-condition-wrapper"},[a("div",{staticClass:"condition-wrapper"},[a("el-select",{staticClass:"condition-item",staticStyle:{width:"120px"},attrs:{size:"small",placeholder:"Node Type"},model:{value:e.nodeType,callback:function(t){e.nodeType=t},expression:"nodeType"}},[a("el-option",{attrs:{label:"All Master",value:"ALL_MASTER"}}),e._v(" "),a("el-option",{attrs:{label:"All",value:"ALL"}}),e._v(" "),a("el-option",{attrs:{label:"Node",value:"NODE"}})],1),e._v(" "),"NODE"==e.nodeType?a("el-select",{staticClass:"condition-item",staticStyle:{"min-width":"280px"},attrs:{filterable:"",size:"small",placeholder:"Node",multiple:"","collapse-tags":"",clearable:""},model:{value:e.nodes,callback:function(t){e.nodes=t},expression:"nodes"}},e._l(e.redisNodeList,function(e){return a("el-option",{key:e.label,attrs:{label:e.label,value:e.value}})}),1):e._e(),e._v(" "),a("el-select",{staticClass:"condition-item",staticStyle:{width:"100px"},attrs:{size:"small",placeholder:"Time Type"},model:{value:e.nodeInfoParam.timeType,callback:function(t){e.$set(e.nodeInfoParam,"timeType",t)},expression:"nodeInfoParam.timeType"}},e._l(e.timeTypeList,function(e){return a("el-option",{key:e.label,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),a("el-select",{staticClass:"condition-item",staticStyle:{width:"260px"},attrs:{size:"small",placeholder:"Info Item",multiple:"","collapse-tags":""},on:{change:e.monitorItemChange},model:{value:e.selectedInfoItemList,callback:function(t){e.selectedInfoItemList=t},expression:"selectedInfoItemList"}},e._l(e.infoItemList,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1),e._v(" "),a("div",{staticClass:"time-picker-wrapper"},[a("el-date-picker",{attrs:{width:"1080px",size:"small",type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"-","start-placeholder":"Start Time","end-placeholder":"End Time",align:"right",editable:!1,"value-format":"timestamp"},on:{change:e.pickerDateTime},model:{value:e.nodeInfoParam.timeRange,callback:function(t){e.$set(e.nodeInfoParam,"timeRange",t)},expression:"nodeInfoParam.timeRange"}})],1)],1),e._v(" "),a("i",{staticClass:"el-icon-refresh-left refresh",on:{click:function(t){return e.refresh()}}})]),e._v(" "),a("el-row",{staticClass:"echart-wrapper",attrs:{id:"monitor-charts"}},e._l(e.selectedInfoItemList,function(t){return a("echartsItem",{key:t,attrs:{infoItem:t,nodeInfoParam:e.nodeInfoParam}})}),1)],1),e._v(" "),a("el-dialog",{attrs:{title:"Query",visible:e.queryVisible,"close-on-click-modal":!1,width:"60%"},on:{"update:visible":function(t){e.queryVisible=t}}},[a("query",{attrs:{cluster:e.cluster}})],1),e._v(" "),a("el-dialog",{attrs:{title:"Slow Log",visible:e.slowLogVisible,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.slowLogVisible=t}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.slowLogLoading,expression:"slowLogLoading"}]},[a("el-select",{staticClass:"condition-item",staticStyle:{"margin-bottom":"20px"},attrs:{filterable:"",size:"small",placeholder:"Please select node"},model:{value:e.slowLogParam.node,callback:function(t){e.$set(e.slowLogParam,"node",t)},expression:"slowLogParam.node"}},e._l(e.slowLogRedisNodeList,function(e){return a("el-option",{key:e.label,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),a("el-table",{attrs:{data:e.slowLogList,"default-sort":{prop:"dateTime",order:"descending"}}},[a("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"node",label:"Node",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"type",label:"Type"}}),e._v(" "),a("el-table-column",{attrs:{prop:"command",label:"Command"}}),e._v(" "),a("el-table-column",{attrs:{prop:"executionTime",label:"Execution Time(s)",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"dateTime",label:"Date Time",sortable:""}})],1)],1)]),e._v(" "),e.sentinelMasterInfoVisible?a("el-dialog",{attrs:{title:"Sentinel Master Info",visible:e.sentinelMasterInfoVisible,"close-on-click-modal":!1,width:"40%"},on:{"update:visible":function(t){e.sentinelMasterInfoVisible=t}}},[a("sentinelMasterInfo",{attrs:{sentinelMaster:e.sentinelMaster}})],1):e._e()],1)},staticRenderFns:[]},!1,function(e){a("bY86")},"data-v-47745323",null).exports,B=a("RRo+"),K=a.n(B),H={props:{redisNode:{}},data:function(){return{infoList:[],search:""}},methods:{getNodeInfo:function(){var e=this;vt.post("/node-manage/getNodeInfo",this.redisNode,function(t){var a=t.data;0==a.code?e.infoList=a.data:v.error("Get node info failed")},function(e){v.error(e)})}},computed:{filterInfoList:function(){var e=this;return this.infoList.filter(function(t){return!e.search||t.key.toLowerCase().includes(e.search.toLowerCase())})}},mounted:function(){this.getNodeInfo()}},j={props:{redisNode:{}},data:function(){return{configList:[],search:""}},methods:{getConfig:function(){var e=this;vt.post("/node-manage/getConfig",this.redisNode,function(t){var a=t.data;0==a.code?e.configList=a.data:v.error("get node config failed")},function(e){v.error(e)})}},computed:{filterConfigList:function(){var e=this;return this.configList.filter(function(t){return!e.search||t.key.toLowerCase().includes(e.search.toLowerCase())})}},mounted:function(){this.getConfig()}},W={props:{sentinelMaster:{}},data:function(){return{infoList:[],search:""}},methods:{getSentinelMasterInfo:function(){var e=this;vt.post("/sentinel/getSentinelMasterSlaves",this.sentinelMaster,function(t){var a=t.data;0==a.code?e.infoList=a.data:v.error("Get sentinel master slaves failed")},function(e){v.error(e)})}},mounted:function(){this.getSentinelMasterInfo()}},Z={components:{info:a("VU/8")(H,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"info-wrapper"},[a("el-input",{staticStyle:{"margin-bottom":"20px"},attrs:{size:"mini",placeholder:"search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),e._l(e.filterInfoList,function(t){return a("div",{key:t.key,staticClass:"info-item"},[null!=t.description?a("div",{staticClass:"description"},[e._v("# "+e._s(t.description))]):e._e(),e._v(" "),a("span",[a("span",{staticClass:"key"},[e._v(e._s(t.key)+":")]),e._v(" "),a("span",{staticClass:"value"},[e._v(e._s(t.value))])])])})],2)},staticRenderFns:[]},!1,function(e){a("V3UU")},"data-v-6d9c90c5",null).exports,config:a("VU/8")(j,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"config-wrapper"},[a("el-input",{staticStyle:{"margin-bottom":"20px"},attrs:{size:"mini",placeholder:"search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),e._l(e.filterConfigList,function(t){return a("div",{key:t.key,staticClass:"config-item"},[null!=t.description&&""!=t.description?a("div",{staticClass:"description"},[e._v("# "+e._s(t.description))]):e._e(),e._v(" "),a("span",[a("span",{staticClass:"key"},[e._v(e._s(t.key)+":")]),e._v(" "),a("span",{staticClass:"value"},[e._v(e._s(t.value))])])])})],2)},staticRenderFns:[]},!1,function(e){a("Kuh7")},"data-v-4a923cae",null).exports,sentinelMasterInfo:U,sentinelMasterSlaves:a("VU/8")(W,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"info-wrapper"},e._l(e.infoList,function(t){return a("div",{key:t.key,staticClass:"info-item"},[a("span",[a("span",{staticClass:"key"},[e._v(e._s(t.key)+":")]),e._v(" "),a("span",{staticClass:"value"},[e._v(e._s(t.value))])])])}),0)},staticRenderFns:[]},!1,function(e){a("LnUS")},"data-v-15b384f4",null).exports},data:function(){var e=this,t=function(e,t,a){K()(t)?(t<0||t>16383)&&a(new Error("Slot range between 0 and 16383")):a(new Error("Please enter number")),a()};return{cluster:{},search:"",redisNodeList:[],replicateOfVisible:!1,failOverVisible:!1,importNodeVisible:!1,editConfigVisible:!1,forgetVisible:!1,moveSlotVisible:!1,startNodeVisible:!1,stopNodeVisible:!1,restartNodeVisible:!1,deleteNodeVisible:!1,infoVisible:!1,configVisible:!1,initSlotsVisible:!1,slotRange:{},operationNode:{},operationNodeList:[],newRedisNode:{},configKeyList:[],redisConfig:{},nodeConfigList:[],rules:{redisNode:[{required:!0,message:"Please enter redis node",trigger:"blur"},{required:!0,validator:function(e,t,a){if(!d(t))return a(new Error("Incorrect format"));a()},trigger:"blur"},{required:!0,validator:function(t,a,r){var s={redisPassword:"sentinel"!=e.cluster.redisMode?e.cluster.redisPassword:e.sentinelMaster.authPass},n=a.split(":"),i={host:n[0],port:n[1]};s.redisNode=i,vt.post("/validate/redisNode",s,function(e){if(0!=e.data.code)return r(new Error("Connection refused."));r()},function(e){return r(new Error("Network error, "+e))})},trigger:"blur"}],startSlot:[{required:!0,message:"Please enter slot",trigger:"blur"},{required:!0,validator:t,trigger:"blur"}],endSlot:[{required:!0,message:"Please enter slot",trigger:"blur"},{required:!0,validator:t,trigger:"blur"},{required:!0,validator:function(t,a,r){var s=e.slotRange.startSlot;o(s)&&r(),a-s<0&&r(new Error("End slot must be greater than the start slot")),r()},trigger:"blur"}],configKey:[{required:!0,message:"Please select or enter config key",trigger:"blur"}],name:[{required:!0,message:"Please enter master name",trigger:"blur"},{required:!0,validator:function(t,a,r){if(e.isUpdateSentinelMaster)return r();var s={clusterId:e.cluster.clusterId,groupId:e.cluster.groupId,name:a};vt.post("/sentinel/getSentinelMasterByName",s,function(e){if(0==e.data.code)return r(new Error("Master name has been exist."));r()},function(e){return r(new Error("Network error, "+e))})},trigger:"blur"}],downAfterMilliseconds:[{type:"number",message:"Please enter integer",trigger:"blur"}],parallelSyncs:[{type:"number",message:"Please enter integer",trigger:"blur"}],failoverTimeout:[{type:"number",message:"Please enter integer",trigger:"blur"}],quorum:[{required:!0,message:"Please enter quorum",trigger:"blur"},{type:"number",message:"Please enter integer",trigger:"blur"}]},clusterLoading:!1,nodeListLoading:!1,operationLoading:!1,sentinelMasterList:[],sentinelMaster:{},sentinelMasterInfoVisible:!1,sentinelMasterEditVisible:!1,isUpdateSentinelMaster:!1,deleteSentinelMasterVisible:!1,failoverSentinelMasterVisible:!1,sentinelMasterSlavesVisible:!1}},methods:{tableRowClassName:function(e){var t=e.row;return e.rowIndex,"MASTER"==t.nodeRole?"info-row":""},handleSelectionChange:function(e){var t=this;this.operationNode=[],e.forEach(function(e){t.operationNode.push(e)})},getAllNodeList:function(e){var t=this;this.nodeListLoading=!0;var a="/node-manage/getAllNodeListWithStatus/"+e;vt.get(a,null,function(e){var a=e.data;if(0==a.code){var r=[],s=void 0,n=[];a.data.forEach(function(e){o(e.nodeId)&&(e.nodeId=e.host+":"+e.port);var t=e.flags;e.time=y(e.updateTime),"master"==t?(n=[],(s=e).children=n,r.push(s)):"slave"==t||"replica"==t?e.runStatus?n.push(e):(e.children=[],r.push(e)):r.push(e)}),r.forEach(function(e){var t=e.children,a=0;o(t)||o(t.length)||(a=t.length),e.replicaNumber=a}),t.redisNodeList=r}else v.error(a.message);t.nodeListLoading=!1},function(e){t.nodeListLoading=!1,v.error(e)})},reload:function(){var e=this,t=this.cluster.clusterId;this.getAllNodeList(t),w(t,function(a){e.cluster=a,e.getAllNodeList(t),e.getConfigKeyList()}),this.updateCluster(this.clsuter)},updateCluster:function(e){var t=this;vt.post("/cluster/updateCluster",this.cluster,function(e){var a=e.data;0==a.code?t.cluster=a.data:v.error(a.message)},function(e){v.error(e)})},getNodeInfo:function(e){this.operationNode=e,this.infoVisible=!0},getConfig:function(e){this.operationNode=e,this.configVisible=!0},getConfigKeyList:function(){var e=this;vt.get("/node-manage/getRedisConfigKeyList",null,function(t){e.configKeyList=t.data.data},function(e){v.error(e)})},getConfigCurrentValue:function(e){var t=this,a={cluster:this.cluster,configKey:e.configKey};vt.post("/node-manage/getConfigCurrentValue",a,function(e){t.nodeConfigList=e.data.data},function(e){v.error(e)})},editConfig:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var a={clusterId:t.cluster.clusterId,redisConfig:t.redisConfig,groupId:t.currentGroup.groupId};vt.post("/node-manage/updateRedisConfig",a,function(e){0==e.data.code?t.editConfigVisible=!1:v.error("update config failed")},function(e){v.error(e)})}})},canOperate:function(){if(this.nodeNumber<=1)return!0;var e=this.cluster.nodes,t=e.split(",");return this.operationNodeList.forEach(function(a){var r=a.host+":"+a.port;if(e.indexOf(r)>-1&&1==t.length)return v.warning("I can't operate "+r+", because it in the database"),!1}),!0},buildNodeList:function(e){var t=!o(e.length);this.operationNodeList=[],t||(this.operationNode={},this.operationNode=e,this.operationNode.groupId=this.currentGroup.groupId,this.operationNodeList.push(this.operationNode))},handleReplicateOf:function(e){this.replicateOfVisible=!0,this.buildNodeList(e)},replicateOf:function(e){var t=this;if(o(e))v.error("Node invalid");else{this.operationNodeList.forEach(function(t){t.masterId=e});var a=this.cluster.redisMode,r=void 0;if("cluster"==a)r="/node-manage/replicateOf";else{if("standalone"!=a)return;r="/node-manage/standaloneReplicateOf"}vt.post(r,this.operationNodeList,function(e){var a=e.data;t.reload(),0==a.code?t.replicateOfVisible=!1:v.error(a.message)},function(e){v.error(e)})}},handleFailOver:function(e){this.failOverVisible=!0,this.buildNodeList(e)},failOver:function(){var e=this;vt.post("/node-manage/failOver",this.operationNodeList,function(t){var a=t.data;e.getAllNodeList(e.cluster.clusterId),0==a.code?e.failOverVisible=!1:v.error(a.message)},function(e){v.error(e)})},importNode:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var a=t.newRedisNode.address.split(":"),r={clusterId:t.cluster.clusterId,host:a[0],port:a[1],groupId:t.currentGroup.groupId},s=[];s.push(r),vt.post("/node-manage/importNode",s,function(e){var a=e.data;t.reload(),0==a.code?t.importNodeVisible=!1:v.error(a.message)},function(e){v.error(e)})}})},handleForget:function(e){this.forgetVisible=!0,this.buildNodeList(e)},forget:function(){var e=this,t=this.cluster.redisMode,a=void 0;if("cluster"==t)a="/node-manage/forget";else{if("standalone"!=t)return;a="/node-manage/standaloneForget"}this.canOperate()&&vt.post(a,this.operationNodeList,function(t){var a=t.data;e.reload(),0==a.code?e.forgetVisible=!1:v.error(a.message)},function(e){v.error(e)})},handleMoveSlot:function(e){this.moveSlotVisible=!0,this.buildNodeList(e)},moveSlot:function(e){var t=this;this.$refs[e].validate(function(a){if(a){var r={redisNode:t.operationNode,slotRange:t.slotRange,groupId:t.currentGroup.groupId};vt.post("/node-manage/moveSlot",r,function(a){var r=a.data;t.getAllNodeList(t.cluster.clusterId),0==r.code?(t.moveSlotVisible=!1,t.$refs[e].resetFields()):v.error(r.message+" Move slot failed")},function(e){v.error(e)})}})},handleStart:function(e){e.runStatus?v.error("This node is already running"):(this.buildNodeList(e),this.startNodeVisible=!0)},startNode:function(){var e=this;vt.post("/node-manage/start",this.operationNodeList,function(t){var a=t.data;e.reload(),0==a.code?e.startNodeVisible=!1:v.error("start node failed")},function(e){v.error(e)})},handleStop:function(e){e.inCluster,e.runStatus?(this.buildNodeList(e),this.stopNodeVisible=!0):v.error("This node has stopped")},stopNode:function(){var e=this;this.canOperate&&vt.post("/node-manage/stop",this.operationNodeList,function(t){var a=t.data;e.reload(),0==a.code?e.stopNodeVisible=!1:v.error("stop node failed")},function(e){v.error(e)})},handleRestart:function(e){this.buildNodeList(e),this.restartNodeVisible=!0},restartNode:function(){var e=this;this.canOperate&&vt.post("/node-manage/restart",this.operationNodeList,function(t){var a=t.data;e.reload(),0==a.code?e.restartNodeVisible=!1:v.error("restart node failed")},function(e){v.error(e)})},handleDelete:function(e){var t=e.inCluster,a=e.runStatus;t?v.error(e.host+":"+e.port+" still in the cluster, please forget it first"):a?v.error(e.host+":"+e.port+" is running, please stop it first"):(this.buildNodeList(e),this.deleteNodeVisible=!0)},deleteNode:function(){var e=this;this.canOperate&&vt.post("/node-manage/delete",this.operationNodeList,function(t){var a=t.data;e.reload(),0==a.code?e.deleteNodeVisible=!1:v.error("delete node failed")},function(e){v.error(e)})},initSlots:function(){var e=this;vt.post("/node-manage/initSlots",this.cluster,function(t){var a=t.data;e.reload(),0==a.code?e.initSlotsVisible=!1:v.error(a.message)},function(e){v.error(e)})},refresh:function(){var e=this,t=this.cluster.clusterId;w(t,function(a){e.cluster=a,e.getAllNodeList(t)})},getSentinelMasterList:function(e){var t=this,a="/sentinel/getSentinelMasterList/"+e;vt.get(a,null,function(e){var a=e.data;0==a.code&&(t.sentinelMasterList=a.data)},function(e){v.error(e)})},monitorMaster:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var a=t.sentinelMaster.redisNode.split(":");t.sentinelMaster.host=a[0],t.sentinelMaster.port=a[1],t.sentinelMaster.clusterId=t.cluster.clusterId,t.sentinelMaster.groupId=t.cluster.groupId,vt.post("/sentinel/monitorMaster",t.sentinelMaster,function(e){0==e.data.code?t.sentinelMasterEditVisible=!1:v.error("Monitor new master failed."),t.getSentinelMasterList(t.cluster.clusterId)},function(e){v.error(e)})}})},updateSentinelMaster:function(e){var t=this;this.$refs[e].validate(function(e){e&&vt.post("/sentinel/updateSentinelMaster",t.sentinelMaster,function(e){0==e.data.code?t.sentinelMasterEditVisible=!1:v.error("Update sentinel master failed."),t.getSentinelMasterList(t.cluster.clusterId)},function(e){v.error(e)})})},editSentinelMaster:function(e){var t=this;this.isUpdateSentinelMaster=!0,this.sentinelMasterEditVisible=!0,vt.post("/sentinel/getSentinelMasterByName",e,function(e){var a=e.data;0==a.code?(t.sentinelMaster=a.data,t.sentinelMaster.redisNode=t.sentinelMaster.host+":"+t.sentinelMaster.port):v.error("Get sentinel master failed.")},function(e){v.error(e)})},deleteSentinelMaster:function(){var e=this;vt.post("/sentinel/deleteSentinelMaster",this.sentinelMaster,function(t){0==t.data.code?(e.deleteSentinelMasterVisible=!1,e.getSentinelMasterList(e.cluster.clusterId)):v.error("Remove sentinel master failed.")},function(e){v.error(e)})},failoverSentinelMaster:function(){var e=this;vt.post("/sentinel/failoverSentinelMaster",this.sentinelMaster,function(t){0==t.data.code?(e.deleteSentinelMasterVisible=!1,e.getSentinelMasterList(e.cluster.clusterId)):v.error("Failover sentinel master failed.")},function(e){v.error(e)})}},computed:{nodeNumber:function(){var e=0;return this.redisNodeList.forEach(function(t){e+=1;var a=t.children;o(a)||o(a.length)||(e+=a.length)}),e},currentGroup:function(){return yt.getters.getCurrentGroup}},watch:{currentGroup:function(e){this.$router.push({name:"dashboard",params:{groupId:e.groupId}})}},mounted:function(){var e=this,t=this.$route.params.clusterId;w(t,function(a){e.cluster=a,e.getAllNodeList(t),e.getConfigKeyList(),"sentinel"==a.redisMode&&e.getSentinelMasterList(t)})}},Q=a("VU/8")(Z,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"body-wrapper",attrs:{id:"cluster-manage"}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.clusterLoading,expression:"clusterLoading"}],staticClass:"manage-header-wrapper"},[a("div",{staticClass:"title-wrapper"},[a("span",[e._v(e._s(e.cluster.clusterName))]),e._v(" "),"HEALTH"==e.cluster.clusterState?a("i",{staticClass:"el-icon-sunny health",attrs:{title:"Status"}}):a("i",{staticClass:"el-icon-heavy-rain bad",attrs:{title:"Status"}})]),e._v(" "),a("div",{staticClass:"base-info-operation-wrapper"},[a("span",{staticClass:"base-info-item"},[e._v("\n        Node:\n        "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.clusterKnownNodes))])],1),e._v(" "),"sentinel"!=e.cluster.redisMode?a("span",{staticClass:"base-info-item"},[e._v("\n        Master:\n        "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.clusterSize))])],1):a("span",{staticClass:"base-info-item"},[e._v("\n        Sentinel OK:\n        "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.sentinelOk))])],1),e._v(" "),"sentinel"==e.cluster.redisMode?a("span",{staticClass:"base-info-item"},[e._v("\n        Sentinel Masters:\n        "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.sentinelMasters))])],1):e._e(),e._v(" "),"sentinel"==e.cluster.redisMode?a("span",{staticClass:"base-info-item"},[e._v("\n        Master OK:\n        "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.masterOk))])],1):e._e(),e._v(" "),a("span",{staticClass:"base-info-item"},[e._v("\n        Environment:\n        "),0==e.cluster.installationEnvironment?a("el-tag",{attrs:{size:"mini"}},[e._v("Docker")]):1==e.cluster.installationEnvironment?a("el-tag",{attrs:{size:"mini"}},[e._v("Machine")]):3==e.cluster.installationEnvironment?a("el-tag",{attrs:{size:"mini"}},[e._v("Humpback")]):e._e()],1),e._v(" "),null!=e.cluster.image&&""!=e.cluster.image?a("span",{staticClass:"base-info-item"},[e._v("\n        Image:\n        "),a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.cluster.image))])],1):e._e(),e._v(" "),a("span",{staticClass:"base-info-item"},[e._v("\n        Type:\n        "),0==e.cluster.installationType?a("el-tag",{attrs:{size:"mini"}},[e._v("Redis Manager")]):a("el-tag",{attrs:{size:"mini"}},[e._v("Import")])],1)])]),e._v(" "),e.sentinelMasterList.length>0?a("div",{staticStyle:{"margin-buttom":"20px"}},[a("el-table",{attrs:{data:e.sentinelMasterList}},[a("el-table-column",{attrs:{property:"name",label:"Master Name"}}),e._v(" "),a("el-table-column",{attrs:{property:"status",label:"Status"},scopedSlots:e._u([{key:"default",fn:function(t){return["ok"==t.row.status?a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.status))]):a("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v(e._s(t.row.status))])]}}],null,!1,1725191865)}),e._v(" "),a("el-table-column",{attrs:{property:"flags",label:"Flags"},scopedSlots:e._u([{key:"default",fn:function(t){return["master"==t.row.flags?a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.flags))]):a("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v(e._s(t.row.flags))])]}}],null,!1,1275231818)}),e._v(" "),a("el-table-column",{attrs:{prop:"monitor",label:"Monitor",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.monitor?a("i",{staticClass:"el-icon-success status-icon normal-status"}):a("i",{staticClass:"el-icon-error status-icon normal-bad"})]}}],null,!1,1044783768)}),e._v(" "),a("el-table-column",{attrs:{label:"Master Node"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.host)+":"+e._s(t.row.port))]}}],null,!1,2675805811)}),e._v(" "),a("el-table-column",{attrs:{property:"lastMasterNode",label:"Last Master Node"}}),e._v(" "),a("el-table-column",{attrs:{property:"numSlaves",label:"Num Slaves"}}),e._v(" "),a("el-table-column",{attrs:{property:"sentinels",label:"Sentinels"}}),e._v(" "),a("el-table-column",{attrs:{width:"220px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-dropdown",{attrs:{size:"mini","split-button":"",type:"primary",trigger:"click"}},[e._v("\n            Info\n            "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{nativeOn:{click:function(a){e.sentinelMasterInfoVisible=!0,e.sentinelMaster=t.row}}},[e._v("Detail")]),e._v(" "),a("el-dropdown-item",{nativeOn:{click:function(a){e.sentinelMasterSlavesVisible=!0,e.sentinelMaster=t.row}}},[e._v("Slaves")])],1)],1),e._v(" "),a("el-dropdown",{attrs:{size:"mini","split-button":"",type:"danger",trigger:"click"}},[e._v("\n            Operate\n            "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{nativeOn:{click:function(a){return e.editSentinelMaster(t.row)}}},[e._v("Edit")]),e._v(" "),a("el-dropdown-item",{nativeOn:{click:function(a){e.failoverSentinelMasterVisible=!0,e.sentinelMaster=t.row}}},[e._v("Failover")]),e._v(" "),a("el-dropdown-item",{nativeOn:{click:function(a){e.deleteSentinelMasterVisible=!0,e.sentinelMaster=t.row}}},[e._v("Delete")])],1)],1)]}}],null,!1,1426419818)})],1)],1):e._e(),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.nodeListLoading,expression:"nodeListLoading"}],staticClass:"nodes-wrapper"},[a("div",{staticClass:"batch-operation-wrapper"},[a("div",{staticClass:"batch-title"},[e._v("Cluster Operation")]),e._v(" "),a("div",{staticStyle:{display:"flex","justify-content":"space-between"}},["sentinel"!=e.cluster.redisMode?a("div",[a("el-link",{attrs:{underline:!1,icon:"el-icon-edit"},on:{click:function(t){e.editConfigVisible=!0}}},[e._v("Edit Config")]),e._v(" "),"cluster"!=e.cluster.redisMode||e.cluster.initialized||0!=e.cluster.clusterSlotsAssigned?e._e():a("span",[a("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),a("el-link",{attrs:{underline:!1,icon:"el-icon-coordinate"},on:{click:function(t){e.initSlotsVisible=!0}}},[e._v("Init Slot")])],1)],1):e._e(),e._v(" "),a("div"),e._v(" "),a("div",{staticStyle:{display:"flex","align-items":"center"}},["sentinel"!=e.cluster.redisMode?a("el-link",{attrs:{underline:!1,icon:"el-icon-plus",type:"primary"},on:{click:function(t){e.importNodeVisible=!0}}},[e._v("Import Node")]):a("el-link",{attrs:{underline:!1,icon:"el-icon-plus",type:"primary"},on:{click:function(t){e.sentinelMasterEditVisible=!0,e.isUpdateSentinelMaster=!1,e.sentinelMaster={}}}},[e._v("Monitor Master")]),e._v(" "),a("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),a("i",{staticClass:"el-icon-refresh-left refresh",on:{click:function(t){return e.refresh()}}})],1)])]),e._v(" "),a("div",{staticClass:"table-wrapper"},[a("el-table",{staticStyle:{width:"100%","margin-bottom":"10px"},attrs:{data:e.redisNodeList,"row-key":"nodeId",size:"medium","default-sort":{prop:"slotRange",order:"ascending"},"row-class-name":e.tableRowClassName,"tree-props":{children:"children",hasChildren:"hasChildren"},"default-expand-all":!0}},[a("el-table-column",{attrs:{label:"Link State",sortable:"",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(t.row.slot)+"\n            "),"connected"==t.row.linkState?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(t.row.linkState))]):a("el-tag",{staticClass:"pointer",attrs:{size:"small",type:"warning"}},[e._v(e._s(t.row.linkState))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"Flags",width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return["master"==t.row.flags?a("el-tag",{attrs:{size:"mini"}},[e._v("\n              "+e._s(t.row.flags)+"\n              "),t.row.replicaNumber>0?a("span",[e._v("["+e._s(t.row.replicaNumber)+"]")]):e._e()]):a("el-tag",{staticClass:"pointer",attrs:{size:"mini",type:"info"}},[e._v(e._s(t.row.flags))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"inCluster",label:"In Cluster",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.inCluster?a("i",{staticClass:"el-icon-success status-icon normal-status"}):a("i",{staticClass:"el-icon-error status-icon normal-bad"})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"runStatus",label:"Run Status",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.runStatus?a("i",{staticClass:"el-icon-success status-icon normal-status"}):a("i",{staticClass:"el-icon-error status-icon normal-bad"})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"host",label:"Host",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"port",label:"Port",sortable:""}}),e._v(" "),"cluster"==e.cluster.redisMode?a("el-table-column",{attrs:{prop:"slotRange",label:"Slot Range",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(t.row.slotRange)+"\n            "),null!=t.row.slotRange?a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.slotNumber))]):e._e()]}}],null,!1,865138624)}):e._e(),e._v(" "),a("el-table-column",{attrs:{label:"Meta",width:"130px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{staticClass:"pointer",attrs:{size:"mini"},on:{click:function(a){return e.getNodeInfo(t.row)}}},[e._v("Info")]),e._v(" "),"sentinel"!=e.cluster.redisMode?a("el-tag",{staticClass:"pointer",attrs:{size:"mini"},on:{click:function(a){return e.getConfig(t.row)}}},[e._v("Config")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"time",label:"Time",sortable:""}}),e._v(" "),"sentinel"!=e.cluster.redisMode?a("el-table-column",{attrs:{label:"Operation",width:"230px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-dropdown",{attrs:{size:"mini","split-button":"",type:"warning",trigger:"click"}},[e._v("\n              Cluster\n              "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},["cluster"==e.cluster.redisMode&&"MASTER"==t.row.nodeRole&&t.row.inCluster?a("el-dropdown-item",{nativeOn:{click:function(a){return e.handleMoveSlot(t.row)}}},[e._v("Move Slot")]):e._e(),e._v(" "),"SLAVE"==t.row.nodeRole||"REPLICA"==t.row.nodeRole||"MASTER"==t.row.nodeRole&&(null==t.row.children||0==t.row.children.length)?a("el-dropdown-item",{nativeOn:{click:function(a){return e.handleForget(t.row)}}},[e._v("Forget")]):e._e(),e._v(" "),"cluster"==e.cluster.redisMode&&t.row.inCluster&&("SLAVE"==t.row.nodeRole||"REPLICA"==t.row.nodeRole||"MASTER"==t.row.nodeRole&&null==t.row.slotRange)||"standalone"==e.cluster.redisMode&&!t.row.inCluster?a("el-dropdown-item",{nativeOn:{click:function(a){return e.handleReplicateOf(t.row)}}},[e._v("Replicate Of")]):e._e(),e._v(" "),"cluster"!=e.cluster.redisMode||"SLAVE"!=t.row.nodeRole&&"REPLICA"!=t.row.nodeRole||!t.row.inCluster?e._e():a("el-dropdown-item",{nativeOn:{click:function(a){return e.handleFailOver(t.row)}}},[e._v("Fail Over")]),e._v(" "),a("el-dropdown-item",[e._v("Memory Purge")])],1)],1),e._v(" "),a("el-dropdown",{attrs:{size:"mini","split-button":"",type:"danger",trigger:"click"}},[e._v("\n              Node\n              "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{disabled:t.row.runStatus},nativeOn:{click:function(a){return e.handleStart(t.row)}}},[e._v("Start")]),e._v(" "),a("el-dropdown-item",{attrs:{disabled:(t.row.inCluster||!t.row.runStatus)&&e.nodeNumber>1},nativeOn:{click:function(a){return e.handleStop(t.row)}}},[e._v("Stop")]),e._v(" "),a("el-dropdown-item",{attrs:{disabled:t.row.inCluster},nativeOn:{click:function(a){return e.handleRestart(t.row)}}},[e._v("Restart")]),e._v(" "),a("el-dropdown-item",{attrs:{disabled:t.row.runStatus},nativeOn:{click:function(a){return e.handleDelete(t.row)}}},[e._v("Delete")])],1)],1)]}}],null,!1,1853993286)}):e._e()],1)],1)]),e._v(" "),e.replicateOfVisible?a("el-dialog",{attrs:{title:"Master Node List",visible:e.replicateOfVisible,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.replicateOfVisible=t}}},[a("el-table",{attrs:{data:e.redisNodeList.filter(function(e){return e.inCluster}),stripe:"",size:"medium","default-sort":{prop:"slotRange",order:"ascending"}}},[a("el-table-column",{attrs:{label:"Link State",sortable:"",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.slot)+"\n          "),"connected"==t.row.linkState?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(t.row.linkState))]):a("el-tag",{staticClass:"pointer",attrs:{size:"small",type:"warning"}},[e._v(e._s(t.row.linkState))])]}}],null,!1,1084991063)}),e._v(" "),a("el-table-column",{attrs:{label:"Flags",width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.flags))])]}}],null,!1,221223753)}),e._v(" "),a("el-table-column",{attrs:{label:"Replica",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.row.replicaNumber))])]}}],null,!1,1276046101)}),e._v(" "),a("el-table-column",{attrs:{label:"In Cluster",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.inCluster?a("i",{staticClass:"el-icon-success status-icon normal-status"}):a("i",{staticClass:"el-icon-error status-icon normal-bad"})]}}],null,!1,1353933945)}),e._v(" "),a("el-table-column",{attrs:{label:"Run Status",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.runStatus?a("i",{staticClass:"el-icon-success status-icon normal-status"}):a("i",{staticClass:"el-icon-error status-icon normal-bad"})]}}],null,!1,2493321961)}),e._v(" "),a("el-table-column",{attrs:{prop:"host",label:"Host",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"port",label:"Port",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"slotRange",label:"Slot Range",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"time",label:"Time",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{label:"Operation",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary",disabled:(e.operationNode.nodeId==t.row.nodeId||e.operationNode.masterId==t.row.nodeId)&&e.operationNode.inCluster},on:{click:function(a){return e.replicateOf(t.row.nodeId)}}},[e._v("Replicate Of")])]}}],null,!1,2727245630)})],1)],1):e._e(),e._v(" "),e.failOverVisible?a("el-dialog",{attrs:{title:"Fail Over",visible:e.failOverVisible,width:"30%"},on:{"update:visible":function(t){e.failOverVisible=t}}},[a("span",[e._v(e._s(e.operationNode.host)+":"+e._s(e.operationNode.port)+" will become the master")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.failOverVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(t){return e.failOver()}}},[e._v("Fail Over")])],1)]):e._e(),e._v(" "),e.importNodeVisible?a("el-dialog",{attrs:{title:"Import New Node",visible:e.importNodeVisible,"close-on-click-modal":!1,width:"30%"},on:{"update:visible":function(t){e.importNodeVisible=t}}},[a("el-form",{ref:"newRedisNode",attrs:{model:e.newRedisNode,size:"small"}},[a("el-form-item",{attrs:{label:"Redis Node",prop:"address",rules:e.rules.redisNode}},[a("el-input",{model:{value:e.newRedisNode.address,callback:function(t){e.$set(e.newRedisNode,"address",t)},expression:"newRedisNode.address"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.importNodeVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.importNode("newRedisNode")}}},[e._v("Confirm")])],1)],1):e._e(),e._v(" "),a("el-dialog",{attrs:{title:"Edit Config",visible:e.editConfigVisible,"close-on-click-modal":!1,width:"30%"},on:{"update:visible":function(t){e.editConfigVisible=t}}},[a("el-form",{ref:"redisConfig",attrs:{model:e.redisConfig,size:"small","label-position":"top"}},[a("el-form-item",{attrs:{label:"Config Key",prop:"configKey",rules:e.rules.configKey}},[a("el-select",{attrs:{filterable:"","allow-create":"","default-first-option":"",placeholder:"Please select config key"},on:{change:function(t){return e.getConfigCurrentValue(e.redisConfig)}},model:{value:e.redisConfig.configKey,callback:function(t){e.$set(e.redisConfig,"configKey",t)},expression:"redisConfig.configKey"}},e._l(e.configKeyList,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"Config Value",prop:"configValue"}},[a("el-input",{model:{value:e.redisConfig.configValue,callback:function(t){e.$set(e.redisConfig,"configValue",t)},expression:"redisConfig.configValue"}})],1),e._v(" "),e._l(e.nodeConfigList,function(t){return a("p",{key:t.redisNode},[a("span",{staticStyle:{color:"#606266"}},[e._v(e._s(t.redisNode))]),e._v(" "),a("span",[a("b",[e._v(e._s(t.configValue))])])])})],2),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.editConfigVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.editConfig("redisConfig")}}},[e._v("Confirm")])],1)],1),e._v(" "),e.forgetVisible?a("el-dialog",{attrs:{title:"Forget Node",visible:e.forgetVisible,width:"30%"},on:{"update:visible":function(t){e.forgetVisible=t}}},[a("span",[e._v(e._s(e.operationNode.host)+":"+e._s(e.operationNode.port)+" will be forget")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.forgetVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(t){return e.forget()}}},[e._v("Forget")])],1)]):e._e(),e._v(" "),e.moveSlotVisible?a("el-dialog",{attrs:{title:"Move Slot",visible:e.moveSlotVisible,"close-on-click-modal":!1,width:"30%"},on:{"update:visible":function(t){e.moveSlotVisible=t}}},[a("el-form",{ref:"slotRange",attrs:{model:e.slotRange,size:"small"}},[a("el-form-item",{attrs:{prop:"startSlot",label:"Start Slot",rules:e.rules.startSlot}},[a("el-input",{model:{value:e.slotRange.startSlot,callback:function(t){e.$set(e.slotRange,"startSlot",e._n(t))},expression:"slotRange.startSlot"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"endSlot",label:"End Slot",rules:e.rules.endSlot}},[a("el-input",{model:{value:e.slotRange.endSlot,callback:function(t){e.$set(e.slotRange,"endSlot",e._n(t))},expression:"slotRange.endSlot"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.moveSlotVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.moveSlot("slotRange")}}},[e._v("Confirm")])],1)],1):e._e(),e._v(" "),a("el-dialog",{attrs:{title:"Start Node",visible:e.startNodeVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.startNodeVisible=t}}},[a("span",[e._v(e._s(e.operationNode.host)+":"+e._s(e.operationNode.port)+" will be start")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.startNodeVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.startNode()}}},[e._v("Start")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"Stop Node",visible:e.stopNodeVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.stopNodeVisible=t}}},[a("span",[e._v(e._s(e.operationNode.host)+":"+e._s(e.operationNode.port)+" will be stop")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.stopNodeVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.stopNode()}}},[e._v("Stop")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"Restart Node",visible:e.restartNodeVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.restartNodeVisible=t}}},[a("span",[e._v(e._s(e.operationNode.host)+":"+e._s(e.operationNode.port)+" will be restart")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.restartNodeVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.restartNode()}}},[e._v("Restart")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"Delete Node",visible:e.deleteNodeVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.deleteNodeVisible=t}}},[a("span",[e._v(e._s(e.operationNode.host)+":"+e._s(e.operationNode.port)+" will be delete")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteNodeVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteNode()}}},[e._v("Delete")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"Init Slot",visible:e.initSlotsVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.initSlotsVisible=t}}},[a("p",[e._v("\n      Cluster Slots All:\n      "),a("b",[e._v("16384")])]),e._v(" "),a("p",[e._v("\n      Cluster Slots Assigned:\n      "),a("b",[e._v(e._s(e.cluster.clusterSlotsAssigned))])]),e._v(" "),a("p",[e._v("\n      Cluster Slots Ok:\n      "),a("b",[e._v(e._s(e.cluster.clusterSlotsOk))])]),e._v(" "),a("p",[e._v("\n      Cluster Slots Pfail:\n      "),a("b",[e._v(e._s(e.cluster.clusterSlotsPfail))])]),e._v(" "),a("p",[e._v("\n      Cluster Slots Fail:\n      "),a("b",[e._v(e._s(e.cluster.clusterSlotsFail))])]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.initSlots()}}},[e._v("Init")])],1)]),e._v(" "),e.infoVisible?a("el-dialog",{attrs:{title:"Info - "+e.operationNode.host+":"+e.operationNode.port,visible:e.infoVisible,width:"50%","close-on-click-modal":!1,top:"5vh"},on:{"update:visible":function(t){e.infoVisible=t}}},[a("info",{attrs:{redisNode:e.operationNode}})],1):e._e(),e._v(" "),e.configVisible?a("el-dialog",{attrs:{title:"Config - "+e.operationNode.host+":"+e.operationNode.port,visible:e.configVisible,width:"50%","close-on-click-modal":!1,top:"5vh"},on:{"update:visible":function(t){e.configVisible=t}}},[a("config",{attrs:{redisNode:e.operationNode}})],1):e._e(),e._v(" "),e.sentinelMasterInfoVisible?a("el-dialog",{attrs:{title:"Sentinel Master Info",visible:e.sentinelMasterInfoVisible,"close-on-click-modal":!1,width:"40%"},on:{"update:visible":function(t){e.sentinelMasterInfoVisible=t}}},[a("sentinelMasterInfo",{attrs:{sentinelMaster:e.sentinelMaster}})],1):e._e(),e._v(" "),e.sentinelMasterSlavesVisible?a("el-dialog",{attrs:{title:"Sentinel Master Slaves",visible:e.sentinelMasterSlavesVisible,"close-on-click-modal":!1,width:"40%"},on:{"update:visible":function(t){e.sentinelMasterSlavesVisible=t}}},[a("sentinelMasterSlaves",{attrs:{sentinelMaster:e.sentinelMaster}})],1):e._e(),e._v(" "),e.sentinelMasterEditVisible?a("el-dialog",{attrs:{title:"Sentinel Master Edit",visible:e.sentinelMasterEditVisible,"close-on-click-modal":!1,width:"40%"},on:{"update:visible":function(t){e.sentinelMasterEditVisible=t}}},[a("div",[a("el-form",{ref:"sentinelMaster",attrs:{model:e.sentinelMaster,rules:e.rules,"label-width":"200px",size:"small"}},[a("el-form-item",{attrs:{label:"Master Name",prop:"name"}},[e.isUpdateSentinelMaster?a("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.sentinelMaster.name))]):a("el-input",{attrs:{maxlength:"30","show-word-limit":""},model:{value:e.sentinelMaster.name,callback:function(t){e.$set(e.sentinelMaster,"name",t)},expression:"sentinelMaster.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Redis Node",prop:"redisNode"}},[e.isUpdateSentinelMaster?a("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.sentinelMaster.host)+":"+e._s(e.sentinelMaster.port))]):a("el-input",{model:{value:e.sentinelMaster.redisNode,callback:function(t){e.$set(e.sentinelMaster,"redisNode",t)},expression:"sentinelMaster.redisNode"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Quorum",prop:"quorum"}},[a("el-input",{model:{value:e.sentinelMaster.quorum,callback:function(t){e.$set(e.sentinelMaster,"quorum",e._n(t))},expression:"sentinelMaster.quorum"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Down After Milliseconds",prop:"downAfterMilliseconds"}},[a("el-input",{model:{value:e.sentinelMaster.downAfterMilliseconds,callback:function(t){e.$set(e.sentinelMaster,"downAfterMilliseconds",e._n(t))},expression:"sentinelMaster.downAfterMilliseconds"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Parallel Syncs",prop:"parallelSyncs"}},[a("el-input",{model:{value:e.sentinelMaster.parallelSyncs,callback:function(t){e.$set(e.sentinelMaster,"parallelSyncs",e._n(t))},expression:"sentinelMaster.parallelSyncs"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Failover Timeout",prop:"failoverTimeout"}},[a("el-input",{model:{value:e.sentinelMaster.failoverTimeout,callback:function(t){e.$set(e.sentinelMaster,"failoverTimeout",e._n(t))},expression:"sentinelMaster.failoverTimeout"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Auth Pass",prop:"authPass"}},[a("el-input",{model:{value:e.sentinelMaster.authPass,callback:function(t){e.$set(e.sentinelMaster,"authPass",t)},expression:"sentinelMaster.authPass"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.isUpdateSentinelMaster?a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.updateSentinelMaster("sentinelMaster")}}},[e._v("Update")]):a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.monitorMaster("sentinelMaster")}}},[e._v("Confirm")])],1)],1)]):e._e(),e._v(" "),a("el-dialog",{attrs:{title:"Delete Sentinel Master",visible:e.deleteSentinelMasterVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.deleteSentinelMasterVisible=t}}},[a("span",[e._v(e._s(e.sentinelMaster.host)+":"+e._s(e.sentinelMaster.port)+" will be not monitored")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteSentinelMasterVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteSentinelMaster()}}},[e._v("Delete")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"Failover Sentinel Master",visible:e.failoverSentinelMasterVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.failoverSentinelMasterVisible=t}}},[a("span",[e._v(e._s(e.sentinelMaster.host)+":"+e._s(e.sentinelMaster.port)+" will failover")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.failoverSentinelMasterVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.failoverSentinelMaster()}}},[e._v("Failover")])],1)])],1)},staticRenderFns:[]},!1,function(e){a("kBQB")},"data-v-144328f6",null).exports,Y=a("pFYg"),X=a.n(Y),ee={data:function(){var e=this,t=function(e,t,a){if(t<=0)return a(new Error("Number must be greater than 0"));a()};return{dockerImages:[],machineImages:[],humpbackImages:[],installationParam:{groupId:"",clusterName:"",redisPassword:"",redisMode:"cluster",image:"",create:!0,machineIdList:[],machineList:[{ip:""},{ip:""}],autoBuild:!0,autoInit:!1,sudo:!0,machineUserName:"",machinePassword:"",redisNodes:"127.0.0.1:8001 master\n127.0.0.1:8002",installationEnvironment:0},installationInfoVisible:!1,installationConsole:"Prepare to install redis...",rules:{clusterName:[{required:!0,validator:function(e,t,a){if(o(t)||o(t.trim()))return a(new Error("Please enter cluster name"));var r="/cluster/validateClusterName/"+t;vt.get(r,null,function(e){var r=e.data;if(0!=r.code)return r.data,a(new Error(t+" has exist"));a()},function(e){return a(new Error("Network error, "+e))})},trigger:"blur"},{required:!0,validator:function(e,t,a){if(o(t)||o(t.trim()))return a(new Error("Please enter cluster name"));var r="/installation/validateClusterName/"+t;vt.get(r,null,function(e){var r=e.data;if(0!=r.code)return r.data,a(new Error(t+" is being installed"));a()},function(e){return a(new Error("Network error, "+e))})},trigger:"blur"}],redisMode:[{required:!0,message:"Please select redis mode",trigger:"change"}],installationEnvironment:[{required:!0,message:"Please select installation environment",trigger:"change"}],image:[{required:!0,message:"Please select image",trigger:"change"}],machines:[{required:!0,message:"Please select machines",trigger:"change"}],startPort:[{required:!0,message:"Please enter start port",trigger:"blur"},{required:!0,validator:function(e,t,a){if(!/^([0-9]|[1-9]\d|[1-9]\d{2}|[1-9]\d{3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$/.test(t))return a(new Error("Incorrect port format"));a()},trigger:"blur"}],masterNumber:[{required:!0,message:"Please eneter master number",trigger:"blur"},{type:"number",message:"Please enter integer",trigger:"blur"},{required:!0,validator:t,trigger:"blur"},{required:!0,validator:function(t,a,r){if("standalone"==e.installationParam.redisMode&&a>1)return r(new Error("Standalone mode only need 1 master"));r()},trigger:"blur"}],replicaNumber:[{required:!0,message:"Please eneter replica number",trigger:"blur"},{type:"number",message:"Please enter integer",trigger:"blur"},{required:!0,validator:t,trigger:"blur"}],machineUserName:[{required:!0,message:"Please enter machine user name",trigger:"blur"}],machinePassword:[{required:!0,message:"Please enter machine password",trigger:"blur"}],redisNodes:[{required:!0,message:"Please enter redis topology",trigger:"blur"},{required:!0,validator:function(t,a,r){var s=a.trim();if(o(s))return r(new Error("Please enter topology"));var n=e.installationParam.machineUserName,i=e.installationParam.machinePassword;if(o(n)||o(i))return r(new Error("Please enter machine user name and password first"));for(var l=s.split(/[(\r\n)\r\n]+/),u=l.length,c=[],p=[],m=function(){var t=l[f].split(/\s+/),a=t.length;if(0==f){if(2!=a)return{v:r(new Error("Line "+(f+1)+": wrong format"))};if("master"!=t[1])return{v:r(new Error("Line "+(f+1)+": node not master"))}}if(0!=f&&"standalone"==e.installationParam.redisMode&&"master"==t[1])return{v:r(new Error("Line "+(f+1)+": standalone mode only need one master"))};var s=t[1];o(s)&&(s="slave");var u=t[0].split(":");if(d(u))return{v:r(new Error("Line "+(f+1)+": wrong format"))};var m=u[0],v=u[1],h={userName:n,password:i,host:m},g=!1;c.forEach(function(e){e.host!=m||(g=!0)}),g||c.push(h);var b=!1;if(p.forEach(function(e){e.host==m&&e.port==v&&(b=!0)}),b)return{v:r(new Error("Line "+(f+1)+": redis node repeat"))};p.push({host:m,port:v,nodeRole:s.toLocaleUpperCase()})},f=0;f<u;f++){var v=m();if("object"===(void 0===v?"undefined":X()(v)))return v.v}e.installationParam.machineList=c,e.installationParam.redisNodeList=p,r()},trigger:"blur"}]},allMachineList:[],step:-1,installationLoading:!1,humpbackEnabled:!1,logTimer:null,isInstallationStart:!1}},methods:{handleMachine:function(e){e.forEach(function(e){})},buildMachineIdList:function(){var e=this;this.installationParam.machineIdList=[],this.installationParam.machines.forEach(function(t){e.installationParam.machineIdList.push(t[1])})},buildParam:function(){var e=this.installationParam;e.autoBuild&&this.buildMachineIdList();var t={groupId:this.currentGroup.groupId,userId:yt.getters.getUserId,clusterName:e.clusterName,redisPassword:e.redisPassword,redisMode:e.redisMode,installationEnvironment:e.installationEnvironment,image:e.image,clusterInfo:e.clusterInfo};this.installationParam.cluster=t},installationCheck:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.buildParam(),t.isInstallationStart=!0,t.install()})},install:function(){var e=this;this.installationLoading=!0,this.step=0,vt.post("/installation/installFlow",this.installationParam,function(t){0==t.data.code?e.$router.push({name:"dashboard",params:{groupId:e.currentGroup.groupId}}):v.error("Install failed"),e.installationLoading=!1},function(t){e.installationLoading=!1,v.error(t)})},getDockerImageList:function(){var e=this;vt.get("/installation/getDockerImages",null,function(t){var a=t.data;0==a.code?e.dockerImages=a.data:v.error(a.message)},function(e){v.error(e)})},getMachineImageList:function(){var e=this;vt.get("/installation/getMachineImages",null,function(t){var a=t.data;0==a.code?e.machineImages=a.data:v.error(a.message)},function(e){v.error(e)})},getHumpbackImageList:function(){var e=this;vt.get("/installation/getHumpbackImages",null,function(t){var a=t.data;0==a.code?e.humpbackImages=a.data:v.error(a.message)},function(e){v.error(e)})},getMachineList:function(e){var t=this;if(!o(e)){var a="/machine/getHierarchyMachineList/"+e;vt.get(a,null,function(e){var a=e.data;if(0==a.code){var r=a.data;r.forEach(function(e){var a=e.machineGroupName;e.label=a,e.value=a,e.children.forEach(function(e){e.label=e.host,e.value=e.machineId}),t.allMachineList=r})}else v.error(a.message)},function(e){v.error(e)})}},validateMachine:function(e,t){},getHumpbackEnabled:function(){var e=this;vt.get("/system/humpbackEnabled",null,function(t){var a=t.data.data;a&&(e.humpbackEnabled=a,e.getHumpbackImageList())},function(e){v.error(e)})},getLogs:function(){var e=this;if(this.isInstallationStart){var t="/installation/getInstallationLogs/"+this.installationParam.cluster.clusterName;vt.get(t,null,function(t){var a=t.data.data;0!=a.length&&a.forEach(function(t){o(t)||(t.indexOf("Start preparing installation")>-1?e.step=0:t.indexOf("Start pulling redis.conf")>-1?e.step=1:t.indexOf("Start pulling image")>-1?e.step=2:t.indexOf("Start installing redis node")>-1?e.step=3:t.indexOf("Start initializing")>-1?e.step=4:t.indexOf("Start saving to database")>-1&&(e.step=5),e.installationConsole+=" \n ",e.installationConsole+=t)})},function(e){v.error(e)})}}},computed:{currentGroup:function(){return yt.getters.getCurrentGroup},installationEnvironmentList:function(){return yt.getters.getInstallationEnvironmentList}},watch:{"installationParam.autoBuild":function(e,t){this.$refs.installationParam.fields.map(function(e){if("startPort"===e.prop||"masterNumber"===e.prop||"replicaNumber"===e.prop||"machineUserName"===e.prop||"machinePassword"===e.prop||"topology"===e.prop||"machines"===e.prop)return e.resetField(),!1})},"installationParam.installationEnvironment":function(e,t){this.$refs.installationParam.fields.map(function(e){if("image"===e.prop)return e.resetField(),!1})},currentGroup:function(e){var t=e.groupId;this.$router.push({name:"installation",params:{groupId:t}}),this.getMachineList(t)}},mounted:function(){var e=this;this.getDockerImageList(),this.getMachineImageList();var t=this.currentGroup.groupId;this.getMachineList(t),this.getHumpbackEnabled(),null==this.logTimer&&(this.logTimer=setInterval(function(){e.getLogs()},1e3))},created:function(){clearInterval(this.logTimer),this.logTimer=null},beforeDestroy:function(){clearInterval(this.logTimer),this.logTimer=null}},te=a("VU/8")(ee,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"body-wrapper",attrs:{id:"installation"}},[a("div",{staticClass:"step-wrapper"},[a("el-steps",{attrs:{active:e.step,"finish-status":"success"}},[a("el-step",{attrs:{title:"Environment Check"}}),e._v(" "),a("el-step",{attrs:{title:"Pull Config",description:""}}),e._v(" "),a("el-step",{attrs:{title:"Pull Image",description:""}}),e._v(" "),a("el-step",{attrs:{title:"Install",description:""}}),e._v(" "),a("el-step",{attrs:{title:"Init",description:""}}),e._v(" "),a("el-step",{attrs:{title:"Finish",description:""}})],1)],1),e._v(" "),a("el-row",[a("el-col",{directives:[{name:"loading",rawName:"v-loading",value:e.installationLoading,expression:"installationLoading"}],attrs:{xl:12,lg:12,md:24,sm:24}},[a("div",{staticClass:"form-wrapper"},[a("div",{staticClass:"form"},[a("el-form",{ref:"installationParam",staticClass:"demo-ruleForm",attrs:{model:e.installationParam,rules:e.rules,"label-width":"150px",size:"small"}},[a("el-form-item",{attrs:{label:"Group Name",prop:"groupName"}},[a("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.currentGroup.groupName))])],1),e._v(" "),a("el-form-item",{attrs:{label:"Cluster Name",prop:"clusterName"}},[a("el-input",{attrs:{maxlength:"50","show-word-limit":""},model:{value:e.installationParam.clusterName,callback:function(t){e.$set(e.installationParam,"clusterName",t)},expression:"installationParam.clusterName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Redis Password",prop:"redisPassword"}},[a("el-input",{attrs:{maxlength:"50","show-word-limit":""},model:{value:e.installationParam.redisPassword,callback:function(t){e.$set(e.installationParam,"redisPassword","string"==typeof t?t.trim():t)},expression:"installationParam.redisPassword"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Redis Mode",prop:"redisMode"}},[a("el-radio-group",{model:{value:e.installationParam.redisMode,callback:function(t){e.$set(e.installationParam,"redisMode",t)},expression:"installationParam.redisMode"}},[a("el-radio",{attrs:{label:"cluster"}},[e._v("Cluster")]),e._v(" "),a("el-radio",{attrs:{label:"standalone"}},[e._v("Standalone")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"Environment",prop:"installationEnvironment"}},[a("el-radio-group",{model:{value:e.installationParam.installationEnvironment,callback:function(t){e.$set(e.installationParam,"installationEnvironment",t)},expression:"installationParam.installationEnvironment"}},e._l(e.installationEnvironmentList,function(t){return a("el-radio",{key:t.type,attrs:{label:t.type}},[e._v(e._s(t.name))])}),1)],1),e._v(" "),0==e.installationParam.installationEnvironment?a("el-form-item",{attrs:{label:"Image",prop:"image"}},[a("el-select",{attrs:{"allow-create":"",filterable:"",placeholder:"Please choose image"},model:{value:e.installationParam.image,callback:function(t){e.$set(e.installationParam,"image","string"==typeof t?t.trim():t)},expression:"installationParam.image"}},e._l(e.dockerImages,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1):1==e.installationParam.installationEnvironment?a("el-form-item",{attrs:{label:"Image",prop:"image"}},[a("el-select",{attrs:{placeholder:"Please choose image"},model:{value:e.installationParam.image,callback:function(t){e.$set(e.installationParam,"image","string"==typeof t?t.trim():t)},expression:"installationParam.image"}},e._l(e.machineImages,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1):e._e(),e._v(" "),3==e.installationParam.installationEnvironment?a("el-form-item",{attrs:{label:"Image",prop:"image"}},[a("el-select",{attrs:{"allow-create":"",filterable:"",placeholder:"Please choose image"},model:{value:e.installationParam.image,callback:function(t){e.$set(e.installationParam,"image","string"==typeof t?t.trim():t)},expression:"installationParam.image"}},e._l(e.humpbackImages,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"Auto Build",prop:"autoBuild"}},[a("el-switch",{model:{value:e.installationParam.autoBuild,callback:function(t){e.$set(e.installationParam,"autoBuild",t)},expression:"installationParam.autoBuild"}})],1),e._v(" "),e.installationParam.autoBuild?a("el-form-item",{attrs:{label:"Machine List",prop:"machines"}},[a("div",{staticClass:"block"},[a("el-cascader",{attrs:{placeholder:"Search",options:e.allMachineList,props:{multiple:!0},filterable:"",leafOnly:!0},on:{change:e.handleMachine},model:{value:e.installationParam.machines,callback:function(t){e.$set(e.installationParam,"machines",t)},expression:"installationParam.machines"}})],1)]):e._e(),e._v(" "),e.installationParam.autoBuild?a("el-form-item",{attrs:{label:"Start Port",prop:"startPort"}},[a("el-input",{model:{value:e.installationParam.startPort,callback:function(t){e.$set(e.installationParam,"startPort",e._n(t))},expression:"installationParam.startPort"}})],1):e._e(),e._v(" "),e.installationParam.autoBuild?a("el-form-item",{attrs:{label:"Master Number",prop:"masterNumber"}},[a("el-input",{model:{value:e.installationParam.masterNumber,callback:function(t){e.$set(e.installationParam,"masterNumber",e._n(t))},expression:"installationParam.masterNumber"}})],1):e._e(),e._v(" "),e.installationParam.autoBuild?a("el-form-item",{attrs:{label:"Replica Number",prop:"replicaNumber"}},[a("el-input",{model:{value:e.installationParam.replicaNumber,callback:function(t){e.$set(e.installationParam,"replicaNumber",e._n(t))},expression:"installationParam.replicaNumber"}})],1):e._e(),e._v(" "),e.installationParam.autoBuild?e._e():a("el-form-item",{attrs:{label:"Machine User",prop:"machineUserName"}},[a("el-input",{attrs:{placeholder:"Machine user name"},model:{value:e.installationParam.machineUserName,callback:function(t){e.$set(e.installationParam,"machineUserName","string"==typeof t?t.trim():t)},expression:"installationParam.machineUserName"}})],1),e._v(" "),e.installationParam.autoBuild?e._e():a("el-form-item",{attrs:{label:"Machine Password",prop:"machinePassword"}},[a("el-input",{attrs:{placeholder:"Machine password"},model:{value:e.installationParam.machinePassword,callback:function(t){e.$set(e.installationParam,"machinePassword","string"==typeof t?t.trim():t)},expression:"installationParam.machinePassword"}})],1),e._v(" "),e.installationParam.autoBuild?e._e():a("el-form-item",{attrs:{label:"Topology",prop:"redisNodes"}},[a("el-input",{staticClass:"textarea",attrs:{type:"textarea",autosize:{minRows:2,maxRows:500},placeholder:"Please enter redis node list"},model:{value:e.installationParam.redisNodes,callback:function(t){e.$set(e.installationParam,"redisNodes",t)},expression:"installationParam.redisNodes"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Sudo",prop:"sudo"}},[a("el-switch",{model:{value:e.installationParam.sudo,callback:function(t){e.$set(e.installationParam,"sudo",t)},expression:"installationParam.sudo"}}),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"Whether to use sudo during the installation operation",placement:"top-start"}},[a("i",{staticClass:"el-icon-info info"})])],1),e._v(" "),a("el-form-item",{attrs:{label:"Cluster Info",prop:"clusterInfo"}},[a("el-input",{attrs:{type:"input"},model:{value:e.installationParam.clusterInfo,callback:function(t){e.$set(e.installationParam,"clusterInfo",t)},expression:"installationParam.clusterInfo"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"success"},on:{click:function(t){return e.installationCheck("installationParam")}}},[e._v("Install")])],1)],1)],1)])]),e._v(" "),a("el-col",{attrs:{xl:12,lg:12,md:24,sm:24}},[a("div",{staticClass:"console-wrapper"},[a("div",{staticClass:"console-title"},[e._v("Redis Installation Console")]),e._v(" "),a("pre",{staticClass:"console"},[e._v(e._s(e.installationConsole))])])])],1)],1)},staticRenderFns:[]},!1,function(e){a("I1Y8")},"data-v-e12b3b6a",null).exports,ae={data:function(){return{alertChannelList:[],alertChannel:{},editVisible:!1,isUpdate:!1,deleteVisible:!1,rules:{channelName:[{required:!0,message:"Channel name can't be empty",trigger:"blur"}],smtpHost:[{required:!0,message:"SMTP host can't be empty",trigger:"blur"}],emailFrom:[{required:!0,message:"Email from can't be empty",trigger:"blur"},{required:!0,validator:function(e,t,a){if(!u(t))return a(new Error("Incorrect email format"));a()},trigger:"blur"}],emailTo:[{required:!0,message:"Email to can't be empty",trigger:"blur"}],webhook:[{required:!0,message:"Web hook can't be empty",trigger:"blur"},{required:!0,validator:function(e,t,a){if(!function(e){return/^(https?|ftp):\/\/([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/.test(e)}(t))return a(new Error("Incorrect url format"));a()},trigger:"blur"}],corpId:[{required:!0,message:"Corp id can't be empty",trigger:"blur"}],agentId:[{required:!0,message:"Agent id can't be empty",trigger:"blur"}],corpSecret:[{required:!0,message:"Corp Secret can't be empty",trigger:"blur"}]},saveAlertChannelLoading:!1}},methods:{handleView:function(e,t){},editChannel:function(e,t){this.getAlertChannel(t.channelId),this.isUpdate=!0,this.editVisible=!0},handleDelete:function(e,t){this.alertChannel.channelId=t.channelId,this.deleteVisible=!0},deleteChannel:function(){var e=this;this.alertChannel.groupId=this.currentGroup.groupId,vt.post("/alert/channel/deleteAlertChannel",this.alertChannel,function(t){0==t.data.code?(e.getChannelList(e.currentGroup.groupId),e.deleteVisible=!1,e.alertChannel={channelType:0}):v.error("Delete alert channel failed")},function(e){v.error(e)})},getChannelList:function(e){var t=this,a="/alert/channel/getAlertChannel/group/"+e;vt.get(a,null,function(e){var a=e.data;if(0==a.code){var r=a.data;r.forEach(function(e){e.time=y(e.updateTime)}),t.alertChannelList=r}else v.error("Get alert channel list failed")},function(e){v.error(e)})},getAlertChannel:function(e){var t=this,a="/alert/channel/getAlertChannel/"+e;vt.get(a,null,function(e){var a=e.data;0==a.code?t.alertChannel=a.data:v.error("Get alert channel faild")},function(e){v.error(e)})},saveChannel:function(e){var t=this;this.$refs[e].validate(function(a){if(a){var r;r=t.isUpdate?"/alert/channel/updateAlertChannel":"/alert/channel/addAlertChannel",t.alertChannel.groupId=t.currentGroup.groupId,t.saveAlertChannelLoading=!0,vt.post(r,t.alertChannel,function(a){0==a.data.code?(t.getChannelList(t.currentGroup.groupId),t.editVisible=!1,t.$refs[e].resetFields()):v.error("Save alert channel failed."),t.saveAlertChannelLoading=!1},function(e){t.saveAlertChannelLoading=!1,v.error(e)})}})}},computed:{currentGroup:function(){return yt.getters.getCurrentGroup}},watch:{"alertChannel.channelType":function(e,t){this.$refs.alertChannel.fields.map(function(e){return"channelName"===e.prop||"channelType"===e.prop||"channelInfo"===e.prop||(e.resetField(),!0)})},currentGroup:function(e){this.getChannelList(e.groupId)}},mounted:function(){var e=this.currentGroup.groupId;this.getChannelList(e)}},re=a("VU/8")(ae,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"body-wrapper",attrs:{id:"channel-manage"}},[a("div",{staticClass:"header-wrapper"},[a("div",[e._v(e._s(e.currentGroup.groupName))]),e._v(" "),a("div",[a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){e.editVisible=!0,e.isUpdate=!1,e.alertChannel={}}}},[e._v("Create")])],1)]),e._v(" "),a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.alertChannelList}},[a("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"channelName",label:"Channel Name",width:"150px;"}}),e._v(" "),a("el-table-column",{attrs:{label:"Channel Type",width:"200px;"},scopedSlots:e._u([{key:"default",fn:function(t){return["0"==t.row.channelType?a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("p",[a("span",{staticClass:"label-color"},[e._v("Email From:")]),e._v("\n              "+e._s(t.row.emailFrom)+"\n            ")]),e._v(" "),a("p",[a("span",{staticClass:"label-color"},[e._v("Email To:")]),e._v("\n              "+e._s(t.row.emailTo)+"\n            ")]),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{size:"small",type:"success"}},[e._v("Email")])],1)]):e._e(),e._v(" "),"1"==t.row.channelType?a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("p",[a("span",{staticClass:"label-color"},[e._v("Web Hook:")]),e._v("\n              "+e._s(t.row.webhook)+"\n            ")]),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{size:"small",type:"success"}},[e._v("WebChat Webhook")])],1)]):e._e(),e._v(" "),"2"==t.row.channelType?a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("p",[a("span",{staticClass:"label-color"},[e._v("Web Hook:")]),e._v("\n              "+e._s(t.row.webhook)+"\n            ")]),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{size:"small",type:"primary"}},[e._v("DingDing Webhook")])],1)]):e._e(),e._v(" "),"3"==t.row.channelType?a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("p",[a("span",{staticClass:"label-color"},[e._v("Corp ID:")]),e._v("\n              "+e._s(t.row.corpId)+"\n            ")]),e._v(" "),a("p",[a("span",{staticClass:"label-color"},[e._v("Agent ID:")]),e._v("\n              "+e._s(t.row.agentId)+"\n            ")]),e._v(" "),a("p",[a("span",{staticClass:"label-color"},[e._v("Corp Secret:")]),e._v("\n              "+e._s(t.row.corpSecret)+"\n            ")]),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{size:"small",type:"success"}},[e._v("WebChat App")])],1)]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"channelInfo",label:"Info"}}),e._v(" "),a("el-table-column",{attrs:{prop:"time",label:"Time"}}),e._v(" "),a("el-table-column",{attrs:{label:"Operation",width:"200px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.editChannel(t.$index,t.row)}}},[e._v("Edit")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("Delete")])]}}])})],1)],1),e._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.saveAlertChannelLoading,expression:"saveAlertChannelLoading"}],attrs:{title:"Edit Channel",visible:e.editVisible,width:"60%","close-on-click-modal":!1},on:{"update:visible":function(t){e.editVisible=t}}},[a("el-form",{ref:"alertChannel",attrs:{model:e.alertChannel,rules:e.rules,"label-width":"135px"}},[a("el-form-item",{attrs:{label:"Channel Name",prop:"channelName"}},[a("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.channelName,callback:function(t){e.$set(e.alertChannel,"channelName",t)},expression:"alertChannel.channelName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Channel Type",prop:"channelType"}},[a("el-radio-group",{attrs:{size:"medium"},model:{value:e.alertChannel.channelType,callback:function(t){e.$set(e.alertChannel,"channelType","string"==typeof t?t.trim():t)},expression:"alertChannel.channelType"}},[a("el-radio",{attrs:{label:0}},[e._v("Email")]),e._v(" "),a("el-radio",{attrs:{label:1}},[e._v("Wechat Web Hook")]),e._v(" "),a("el-radio",{attrs:{label:2}},[e._v("DingDing Web Hook")]),e._v(" "),a("el-radio",{attrs:{label:3}},[e._v("Wechat App")])],1)],1),e._v(" "),0==e.alertChannel.channelType?a("div",[a("el-form-item",{attrs:{label:"SMTP Host",prop:"smtpHost"}},[a("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.smtpHost,callback:function(t){e.$set(e.alertChannel,"smtpHost","string"==typeof t?t.trim():t)},expression:"alertChannel.smtpHost"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Email User Name",prop:"emailUserName"}},[a("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.emailUserName,callback:function(t){e.$set(e.alertChannel,"emailUserName","string"==typeof t?t.trim():t)},expression:"alertChannel.emailUserName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Email Password",prop:"emailPassword"}},[a("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.emailPassword,callback:function(t){e.$set(e.alertChannel,"emailPassword","string"==typeof t?t.trim():t)},expression:"alertChannel.emailPassword"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Email From",prop:"emailFrom"}},[a("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.emailFrom,callback:function(t){e.$set(e.alertChannel,"emailFrom","string"==typeof t?t.trim():t)},expression:"alertChannel.emailFrom"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Email To",prop:"emailTo"}},[a("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.emailTo,callback:function(t){e.$set(e.alertChannel,"emailTo","string"==typeof t?t.trim():t)},expression:"alertChannel.emailTo"}})],1)],1):e._e(),e._v(" "),1==e.alertChannel.channelType||2==e.alertChannel.channelType?a("el-form-item",{attrs:{label:"Web Hook",prop:"webhook"}},[a("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.webhook,callback:function(t){e.$set(e.alertChannel,"webhook","string"==typeof t?t.trim():t)},expression:"alertChannel.webhook"}})],1):e._e(),e._v(" "),3==e.alertChannel.channelType?a("div",[a("el-form-item",{attrs:{label:"Corp Id",prop:"corpId"}},[a("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.corpId,callback:function(t){e.$set(e.alertChannel,"corpId","string"==typeof t?t.trim():t)},expression:"alertChannel.corpId"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Agent Id",prop:"agentId"}},[a("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.agentId,callback:function(t){e.$set(e.alertChannel,"agentId","string"==typeof t?t.trim():t)},expression:"alertChannel.agentId"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Corp Secret",prop:"corpSecret"}},[a("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.corpSecret,callback:function(t){e.$set(e.alertChannel,"corpSecret","string"==typeof t?t.trim():t)},expression:"alertChannel.corpSecret"}})],1)],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"Channel Info",prop:"channelInfo"}},[a("el-input",{attrs:{size:"small"},model:{value:e.alertChannel.channelInfo,callback:function(t){e.$set(e.alertChannel,"channelInfo",t)},expression:"alertChannel.channelInfo"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.isUpdate?a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveChannel("alertChannel")}}},[e._v("Update")]):a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveChannel("alertChannel")}}},[e._v("Confirm")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"Delete Alert Channel",visible:e.deleteVisible,width:"30%"},on:{"update:visible":function(t){e.deleteVisible=t}}},[a("span",[e._v("\n      Are you sure to delete\n      "),a("b",[e._v(e._s(e.alertChannel.channelName))]),e._v(" ?\n    ")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteChannel()}}},[e._v("Delete")])],1)])],1)},staticRenderFns:[]},!1,function(e){a("36zs")},"data-v-038d9fc0",null).exports,se={data:function(){return{alertRuleList:[],alertRule:{valid:!0,global:!1,clusterAlert:!1},editVisible:!1,isUpdate:!1,deleteVisible:!1,ruleKeyList:[{value:"used_memory",label:"used_memory(MB)"},{value:"used_memory_rss",label:"used_memory_rss(MB)"},{value:"used_memory_overhead",label:"used_memory_overhead(MB)"},{value:"used_memory_dataset",label:"used_memory_dataset(MB)"},{value:"fragmentation_ratio",label:"fragmentation_ratio(MB)"},{value:"connections_received",label:"connections_received"},{value:"rejected_connections",label:"rejected_connections"},{value:"connected_clients",label:"connected_clients"},{value:"blocked_clients",label:"blocked_clients"},{value:"commands_processed",label:"commands_processed"},{value:"instantaneous_ops_per_sec",label:"instantaneous_ops_per_sec"},{value:"sync_full",label:"sync_full"},{value:"sync_partial_ok",label:"sync_partial_ok"},{value:"sync_partial_err",label:"sync_partial_err"},{value:"keyspace_hits_ratio",label:"keyspace_hits_ratio"},{value:"keys",label:"keys"},{value:"expires",label:"expires"},{value:"cpu_sys",label:"cpu_sys"},{value:"cpu_user",label:"cpu_user"}],compareTypeList:[{value:1,label:">"},{value:-1,label:"<"},{value:0,label:"="},{value:2,label:"!="}],checkCycleList:[{value:5,label:"5 Min"},{value:10,label:"10 Min"},{value:15,label:"15 Min"},{value:30,label:"30 Min"},{value:60,label:"1 Hour"},{value:180,label:"3 Hour"},{value:360,label:"6 Hour"},{value:720,label:"12 Hour"},{value:1440,label:"1 day"}],rules:{ruleKey:[{required:!0,message:"Rule key can't be empty",trigger:"blur"}],compareType:[{required:!0,message:"Compare type can't be empty",trigger:"blur"}],ruleValue:[{required:!0,message:"Rule value can't be empty",trigger:"blur"}],checkCycle:[{required:!0,message:"Check cycle can't be empty",trigger:"blur"}]},saveAlertRuleLoading:!1}},methods:{handleView:function(e,t){},editAlertRule:function(e,t){this.getAlertRule(t.ruleId),this.isUpdate=!0,this.editVisible=!0},handleDelete:function(e,t){this.alertRule=t,this.deleteVisible=!0},createAlertRule:function(){this.editVisible=!0,this.isUpdate=!1,this.alertRule={valid:!0,global:!1,clusterAlert:!1}},getAlertRuleList:function(e){var t=this,a="/alert/rule/getAlertRule/group/"+e;vt.get(a,null,function(e){var a=e.data;if(0==a.code){var r=a.data;r.forEach(function(e){e.time=y(e.updateTime);var t=e.compareType;e.compareSign=0==t?"=":1==t?">":-1==t?"<":"!="}),t.alertRuleList=r}else v.error("Get alert rule list failed")},function(e){v.error(e)})},getAlertRule:function(e){var t=this,a="/alert/rule/getAlertRule/"+e;vt.get(a,null,function(e){var a=e.data;0==a.code?t.alertRule=a.data:v.error("Get alert rule faild")},function(e){v.error(e)})},saveAlertRule:function(e){var t=this;this.$refs[e].validate(function(a){if(a){var r;r=t.isUpdate?"/alert/rule/updateAlertRule":"/alert/rule/addAlertRule",t.alertRule.groupId=t.currentGroup.groupId,t.saveAlertRuleLoading=!0,t.alertRule.clusterAlert&&(t.alertRule.ruleKey="-",t.alertRule.compareType=0,t.alertRule.ruleValue=0),vt.post(r,t.alertRule,function(a){0==a.data.code?(t.getAlertRuleList(t.currentGroup.groupId),t.editVisible=!1,t.$refs[e].resetFields()):v.error("Save alert rule failed"),t.saveAlertRuleLoading=!1},function(e){t.saveAlertRuleLoading=!1,v.error(e)})}})},deleteAlertRule:function(){var e=this;vt.post("/alert/rule/deleteAlertRule",this.alertRule,function(t){0==t.data.code?(e.getAlertRuleList(e.currentGroup.groupId),e.deleteVisible=!1):v.error("Delete alert rule failed")},function(e){v.error(e)})}},computed:{currentGroup:function(){return yt.getters.getCurrentGroup}},watch:{currentGroup:function(e){this.getAlertRuleList(e.groupId)}},mounted:function(){var e=this.currentGroup.groupId;this.getAlertRuleList(e)}},ne=a("VU/8")(se,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"body-wrapper",attrs:{id:"rule-manage"}},[a("div",{staticClass:"header-wrapper"},[a("div",[e._v(e._s(e.currentGroup.groupName))]),e._v(" "),a("div",[a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.createAlertRule()}}},[e._v("Create")])],1)]),e._v(" "),a("div",[a("el-table",{attrs:{data:e.alertRuleList}},[a("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{label:"Alert Rule"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.clusterAlert?a("span",[a("el-tag",{attrs:{size:"small",type:"primary"}},[e._v("Cluster Alert")])],1):a("span",[e._v(e._s(t.row.ruleKey)+" "+e._s(t.row.compareSign)+" "+e._s(t.row.ruleValue))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"Rule Status"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.valid?a("el-tag",{attrs:{size:"small",type:"success"}},[e._v("valid")]):a("el-tag",{attrs:{size:"small",type:"danger"}},[e._v("Invalid")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"Is Global"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.global?a("el-tag",{attrs:{size:"small"}},[e._v("Global")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{property:"checkCycle",label:"Check Cycle(Min)"}}),e._v(" "),a("el-table-column",{attrs:{property:"ruleInfo",label:"Info"}}),e._v(" "),a("el-table-column",{attrs:{property:"time",label:"Time"}}),e._v(" "),a("el-table-column",{attrs:{label:"Operation",width:"250px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.editAlertRule(t.$index,t.row)}}},[e._v("Edit")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("Delete")])]}}])})],1)],1),e._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.saveAlertRuleLoading,expression:"saveAlertRuleLoading"}],attrs:{title:"Edit Rule",visible:e.editVisible,width:"50%","close-on-click-modal":!1},on:{"update:visible":function(t){e.editVisible=t}}},[a("el-form",{ref:"alertRule",attrs:{model:e.alertRule,rules:e.rules,"label-width":"135px"}},[a("el-form-item",{attrs:{label:"Cluster Alert",prop:"clusterAlert"}},[a("el-switch",{model:{value:e.alertRule.clusterAlert,callback:function(t){e.$set(e.alertRule,"clusterAlert",t)},expression:"alertRule.clusterAlert"}})],1),e._v(" "),e.alertRule.clusterAlert?e._e():a("div",[a("el-form-item",{attrs:{label:"Rule Key",prop:"ruleKey"}},[a("el-select",{attrs:{size:"small",placeholder:"Select rule key"},model:{value:e.alertRule.ruleKey,callback:function(t){e.$set(e.alertRule,"ruleKey",t)},expression:"alertRule.ruleKey"}},e._l(e.ruleKeyList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"Compare Type",prop:"compareType"}},[a("el-select",{attrs:{size:"small",placeholder:"Select compare type"},model:{value:e.alertRule.compareType,callback:function(t){e.$set(e.alertRule,"compareType",t)},expression:"alertRule.compareType"}},e._l(e.compareTypeList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"Rule Value",prop:"ruleValue"}},[a("el-input",{staticStyle:{width:"215px"},attrs:{size:"small",placeholder:"Please enter rule value"},model:{value:e.alertRule.ruleValue,callback:function(t){e.$set(e.alertRule,"ruleValue",t)},expression:"alertRule.ruleValue"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"Check Cycle",prop:"checkCycle"}},[a("el-select",{attrs:{size:"small",placeholder:"Select check circle"},model:{value:e.alertRule.checkCycle,callback:function(t){e.$set(e.alertRule,"checkCycle",t)},expression:"alertRule.checkCycle"}},e._l(e.checkCycleList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"Is Valid",prop:"isValid"}},[a("el-switch",{model:{value:e.alertRule.valid,callback:function(t){e.$set(e.alertRule,"valid",t)},expression:"alertRule.valid"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Is Global",prop:"isGlobal"}},[a("el-switch",{model:{value:e.alertRule.global,callback:function(t){e.$set(e.alertRule,"global",t)},expression:"alertRule.global"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Rule Info",prop:"ruleInfo"}},[a("el-input",{attrs:{size:"small",placeholder:"Please enter rule info"},model:{value:e.alertRule.ruleInfo,callback:function(t){e.$set(e.alertRule,"ruleInfo",t)},expression:"alertRule.ruleInfo"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.editVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveAlertRule("alertRule")}}},[e._v("Confirm")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"Delete Alert Rule",visible:e.deleteVisible,width:"30%"},on:{"update:visible":function(t){e.deleteVisible=t}}},[a("span",[e._v("\n      Are you sure to delete\n      "),e.alertRule.clusterAlert?e._e():a("b",[e._v(e._s(e.alertRule.ruleKey)+" "+e._s(e.alertRule.compareSign)+" "+e._s(e.alertRule.ruleValue))]),e._v(" ?\n    ")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteAlertRule()}}},[e._v("Delete")])],1)])],1)},staticRenderFns:[]},!1,function(e){a("OQxI")},"data-v-bfb59af0",null).exports,ie={data:function(){return{cluster:{},alertRecordList:[],alertRuleList:[],alertRuleListNotUsed:[],alertChannelList:[],activeName:"record",addAlertRuleVisible:!1,addAlertChannelVisible:!1,deleteAlertRuleVisible:!1,deleteAlertChannelVisible:!1,deleteAlertRecordVisible:!1,deletingAlertRule:{},deletingAlertChannel:{},deletingAlertRecordIds:[],alertRecordCurrentPageNo:1,alertRecordPageSize:20,alertRecordTotalPage:0,alertRecordPaginationShow:!1,alertRecordTotalCount:0}},methods:{handleClick:function(e,t){},addRuleSelectionChange:function(e){var t="";e.length>0&&e.forEach(function(e){t+=e.ruleId,t+=","}),this.cluster.ruleIds=t},addChannelSelectionChange:function(e){var t="";e.length>0&&e.forEach(function(e){t+=e.channelId,t+=","}),this.cluster.channelIds=t},getAlertRecordList:function(e){var t=this,a="/alert/record/getAlertRecord/cluster/"+e+"?pageNo="+this.alertRecordCurrentPageNo;vt.get(a,null,function(e){var a=e.data;if(0==a.code){var r=a.data.alertRecords;if(null==r||0==r.length)return void(t.alertRecordList=r);r.forEach(function(e){e.time=y(e.updateTime)}),t.alertRecordList=r,t.alertRecordTotalCount=a.data.totalCount,t.alertRecordTotalPage=a.data.totalPage,t.alertRecordTotalPage>1&&(t.alertRecordPaginationShow=!0)}else v.error("Get alert record list failed")},function(e){v.error(e)})},handleCurrentChange:function(e){this.alertRecordCurrentPageNo=e;var t=this.cluster.clusterId;this.getAlertRecordList(t)},getIndex:function(e){return this.indexBasic+e+1},getAlertRuleList:function(e){var t=this,a="/alert/rule/getAlertRule/cluster/"+e;vt.get(a,null,function(e){var a=e.data;if(0==a.code){var r=a.data;t.alertRuleList=t.buildAlertRuleList(r)}else v.error("Get alert rule list failed")},function(e){v.error(e)})},getAlertRuleListNotUsed:function(e){var t=this,a="/alert/rule/getAlertRuleNotUsed/"+e;vt.get(a,null,function(e){var a=e.data;0==a.code?(t.alertRuleListNotUsed=t.buildAlertRuleList(a.data),t.addAlertRuleVisible=!0):v.error("Get alert rule list not used failed")},function(e){v.error(e)})},buildAlertRuleList:function(e){return null==e||0==e.length?[]:(e.forEach(function(e){e.time=y(e.updateTime),e.lastCheck=y(e.lastCheckTime);var t=e.compareType;e.compareSign=0==t?"=":1==t?">":-1==t?"<":"!="}),e)},addAlertRule:function(){var e=this;o(this.cluster.ruleIds)?v.warning("No rule"):vt.post("/cluster/addAlertRule",this.cluster,function(t){var a=t.data,r=e.cluster.clusterId;e.getAlertRuleList(r),0==a.code?e.addAlertRuleVisible=!1:v.error("Save alert rule failed")},function(e){v.error(e)})},handleDeleteAlertRule:function(e){this.cluster.ruleIds=e.ruleId,this.deletingAlertRule=e,this.deleteAlertRuleVisible=!0},deleteAlertRule:function(){var e=this;vt.post("/cluster/deleteAlertRule",this.cluster,function(t){var a=t.data,r=e.cluster.clusterId;e.getAlertRuleList(r),0==a.code?e.deleteAlertRuleVisible=!1:v.error("Delete alert rule failed")},function(e){v.error(e)})},getAlertChannelList:function(e){var t=this,a="/alert/channel/getAlertChannel/cluster/"+e;vt.get(a,null,function(e){var a=e.data;0==a.code?t.alertChannelList=t.buildAlertChannelList(a.data):v.error("Get alert channel list failed")},function(e){v.error(e)})},getAlertChannelListNotUsed:function(e){var t=this,a="/alert/channel/getAlertChannelNotUsed/"+e;vt.get(a,null,function(e){var a=e.data;0==a.code?(t.alertRuleListNotUsed=t.buildAlertChannelList(a.data),t.addAlertChannelVisible=!0):v.error("Get alert channel list not used failed")},function(e){v.error(e)})},buildAlertChannelList:function(e){return null==e||0==e.length?[]:(e.forEach(function(e){e.time=y(e.updateTime)}),e)},addAlertChannel:function(){var e=this;o(this.cluster.channelIds)||vt.post("/cluster/addAlertChannel",this.cluster,function(t){var a=t.data,r=e.cluster.clusterId;e.getAlertChannelList(r),0==a.code?e.addAlertChannelVisible=!1:v.error("Save alert channel failed")},function(e){v.error(e)})},handleDeleteAlertChannel:function(e){this.cluster.channelIds=e.channelId,this.deletingAlertChannel=e,this.deleteAlertChannelVisible=!0},deleteAlertChannel:function(){var e=this;vt.post("/cluster/deleteAlertChannel",this.cluster,function(t){var a=t.data,r=e.cluster.clusterId;e.getAlertChannelList(r),0==a.code?e.deleteAlertChannelVisible=!1:v.error("Delete alert channel failed")},function(e){v.error(e)})},handleDeleteAlertRecord:function(e){this.deletingAlertRecordIds=[],this.deletingAlertRecordIds.push(e.recordId),this.deleteAlertRecordVisible=!0},handleRecordSelectionChange:function(e){var t=this;0!=e.length&&(this.deletingAlertRecordIds=[],e.forEach(function(e){t.deletingAlertRecordIds.push(e.recordId)}))},handleDeleteAlertRecordBatch:function(){0!=this.deletingAlertRecordIds.length&&(this.deleteAlertRecordVisible=!0)},deleteAlertRecord:function(){var e=this,t={groupId:this.currentGroup.groupId,recordsIds:this.deletingAlertRecordIds};vt.post("/alert/record/deleteAlertRecordBatch",t,function(t){var a=t.data,r=e.cluster.clusterId;e.getAlertRecordList(r),0==a.code?e.deleteAlertRecordVisible=!1:v.error("Delete alert record failed")},function(e){v.error(e)})}},computed:{currentGroup:function(){return yt.getters.getCurrentGroup},indexBasic:function(){return(this.alertRecordCurrentPageNo-1)*this.alertRecordPageSize}},watch:{currentGroup:function(e){this.$router.push({name:"dashboard",params:{groupId:e.groupId}})}},mounted:function(){var e=this,t=this.$route.params.clusterId;w(t,function(a){e.cluster=a,e.getAlertRecordList(t),e.getAlertRuleList(t),e.getAlertChannelList(t)})}},le=a("VU/8")(ie,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"alert-manage"}},[a("div",{staticClass:"overview-wrapper"},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{xl:8,lg:8,md:12,sm:12}},[a("div",{staticClass:"card-panel"},[a("div",{staticClass:"card-panel-icon-wrapper card-panel-icon-alert"},[a("i",{staticClass:"el-icon-bell"})]),e._v(" "),a("div",{staticClass:"card-panel-info-wrapper"},[a("div",{staticClass:"card-panel-info-key"},[e._v("Alert Record")]),e._v(" "),a("div",{staticClass:"card-panel-info-value"},[e._v(e._s(e.alertRecordTotalCount))])])])]),e._v(" "),a("el-col",{attrs:{xl:8,lg:8,md:12,sm:12}},[a("div",{staticClass:"card-panel"},[a("div",{staticClass:"card-panel-icon-wrapper card-panel-icon-rule"},[a("i",{staticClass:"el-icon-notebook-2"})]),e._v(" "),a("div",{staticClass:"card-panel-info-wrapper"},[a("div",{staticClass:"card-panel-info-key"},[e._v("Alert Rule")]),e._v(" "),a("div",{staticClass:"card-panel-info-value"},[e._v(e._s(e.alertRuleList.length))])])])]),e._v(" "),a("el-col",{attrs:{xl:8,lg:8,md:12,sm:12}},[a("div",{staticClass:"card-panel"},[a("div",{staticClass:"card-panel-icon-wrapper card-panel-icon-channel"},[a("i",{staticClass:"el-icon-coin"})]),e._v(" "),a("div",{staticClass:"card-panel-info-wrapper"},[a("div",{staticClass:"card-panel-info-key"},[e._v("Alert Channel")]),e._v(" "),a("div",{staticClass:"card-panel-info-value"},[e._v(e._s(e.alertChannelList.length))])])])])],1)],1),e._v(" "),a("div",{staticClass:"body-wrapper"},[a("div",{staticClass:"title-wrapper"},[a("span",[e._v(e._s(e.cluster.clusterName))]),e._v(" "),"HEALTH"==e.cluster.clusterState?a("i",{staticClass:"el-icon-sunny health",attrs:{title:"Status"}}):e._e()]),e._v(" "),a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"Alert Record",name:"record"}},[a("div",{staticClass:"operation-wrapper"},[a("div",{staticClass:"batch-title"},[e._v("Batch Operation")]),e._v(" "),a("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[a("div",[a("el-link",{attrs:{type:"danger",underline:!1,icon:"el-icon-delete"},on:{click:e.handleDeleteAlertRecordBatch}},[e._v("Delete")])],1)])]),e._v(" "),a("el-table",{attrs:{data:e.alertRecordList,"default-sort":{prop:"time",order:"descending"}},on:{"selection-change":e.handleRecordSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{type:"index",width:"60",index:e.getIndex}}),e._v(" "),a("el-table-column",{attrs:{property:"redisNode",label:"Redis Node"}}),e._v(" "),a("el-table-column",{attrs:{property:"alertRule",label:"Alert Rule"}}),e._v(" "),a("el-table-column",{attrs:{property:"actualData",label:"Reason"}}),e._v(" "),a("el-table-column",{attrs:{label:"Is Global"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.global?a("el-tag",{attrs:{size:"small"}},[e._v("Global")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{property:"checkCycle",label:"Check Cycle"}}),e._v(" "),a("el-table-column",{attrs:{property:"ruleInfo",label:"Info"}}),e._v(" "),a("el-table-column",{attrs:{property:"time",label:"Time"}}),e._v(" "),a("el-table-column",{attrs:{label:"Operation",width:"100px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDeleteAlertRecord(t.row)}}},[e._v("Delete")])]}}])})],1),e._v(" "),e.alertRecordPaginationShow?a("el-pagination",{staticStyle:{"text-align":"center"},attrs:{"current-page":e.alertRecordCurrentPageNo,"page-size":e.alertRecordPageSize,layout:"prev, pager, next, jumper",total:e.alertRecordTotalCount},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.alertRecordCurrentPageNo=t},"update:current-page":function(t){e.alertRecordCurrentPageNo=t}}}):e._e()],1),e._v(" "),a("el-tab-pane",{attrs:{label:"Alert Rule",name:"rule"}},[a("div",{staticClass:"operation-wrapper"},[a("div",{staticStyle:{display:"flex","justify-content":"flex-end"}},[a("el-link",{attrs:{underline:!1,icon:"el-icon-plus",type:"primary"},on:{click:function(t){return e.getAlertRuleListNotUsed(e.cluster.clusterId)}}},[e._v("Add Rule")])],1)]),e._v(" "),a("el-table",{attrs:{data:e.alertRuleList,"default-sort":{prop:"time",order:"descending"}}},[a("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{label:"Alert Rule"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.clusterAlert?a("span",[a("el-tag",{attrs:{size:"small",type:"primary"}},[e._v("Cluster Alert")])],1):a("span",[e._v(e._s(t.row.ruleKey)+" "+e._s(t.row.compareSign)+" "+e._s(t.row.ruleValue))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"Rule Status"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.valid?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("valid")]):a("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v("Invalid")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"Is Global"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.global?a("el-tag",{attrs:{size:"small"}},[e._v("Global")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{property:"ruleInfo",label:"Info"}}),e._v(" "),a("el-table-column",{attrs:{property:"lastCheck",label:"Last Check"}}),e._v(" "),a("el-table-column",{attrs:{property:"time",label:"Time"}}),e._v(" "),a("el-table-column",{attrs:{label:"Operation",width:"100px;"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.global?void 0:[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDeleteAlertRule(t.row)}}},[e._v("Delete")])]}}],null,!0)})],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"Alert Channel",name:"channel"}},[a("div",{staticClass:"operation-wrapper"},[a("div",{staticStyle:{display:"flex","justify-content":"flex-end"}},[a("el-link",{attrs:{underline:!1,icon:"el-icon-plus",type:"primary"},on:{click:function(t){return e.getAlertChannelListNotUsed(e.cluster.clusterId)}}},[e._v("Add Channel")])],1)]),e._v(" "),a("el-table",{attrs:{data:e.alertChannelList,"default-sort":{prop:"time",order:"descending"}}},[a("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{property:"channelName",label:"Channel Name"}}),e._v(" "),a("el-table-column",{attrs:{label:"Channel Type"},scopedSlots:e._u([{key:"default",fn:function(t){return["0"==t.row.channelType?a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("p",[a("span",{staticClass:"label-color"},[e._v("Email From:")]),e._v("\n                  "+e._s(t.row.emailFrom)+"\n                ")]),e._v(" "),a("p",[a("span",{staticClass:"label-color"},[e._v("Email To:")]),e._v("\n                  "+e._s(t.row.emailTo)+"\n                ")]),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{size:"small",type:"success"}},[e._v("Email")])],1)]):e._e(),e._v(" "),"1"==t.row.channelType?a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("p",[a("span",{staticClass:"label-color"},[e._v("Web Hook:")]),e._v("\n                  "+e._s(t.row.webhook)+"\n                ")]),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{size:"small",type:"success"}},[e._v("WebChat Webhook")])],1)]):e._e(),e._v(" "),"2"==t.row.channelType?a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("p",[a("span",{staticClass:"label-color"},[e._v("Web Hook:")]),e._v("\n                  "+e._s(t.row.webhook)+"\n                ")]),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{size:"small",type:"primary"}},[e._v("DingDing Webhook")])],1)]):e._e(),e._v(" "),"3"==t.row.channelType?a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("p",[a("span",{staticClass:"label-color"},[e._v("Corp ID:")]),e._v("\n                  "+e._s(t.row.corpId)+"\n                ")]),e._v(" "),a("p",[a("span",{staticClass:"label-color"},[e._v("Agent ID:")]),e._v("\n                  "+e._s(t.row.agentId)+"\n                ")]),e._v(" "),a("p",[a("span",{staticClass:"label-color"},[e._v("Corp Secret:")]),e._v("\n                  "+e._s(t.row.corpSecret)+"\n                ")]),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{size:"small",type:"success"}},[e._v("WebChat App")])],1)]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{property:"channelInfo",label:"Info"}}),e._v(" "),a("el-table-column",{attrs:{property:"time",label:"Time"}}),e._v(" "),a("el-table-column",{attrs:{label:"Operation",width:"100px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDeleteAlertChannel(t.row)}}},[e._v("Delete")])]}}])})],1)],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"Add Alert Rule",visible:e.addAlertRuleVisible},on:{"update:visible":function(t){e.addAlertRuleVisible=t}}},[a("el-table",{attrs:{data:e.alertRuleListNotUsed,stripe:""},on:{"selection-change":e.addRuleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{label:"Alert Rule"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.clusterAlert?a("span",[a("el-tag",{attrs:{size:"small",type:"primary"}},[e._v("Cluster Alert")])],1):a("span",[e._v(e._s(t.row.ruleKey)+" "+e._s(t.row.compareSign)+" "+e._s(t.row.ruleValue))])]}}])}),e._v(" "),a("el-table-column",{attrs:{property:"checkCycle",label:"Check Cycle(Min)"}}),e._v(" "),a("el-table-column",{attrs:{property:"ruleInfo",label:"Info"}}),e._v(" "),a("el-table-column",{attrs:{property:"time",label:"Time"}})],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.addAlertRule()}}},[e._v("Confirm")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"Delete Alert Rule",visible:e.deleteAlertRuleVisible},on:{"update:visible":function(t){e.deleteAlertRuleVisible=t}}},[e._v("\n    Are you sure to delete\n    "),a("b",[e._v(e._s(e.deletingAlertRule.ruleKey)+" "+e._s(e.deletingAlertRule.compareSign)+" "+e._s(e.deletingAlertRule.ruleValue))]),e._v(" ?\n    "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteAlertRuleVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.deleteAlertRule()}}},[e._v("Confirm")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"Add Alert Channel",visible:e.addAlertChannelVisible},on:{"update:visible":function(t){e.addAlertChannelVisible=t}}},[a("el-table",{attrs:{data:e.alertRuleListNotUsed,stripe:""},on:{"selection-change":e.addChannelSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{property:"channelName",label:"Channel Name",width:"150px;"}}),e._v(" "),a("el-table-column",{attrs:{label:"Channel Type",width:"200px;"},scopedSlots:e._u([{key:"default",fn:function(t){return["0"==t.row.channelType?a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("p",[a("span",{staticClass:"label-color"},[e._v("Email From:")]),e._v("\n              "+e._s(t.row.emailFrom)+"\n            ")]),e._v(" "),a("p",[a("span",{staticClass:"label-color"},[e._v("Email To:")]),e._v("\n              "+e._s(t.row.emailTo)+"\n            ")]),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{size:"small",type:"success"}},[e._v("Email")])],1)]):e._e(),e._v(" "),"1"==t.row.channelType?a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("p",[a("span",{staticClass:"label-color"},[e._v("Web Hook:")]),e._v("\n              "+e._s(t.row.webhook)+"\n            ")]),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{size:"small",type:"success"}},[e._v("WebChat Webhook")])],1)]):e._e(),e._v(" "),"2"==t.row.channelType?a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("p",[a("span",{staticClass:"label-color"},[e._v("Web Hook:")]),e._v("\n              "+e._s(t.row.webhook)+"\n            ")]),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{size:"small",type:"primary"}},[e._v("DingDing Webhook")])],1)]):e._e(),e._v(" "),"3"==t.row.channelType?a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{size:"small",type:"success"}},[e._v("WebChat App")])],1)]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{property:"channelInfo",label:"Info"}}),e._v(" "),a("el-table-column",{attrs:{property:"time",label:"Time"}})],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.addAlertChannel()}}},[e._v("Confirm")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"Delete Alert Channel",visible:e.deleteAlertChannelVisible,width:"30%"},on:{"update:visible":function(t){e.deleteAlertChannelVisible=t}}},[a("span",[e._v("\n      Are you sure to delete\n      "),a("b",[e._v(e._s(e.deletingAlertChannel.channelName))]),e._v(" ?\n    ")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteAlertChannelVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteAlertChannel()}}},[e._v("Delete")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"Delete Alert Record",visible:e.deleteAlertRecordVisible,width:"30%"},on:{"update:visible":function(t){e.deleteAlertRecordVisible=t}}},[a("span",[e._v("Are you sure to delete?")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteAlertChannelVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteAlertRecord()}}},[e._v("Delete")])],1)])],1)},staticRenderFns:[]},!1,function(e){a("C6nx")},"data-v-f4634826",null).exports,oe={data:function(){var e=this;return{machineList:[],machineGroupNameList:[],editMachineVisible:!1,isUpdate:!1,deleteVisible:!1,deleteBatchVisible:!1,batchDelete:!1,machines:{hostList:[{value:""}],sshPort:22},rules:{machineGroupName:[{required:!0,validator:function(e,t,a){if(o(t)||o(t.trim()))return a(new Error("Please select or enter machine group name"));a()},trigger:"blur"}],userName:[{required:!0,validator:function(e,t,a){if(o(t)||o(t.trim()))return a(new Error("Please enter machine user name"));a()},trigger:"blur"}],password:[{required:!0,validator:function(e,t,a){if(o(t)||o(t.trim()))return a(new Error("Please enter machine password"));a()},trigger:"blur"}],host:[{required:!0,validator:function(e,t,a){return o(t)||o(t.trim())?a(new Error("Please enter machine ip")):function(e){return/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(e)}(t)?void a():a(new Error("Incorrect ip format"))},trigger:"blur"},{required:!0,validator:function(t,a,r){var s=e.machines.userName,n=e.machines.password,i=e.machines.sshPort;if(o(s)||o(s.trim())||o(n)||o(n.trim()))return r(new Error("Please enter user name and passwor first"));var l={userName:s,password:n,host:a,sshPort:i};vt.post("/machine/validateConnection",l,function(e){var t=e.data;if(0!=t.code)return r(new Error(t.message));r()},function(e){return r(new Error("Network error"))})},trigger:"blur"}]},search:"",selectedMachineList:[],saveMachineLoading:!1}},methods:{getMachineList:function(e){var t=this;if(!o(e)){var a="/machine/getMachineList/"+e;vt.get(a,null,function(e){var a=e.data;if(0==a.code){var r=a.data;r.forEach(function(e){e.time=y(e.updateTime)}),t.machineList=r}else v.error("Get machine list failed")},function(e){v.error(e)})}},getMachineGroupNameList:function(e){var t=this,a="/machine/getMachineGroupNameList/"+e;vt.get(a,null,function(e){var a=e.data;0==a.code?t.machineGroupNameList=a.data:v.error("Get machine group name list failed")},function(e){v.error(e)})},buildMachineList:function(e){var t=this,a=[];if(this.isUpdate)return a.push(e),a;var r=this.machines.machineGroupName,s=this.machines.userName,n=this.machines.password,i=this.machines.token,l=this.machines.hostList,u=this.machines.machineInfo,c=this.machines.sshPort;return c=o(c)?22:c,l.forEach(function(e){a.push({groupId:t.currentGroupId,machineGroupName:r,userName:s,password:n,token:i,host:e.value,sshPort:c,machineInfo:u})}),a},saveMachines:function(e){var t=this;this.$refs[e].validate(function(a){if(a){var r,s=t.buildMachineList(t.machines);r=t.isUpdate?"/machine/updateMachine":"/machine/addMachineList",t.saveMachineLoading=!0,vt.post(r,s,function(a){0==a.data.code?(t.editMachineVisible=!1,t.getMachineGroupNameList(t.currentGroupId),t.getMachineList(t.currentGroupId)):v.error("Save machines failed"),t.$refs[e].resetFields(),t.saveMachineLoading=!1},function(e){t.saveMachineLoading=!0,v.error(e)})}})},editMachine:function(e,t){this.machines=t,this.editMachineVisible=!0,this.isUpdate=!0},handleDelete:function(e,t){this.machines=t,this.deleteVisible=!0,this.batchDelete=!1},handleDeleteBatch:function(){this.batchDelete=!0,0==this.selectedMachineList.length?v.warning("Please select machine"):this.deleteBatchVisible=!0},deleteMachine:function(){var e=this,t="",a=void 0;this.batchDelete?(t="/machine/deleteMachineBatch",(a=this.selectedMachineList).forEach(function(e){e.updateTime=new Date})):(t="/machine/deleteMachine",(a=this.machines).updateTime=new Date),vt.post(t,a,function(t){0==t.data.code?(e.deleteVisible=!1,e.deleteBatchVisible=!1,e.getMachineGroupNameList(e.currentGroupId),e.getMachineList(e.currentGroupId),e.machines={hostList:[{value:""}]},e.selectedMachineList=[]):v.error("Delete machine failed")},function(e){v.error(e)})},removeHost:function(e){if(1!=this.machines.hostList.length){var t=this.machines.hostList.indexOf(e);-1!==t&&this.machines.hostList.splice(t,1)}},addHost:function(){this.machines.hostList.length>=20||this.machines.hostList.push({value:"",key:Date.now()})},handleSelectionChange:function(e){this.selectedMachineList=e}},computed:{currentGroupId:function(){return yt.getters.getCurrentGroup.groupId}},watch:{currentGroupId:function(e){this.getMachineList(e),this.$router.push({name:"machine-manage",params:{groupId:e}})}},mounted:function(){var e=this.currentGroupId;this.getMachineList(e),this.getMachineGroupNameList(e)}},ue=a("VU/8")(oe,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"body-wrapper"},[a("div",{staticClass:"operation-wrapper"},[a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){e.editMachineVisible=!0,e.isUpdate=!1,e.machines={hostList:[{value:""}]}}}},[e._v("Import Machine")])],1),e._v(" "),a("div",{staticClass:"batch-operation-wrapper"},[a("div",{staticClass:"batch-title"},[e._v("Batch Operation")]),e._v(" "),a("el-row",[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDeleteBatch()}}},[e._v("Delete")])],1)],1),e._v(" "),a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.machineList,center:"","default-sort":{prop:"machineGroupName",order:"ascending"}},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{property:"machineGroupName",label:"Machine Group Name",width:"200",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{property:"host",label:"Host",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{property:"userName",label:"User Name"}}),e._v(" "),a("el-table-column",{attrs:{label:"Password",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("p",[e._v(e._s(t.row.password))]),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{size:"small",type:"info"}},[e._v("******")])],1)])]}}])}),e._v(" "),a("el-table-column",{attrs:{property:"machineInfo",label:"Info"}}),e._v(" "),a("el-table-column",{attrs:{property:"time",label:"Time",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{label:"Operation",width:"200px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.editMachine(t.$index,t.row)}}},[e._v("Edit")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("Delete")])]}}])})],1)],1),e._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.saveMachineLoading,expression:"saveMachineLoading"}],attrs:{title:"Edit machines",visible:e.editMachineVisible,width:"50%","close-on-click-modal":!1},on:{"update:visible":function(t){e.editMachineVisible=t}}},[a("el-form",{ref:"machines",attrs:{model:e.machines,rules:e.rules,size:"small","label-width":"135px"}},[a("el-form-item",{attrs:{label:"Machine Group",prop:"machineGroupName"}},[a("el-select",{attrs:{filterable:"","allow-create":"","default-first-option":"",placeholder:"Select or enter group"},model:{value:e.machines.machineGroupName,callback:function(t){e.$set(e.machines,"machineGroupName",t)},expression:"machines.machineGroupName"}},e._l(e.machineGroupNameList,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"User Name",prop:"userName"}},[a("el-input",{model:{value:e.machines.userName,callback:function(t){e.$set(e.machines,"userName",t)},expression:"machines.userName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Password",prop:"password"}},[a("el-input",{model:{value:e.machines.password,callback:function(t){e.$set(e.machines,"password",t)},expression:"machines.password"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"SSH Port",prop:"sshPort"}},[a("el-input",{model:{value:e.machines.sshPort,callback:function(t){e.$set(e.machines,"sshPort",e._n(t))},expression:"machines.sshPort"}})],1),e._v(" "),e.isUpdate?a("el-form-item",{attrs:{label:"Host",prop:"host",rules:e.rules.host}},[a("el-input",{model:{value:e.machines.host,callback:function(t){e.$set(e.machines,"host",t)},expression:"machines.host"}})],1):a("div",e._l(e.machines.hostList,function(t,r){return a("el-form-item",{key:t.key,attrs:{label:"Host "+(r+1),prop:"hostList."+r+".value",rules:e.rules.host}},[a("el-input",{model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"host.value"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-delete"},on:{click:function(a){return a.preventDefault(),e.removeHost(t)}},slot:"append"})],1)],1)}),1),e._v(" "),a("el-form-item",{attrs:{label:"Machine Info",prop:"machineInfo"}},[a("el-input",{attrs:{maxlength:"50","show-word-limit":""},model:{value:e.machines.machineInfo,callback:function(t){e.$set(e.machines,"machineInfo",t)},expression:"machines.machineInfo"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.isUpdate?e._e():a("el-button",{attrs:{size:"small"},on:{click:function(t){return e.addHost()}}},[e._v("New Host")]),e._v(" "),e.isUpdate?a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveMachines("machines")}}},[e._v("Update")]):a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveMachines("machines")}}},[e._v("Confirm")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"Delete Machine",visible:e.deleteVisible,width:"30%"},on:{"update:visible":function(t){e.deleteVisible=t}}},[a("span",[e._v("\n      Are you sure to delete\n      "),a("b",[e._v(e._s(e.machines.machineGroupName)+" "+e._s(e.machines.host))]),e._v(" ?\n    ")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteMachine(e.machines)}}},[e._v("Delete")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"Delete Machine Batch",visible:e.deleteBatchVisible,width:"30%"},on:{"update:visible":function(t){e.deleteBatchVisible=t}}},[a("span",[e._v("\n      Are you sure to delete ?\n      "),a("br"),e._v(" "),e._l(e.selectedMachineList,function(t,r){return a("div",{key:r},[e._v(e._s(t.machineGroupName)+" "+e._s(t.host))])})],2),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteBatchVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteMachine(e.selectedMachineList)}}},[e._v("Delete")])],1)])],1)},staticRenderFns:[]},!1,function(e){a("LnKd")},"data-v-b7441a64",null).exports,ce={data:function(){var e=this;return{createGroupVisible:!1,group:{groupName:""},rules:{groupName:[{required:!0,validator:function(t,a,r){if(o(a)||o(a.trim()))return r(new Error("Please enter group name"));var s="/group/validateGroupName/"+a;vt.get(s,null,function(t){var s=t.data.code,n=t.data.data,i=e.group.groupId;if(0!=s&&i!=n.groupId)return r(new Error(a+" has exist"));r()},function(e){return r(new Error("Network error, "+e))})},trigger:"blur"}]},saveGroupLoading:!1}},methods:{saveGroup:function(e){var t=this;this.$refs[e].validate(function(e){if(e){t.saveGroupLoading=!0;var a=yt.getters.getUser;t.group.userId=a.userId;var r;r=o(t.group.groupId)?"/group/addGroup":"/group/updateGroup",vt.post(r,t.group,function(e){0==e.data.code?(t.createGroupVisible=!1,t.group={},function(e){vt.post("/group/getGroupList",e,function(e){if(0===e.data.code){var t=e.data.data;t.forEach(function(e){e.time=y(e.updateTime)}),yt.dispatch("setGroupList",t)}else v.error("Get group list failed")},function(e){v.error(e)})}(a)):v.error("Save group failed"),t.saveGroupLoading=!1},function(e){t.saveGroupLoading=!1,v.error(e)})}})},closeHandler:function(){this.group={}},editGroup:function(e,t){this.group=t,this.createGroupVisible=!0},deleteGroup:function(e,t){}},computed:{groupList:function(){return yt.getters.getGroupList}},mounted:function(){}},de=a("VU/8")(ce,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"body-wrapper",attrs:{id:"user-manage"}},[a("div",{staticClass:"operation-wrapper"},[a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){e.createGroupVisible=!0,e.group={}}}},[e._v("Create")])],1),e._v(" "),a("el-table",{attrs:{data:e.groupList}},[a("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{property:"groupName",label:"Group Name"}}),e._v(" "),a("el-table-column",{attrs:{property:"groupInfo",label:"Info"}}),e._v(" "),a("el-table-column",{attrs:{property:"time",label:"Time"}}),e._v(" "),a("el-table-column",{attrs:{label:"Operation",width:"150px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.editGroup(t.$index,t.row)}}},[e._v("Edit")])]}}])})],1),e._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.saveGroupLoading,expression:"saveGroupLoading"}],attrs:{title:"Create Group",visible:e.createGroupVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.createGroupVisible=t},close:function(t){return e.closeHandler()}}},[a("el-form",{ref:"group",attrs:{model:e.group,"label-width":"120px",size:"small"}},[a("el-form-item",{attrs:{label:"Group Name",prop:"groupName",rules:e.rules.groupName}},[a("el-input",{attrs:{maxlength:"50","show-word-limit":""},model:{value:e.group.groupName,callback:function(t){e.$set(e.group,"groupName",t)},expression:"group.groupName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Group Info",prop:"groupInfo"}},[a("el-input",{model:{value:e.group.groupInfo,callback:function(t){e.$set(e.group,"groupInfo",t)},expression:"group.groupInfo"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveGroup("group")}}},[e._v("Confirm")])],1)],1)],1)},staticRenderFns:[]},!1,function(e){a("4RNS")},"data-v-3859f51f",null).exports,pe={data:function(){var e,t=this;return e={userList:[],grantedUserList:[],user:{},isUpdate:!1,editUserVisible:!1,editGrantUserVisible:!1,deleteUserVisible:!1,revokeUserVisible:!1},T()(e,"isUpdate",!1),T()(e,"rules",{userRole:[{required:!0,message:"Please select user role",trigger:"blur"}],userName:[{required:!0,message:"Please enter user name",trigger:"blur"},{required:!0,validator:function(e,a,r){var s="/user/validateUserName/"+a;vt.get(s,null,function(e){var s=e.data;0==s.code?r():t.user.userId!==s.data.userId?r(new Error(a+" has been used")):r()},function(e){return r(new Error("Network error"))})},trigger:"blur"}],password:[{required:!0,message:"Please enter password",trigger:"blur"}],email:[{validator:function(e,t,a){if(!o(t)&&!u(t))return a(new Error("Incorrect format"));a()},trigger:"blur"}],mobile:[{validator:function(e,t,a){if(!o(t)&&!c(t))return a(new Error("Incorrect format"));a()},trigger:"blur"}]}),T()(e,"grantUserRules",{userRole:[{required:!0,message:"Please select user role",trigger:"blur"}],userName:[{required:!0,message:"Please enter user name",trigger:"blur"},{required:!0,validator:function(e,a,r){var s="/user/validateUserName/"+a;vt.get(s,null,function(e){var s=e.data;if(0==s.code)r(new Error(a+" not exist"));else{var n=s.data;vt.get("/user/isGranted/"+t.currentGroup.groupId+"/"+n.userId,null,function(e){if(0!=e.data.code)return r(new Error(a+" has been granted"));r()},function(e){return r(new Error("Network error"))})}},function(e){return r(new Error("Network error"))})},trigger:"blur"}]}),T()(e,"saveUserLoading",!1),T()(e,"grantUserLoading",!1),e},methods:{handleEdit:function(e){this.getUserById(e.userId),this.isUpdate=!0,this.editUserVisible=!0},handleDelete:function(e){this.user=e,this.deleteUserVisible=!0},handleRevoke:function(e){this.user=e,this.revokeUserVisible=!0},getUserList:function(e){var t=this,a="/user/getUserList/"+e;vt.get(a,null,function(e){var a=e.data;if(0==a.code){var r=a.data;r.forEach(function(e){var t=e.avatar;o(t)||(e.avatar=""+t),e.time=y(e.updateTime)}),t.userList=r}},function(e){v.error(e)})},getGrantedUserList:function(e){var t=this,a="/user/getGrantedUserList/"+e;vt.get(a,null,function(e){var a=e.data;if(0==a.code){var r=a.data;r.forEach(function(e){var t=e.avatar;o(t)||(e.avatar=""+t),e.time=y(e.updateTime)}),t.grantedUserList=r}},function(e){v.error(e)})},getUserById:function(e){var t=this,a="/user/getUser/"+e;vt.get(a,null,function(e){var a=e.data;0==a.code?t.user=a.data:v.error("Get user failed")},function(e){v.error(e)})},saveUser:function(e){var t=this;this.$refs[e].validate(function(a){if(a){t.saveUserLoading=!0;var r=t.currentGroup.groupId;t.user.groupId=r;var s;s=t.isUpdate?"/user/updateUser":"/user/addUser",vt.post(s,t.user,function(a){var s=a.data;t.getUserList(r),0==s.code?(t.editUserVisible=!1,t.$refs[e].resetFields()):v.error("save user failed"),t.saveUserLoading=!1},function(e){t.saveUserLoading=!1,v.error(e)})}})},saveGroupUser:function(e){var t=this;this.$refs[e].validate(function(a){if(a){t.grantUserLoading=!0;var r=t.currentGroup.groupId;t.user.groupId=r,vt.post("/user/grantUser",t.user,function(a){var s=a.data;t.getGrantedUserList(r),0==s.code?(t.editGrantUserVisible=!1,t.$refs[e].resetFields()):v.error("Save user failed"),t.grantUserLoading=!1},function(e){t.grantUserLoading=!1,v.error(e)})}})},deleteUser:function(){var e=this;vt.post("/user/deleteUser",this.user,function(t){e.getUserList(e.currentGroup.groupId),e.deleteUserVisible=!1,e.user={}},function(e){v.error(e)})},revokeUser:function(){var e=this;vt.post("/user/revokeUser",this.user,function(t){e.getGrantedUserList(e.currentGroup.groupId),e.revokeUserVisible=!1,e.user={}},function(e){v.error(e)})}},computed:{currentGroup:function(){return yt.getters.getCurrentGroup},currentUser:function(){return yt.getters.getUser}},watch:{currentGroup:function(e){var t=e.groupId;this.getUserList(t),this.getGrantedUserList(t),this.$router.push({name:"user-manage",params:{groupId:t}})}},mounted:function(){var e=this.currentGroup.groupId;this.getUserList(e),this.getGrantedUserList(e)}},me=a("VU/8")(pe,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container-wrapper",attrs:{id:"user-manage"}},[a("div",[a("div",{staticClass:"operation-wrapper"},[a("div",[e._v("Current Group")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){e.user={},e.editUserVisible=!0,e.isUpdate=!1}}},[e._v("Create")])],1),e._v(" "),a("el-table",{attrs:{data:e.userList}},[a("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"userName",label:"User Name"}}),e._v(" "),a("el-table-column",{attrs:{label:"User Role"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.userRole?a("el-tag",{attrs:{size:"small",type:"success"}},[e._v("Super Admin")]):1==t.row.userRole?a("el-tag",{attrs:{size:"small",type:"primary"}},[e._v("Admin")]):a("el-tag",{attrs:{size:"small",type:"info"}},[e._v("Member")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"Avatar"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-image",{attrs:{src:t.row.avatar,fit:"cover"}},[a("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[e._v(e._s(t.row.userName))])])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"email",label:"Email"}}),e._v(" "),a("el-table-column",{attrs:{prop:"mobile",label:"Mobile"}}),e._v(" "),a("el-table-column",{attrs:{prop:"time",label:"Time"}}),e._v(" "),a("el-table-column",{attrs:{label:"Operation",width:"200px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.currentUser.userRole<=t.row.userRole?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v("Edit")]):e._e(),e._v(" "),e.currentUser.userRole<=t.row.userRole&&e.currentUser.userId!=t.row.userId?a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("Delete")]):e._e()]}}])})],1)],1),e._v(" "),a("div",{staticClass:"grant-wrapper"},[a("div",{staticClass:"operation-wrapper"},[a("div",[e._v("Other Groups")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){e.user={},e.editGrantUserVisible=!0}}},[e._v("Grant")])],1),e._v(" "),a("el-table",{attrs:{data:e.grantedUserList}},[a("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"userName",label:"User Name"}}),e._v(" "),a("el-table-column",{attrs:{label:"User Role"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.userRole?a("el-tag",{attrs:{size:"small",type:"success"}},[e._v("Super Admin")]):1==t.row.userRole?a("el-tag",{attrs:{size:"small",type:"primary"}},[e._v("Admin")]):a("el-tag",{attrs:{size:"small",type:"info"}},[e._v("Member")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"Avatar"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-image",{attrs:{src:t.row.avatar,fit:"cover"}},[a("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[e._v(e._s(t.row.userName))])])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"email",label:"Email"}}),e._v(" "),a("el-table-column",{attrs:{prop:"mobile",label:"Mobile"}}),e._v(" "),a("el-table-column",{attrs:{prop:"time",label:"Time"}}),e._v(" "),a("el-table-column",{attrs:{label:"Operation",width:"200px;"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(a){return e.handleRevoke(t.row)}}},[e._v("Revoke")])]}}])})],1)],1),e._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.saveUserLoading,expression:"saveUserLoading"}],attrs:{title:"Create User",visible:e.editUserVisible},on:{"update:visible":function(t){e.editUserVisible=t}}},[a("el-form",{ref:"user",attrs:{model:e.user,rules:e.rules,"label-width":"100px",size:"small"}},[a("el-form-item",{attrs:{label:"Group Name"}},[a("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.currentGroup.groupName))])],1),e._v(" "),a("el-form-item",{attrs:{prop:"userRole",label:"User Role"}},[a("el-select",{attrs:{placeholder:"Please select user role"},model:{value:e.user.userRole,callback:function(t){e.$set(e.user,"userRole",t)},expression:"user.userRole"}},[a("el-option",{attrs:{label:"Member",value:2}}),e._v(" "),e.currentUser.userRole<2?a("el-option",{attrs:{label:"Admin",value:1}}):e._e(),e._v(" "),e.currentUser.userRole<1?a("el-option",{attrs:{label:"Super Admin",value:0}}):e._e()],1)],1),e._v(" "),a("el-form-item",{attrs:{prop:"userName",label:"User Name"}},[a("el-input",{model:{value:e.user.userName,callback:function(t){e.$set(e.user,"userName","string"==typeof t?t.trim():t)},expression:"user.userName"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"password",label:"Password"}},[a("el-input",{model:{value:e.user.password,callback:function(t){e.$set(e.user,"password","string"==typeof t?t.trim():t)},expression:"user.password"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"email",label:"Email"}},[a("el-input",{model:{value:e.user.email,callback:function(t){e.$set(e.user,"email","string"==typeof t?t.trim():t)},expression:"user.email"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"mobile",label:"Mobile"}},[a("el-input",{model:{value:e.user.mobile,callback:function(t){e.$set(e.user,"mobile","string"==typeof t?t.trim():t)},expression:"user.mobile"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveUser("user")}}},[e._v("Confirm")])],1)],1),e._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.grantUserLoading,expression:"grantUserLoading"}],attrs:{title:"Grant User",visible:e.editGrantUserVisible},on:{"update:visible":function(t){e.editGrantUserVisible=t}}},[a("el-form",{ref:"user",attrs:{model:e.user,rules:e.grantUserRules,"label-width":"100px",size:"small"}},[a("el-form-item",{attrs:{label:"Group Name"}},[a("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.currentGroup.groupName))])],1),e._v(" "),a("el-form-item",{attrs:{prop:"userRole",label:"User Role"}},[a("el-select",{attrs:{placeholder:"Please select user role"},model:{value:e.user.userRole,callback:function(t){e.$set(e.user,"userRole",t)},expression:"user.userRole"}},[a("el-option",{attrs:{label:"Member",value:2}}),e._v(" "),e.currentUser.userRole<2?a("el-option",{attrs:{label:"Admin",value:1}}):e._e(),e._v(" "),e.currentUser.userRole<1?a("el-option",{attrs:{label:"Super Admin",value:0}}):e._e()],1)],1),e._v(" "),a("el-form-item",{attrs:{prop:"userName",label:"User Name"}},[a("el-input",{model:{value:e.user.userName,callback:function(t){e.$set(e.user,"userName","string"==typeof t?t.trim():t)},expression:"user.userName"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.saveGroupUser("user")}}},[e._v("Confirm")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"Delete User",visible:e.deleteUserVisible,width:"30%"},on:{"update:visible":function(t){e.deleteUserVisible=t}}},[a("span",[e._v("\n      Are you sure to delete\n      "),a("b",[e._v(e._s(e.user.userName))]),e._v(" ?\n    ")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.deleteUserVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.deleteUser()}}},[e._v("Delete")])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"Revoke User",visible:e.revokeUserVisible,width:"30%"},on:{"update:visible":function(t){e.revokeUserVisible=t}}},[a("span",[e._v("\n      Are you sure to revoke\n      "),a("b",[e._v(e._s(e.user.userName))]),e._v(" ?\n    ")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.revokeUserVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.revokeUser()}}},[e._v("Revoke")])],1)])],1)},staticRenderFns:[]},!1,function(e){a("Qgiq")},"data-v-d5c19714",null).exports,fe={data:function(){return{user:{},avatarUrl:"/user/saveAvatar",rules:{password:[{required:!0,message:"Please enter password",trigger:"blur"}],email:[{validator:function(e,t,a){if(!o(t)&&!u(t))return a(new Error("Incorrect format"));a()},trigger:"blur"}],mobile:[{validator:function(e,t,a){if(!o(t)&&!c(t))return a(new Error("Incorrect format"));a()},trigger:"blur"}]},updateUserLoading:!1}},methods:{getUser:function(e){var t=this,a="/user/getUser/"+e;vt.get(a,null,function(e){var a=e.data;if(0==a.code){var r=a.data,s=r.avatar;o(s)||(r.avatar=""+s),t.user=r}else v.error("Get user failed"),t.user=t.currentUser},function(e){v.error(e)})},updateUser:function(e){var t=this;this.$refs[e].validate(function(e){e&&(t.updateUserLoading=!0,vt.post("/user/updateUser",t.user,function(e){0==e.data.code?v.success("update user successfully"):v.error("update user failed"),t.updateUserLoading=!1},function(e){t.updateUserLoading=!1,v.error(e)}))})},resetUser:function(e){this.getUser(this.currentUser.userId)},handleAvatarSuccess:function(e,t){var a=URL.createObjectURL(t.raw);this.user.avatar=a;var r=yt.getters.getUser;r.avatar=a,yt.dispatch("setUser",r)},beforeAvatarUpload:function(e){var t="image/jpeg"===e.type||"image/jpg",a=e.size/1024/1024<5;return t||v.error("Uploading images can only be in JPG or PNG format!"),a||v.error("Upload image size can't exceed 5MB!"),t&&a}},computed:{currentUser:function(){return yt.getters.getUser}},mounted:function(){var e=this.currentUser.userId;e!=this.$route.params.userId&&this.$$router.push({name:"profile",params:{userId:e}}),this.getUser(e)}},ve=a("VU/8")(fe,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.updateUserLoading,expression:"updateUserLoading"}],staticClass:"body-wrapper",attrs:{id:"profile"}},[a("div",{staticClass:"profile-wrapper"},[a("el-form",{ref:"user",attrs:{model:e.user,"status-icon":"","label-width":"100px",rules:e.rules}},[a("el-form-item",{attrs:{label:"Avatar"}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{name:"avatarFile",action:e.avatarUrl,"show-file-list":!1,"on-success":e.handleAvatarSuccess,data:e.user,"before-upload":e.beforeAvatarUpload,title:"Change avatar"}},[null!=e.user.avatar&&""!=e.user.avatar?a("img",{staticClass:"avatar",staticStyle:{"object-fit":"cover"},attrs:{src:e.user.avatar}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e._v(" "),a("el-form-item",{attrs:{label:"User Role",prop:"userRole"}},[0==e.user.userRole?a("el-tag",{attrs:{size:"small"}},[e._v("Super Admin")]):e._e(),e._v(" "),1==e.user.userRole?a("el-tag",{attrs:{size:"small"}},[e._v("Admin")]):e._e(),e._v(" "),2==e.user.userRole?a("el-tag",{attrs:{size:"small"}},[e._v("Member")]):e._e()],1),e._v(" "),a("el-form-item",{attrs:{label:"User Name",prop:"userName"}},[a("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.user.userName))])],1),e._v(" "),a("el-form-item",{attrs:{label:"Password",prop:"password"}},[a("el-input",{attrs:{size:"small",type:"password",maxlength:"255","show-password":""},model:{value:e.user.password,callback:function(t){e.$set(e.user,"password","string"==typeof t?t.trim():t)},expression:"user.password"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Email",prop:"email"}},[a("el-input",{attrs:{size:"small"},model:{value:e.user.email,callback:function(t){e.$set(e.user,"email","string"==typeof t?t.trim():t)},expression:"user.email"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Mobile",prop:"mobile"}},[a("el-input",{attrs:{size:"small"},model:{value:e.user.mobile,callback:function(t){e.$set(e.user,"mobile",e._n(t))},expression:"user.mobile"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.updateUser("user")}}},[e._v("Update")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:function(t){return e.resetUser("user")}}},[e._v("Reset")])],1)],1)],1)])},staticRenderFns:[]},!1,function(e){a("As7w")},"data-v-60485a73",null).exports,he={components:{codemirror:P.codemirror},data:function(){return{histrory:"",clusterList:[],dbList:[],selectedClusterId:"",selectedCluster:{},database:"",command:"",connected:!1,consoleDisabled:!0}},methods:{getClusterList:function(e){var t=this,a="/cluster/getClusterList/"+e;o(e)||vt.get(a,null,function(e){var a=e.data;0==a.code?t.clusterList=a.data:v.error("Get cluster list failed")},function(e){v.error(e)})},resetStatus:function(){this.consoleDisabled=!0,this.connected=!1,this.dbList=[],this.database="",this.histrory=""},getDBList:function(e){var t=this;if(o(e))v.warning("Please select cluster");else if(this.clusterList.forEach(function(a){a.clusterId==e&&(t.selectedCluster=a)}),this.resetStatus(),"cluster"!=this.selectedCluster.redisMode){var a="/data/getDBList/"+e;vt.get(a,null,function(e){t.dbList=[];var a=e.data;0==a.code?a.data.forEach(function(e){var a=e.database;t.dbList.push(a.slice(2))}):v.error(a.message)},function(e){v.error(e)})}else this.dbList.push(0)},handleSelectDB:function(e){o(e)||(this.consoleDisabled=!1,this.connected=!0)},sendCommand:function(e){var t=this;vt.post("/data/sendCommand",e,function(e){var a=e.data;if(0==a.code){var r=a.data;"string"!=typeof r&&(r=R()(r)),t.histrory+="["+t.selectedCluster.clusterName+"]$ "+t.command+"<br/>"+r+"<br/>"}else t.histrory+="["+t.selectedCluster.clusterName+"]$ "+t.command+"\n no data or operation failed or command not support \n";t.command=""},function(e){v.error(e)})},keyUpEnter:function(){if(!o(this.command)){if("clear"==this.command)return this.histrory="",void(this.command="");if(o(this.selectedClusterId))v.warning("Please select cluster");else if(o(this.database))v.warning("Please select database");else{var e={clusterId:this.selectedClusterId,database:this.database,command:this.command};this.sendCommand(e)}}},reset:function(){this.histrory="",this.clusterList=[],this.dbList=[],this.selectedClusterId="",this.selectedCluster={},this.database="",this.command=""}},computed:{currentGroup:function(){return yt.getters.getCurrentGroup}},watch:{currentGroup:function(e){this.reset(),this.getClusterList(e.groupId),this.$router.push({name:"data-operation",params:{groupId:e.groupId}})}},mounted:function(){this.getClusterList(this.currentGroup.groupId)}},ge=a("VU/8")(he,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"body-wrapper",attrs:{id:"data-operation"}},[a("el-row",[a("el-col",{staticClass:"select-wrapper",attrs:{xl:24,lg:24,md:24,sm:24}},[a("el-select",{attrs:{size:"small",placeholder:"Select cluster"},on:{change:function(t){return e.getDBList(e.selectedClusterId)}},model:{value:e.selectedClusterId,callback:function(t){e.selectedClusterId=t},expression:"selectedClusterId"}},e._l(e.clusterList,function(e){return a("el-option",{key:e.clusterId,attrs:{label:e.clusterName,value:e.clusterId}})}),1),e._v(" "),a("el-select",{attrs:{size:"small",placeholder:"Select db",filterable:"","allow-create":""},on:{change:function(t){return e.handleSelectDB(e.database)}},model:{value:e.database,callback:function(t){e.database=t},expression:"database"}},e._l(e.dbList,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),a("el-col",{attrs:{xl:24,lg:24,md:24,sm:24}},[a("div",{staticClass:"console-wrapper"},[a("div",{staticClass:"console-title"},[e._v("Redis Command")]),e._v(" "),a("div",{staticClass:"console"},[e.connected?a("div",{staticClass:"connected"},[e._v("Redis connected...")]):e._e(),e._v(" "),a("div",{staticClass:"command-history-wrapper"},[a("div",{staticClass:"history",domProps:{innerHTML:e._s(e.histrory)}})]),e._v(" "),a("div",{staticClass:"command"},[a("div",{staticStyle:{"max-width":"50%","margin-right":"5px"}}),e._v(" "),a("el-input",{staticClass:"command-input",attrs:{size:"small",type:"text",disabled:e.consoleDisabled},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.keyUpEnter(e.command)}},model:{value:e.command,callback:function(t){e.command=t},expression:"command"}},[a("template",{slot:"prepend"},[e._v("["+e._s(e.selectedCluster.clusterName)+"]$")])],2)],1)])])])],1)],1)},staticRenderFns:[]},!1,function(e){a("dqEZ")},"data-v-28725923",null).exports,be={methods:{toDashboard:function(){this.$router.push({name:"dashboard",params:{groupId:this.currentGroup.groupId}})}},computed:{currentGroup:function(){return yt.getters.getCurrentGroup}}},_e=a("VU/8")(be,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-container"},[a("p",{staticClass:"code"},[e._v("404")]),e._v(" "),a("div",[a("el-link",{on:{click:function(t){return e.toDashboard()}}},[e._v("Back to home page")])],1)])},staticRenderFns:[]},!1,function(e){a("JwGp")},"data-v-529d0beb",null).exports,ye={data:function(){return{historyList:[],currentPageNo:1,pageSize:10,totalPage:0,paginationShow:!1,totalCount:0}},methods:{loadHistoryData:function(e){var t=this,a="/operation/group/"+e+"?pageNo="+this.currentPageNo;vt.get(a,null,function(e){var a=e.data;if(0==a.code){var r=a.data.logData;r.forEach(function(e){e.logTime=y(e.logTime)}),t.historyList=r,t.totalCount=a.data.totalCount,t.totalPage=a.data.totalPage,t.totalPage>1&&(t.paginationShow=!0)}else v.error("Get edit history list failed")},function(e){401===e.response.status?(v.error("Session Timeout! Please Login again"),t.$router.push({name:"login"})):v.error(e)})},handleCurrentChange:function(e){this.currentPageNo=e;var t=this.currentGroupId;this.loadHistoryData(t)},getIndex:function(e){return this.indexBasic+e+1}},computed:{currentGroupId:function(){return yt.getters.getCurrentGroup.groupId},indexBasic:function(){return(this.currentPageNo-1)*this.pageSize}},watch:{currentGroupId:function(e){this.currentPageNo=1,this.pageSize=10,this.totalPage=0,this.paginationShow=!1,this.totalCount=0,this.loadHistoryData(e)}},mounted:function(){var e=this.currentGroupId;this.loadHistoryData(e)}},Ce=a("VU/8")(ye,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"body-wrapper",staticStyle:{display:"none"},style:{display:"block"},attrs:{id:"rule-manage"}},[a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.historyList,stripe:""}},[a("el-table-column",{attrs:{type:"index",index:e.getIndex,label:"ID","min-width":"15%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"groupName",label:"GroupName","min-width":"15%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"userName",label:"UserName","min-width":"15%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"userIp",label:"UserIP","min-width":"15%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"operationInfo",label:"OperationInfo","min-width":"20%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"logTime",label:"LogTime","min-width":"20%"}})],1)],1),e._v(" "),a("div",{staticClass:"block"},[e.paginationShow?a("el-pagination",{staticStyle:{"text-align":"center"},attrs:{"current-page":e.currentPageNo,"page-size":e.pageSize,layout:"prev, pager, next, jumper",total:e.totalCount},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.currentPageNo=t},"update:current-page":function(t){e.currentPageNo=t}}}):e._e()],1)])},staticRenderFns:[]},!1,function(e){a("rA2g")},"data-v-05116486",null).exports,we=a("Xxa5"),ke=a.n(we),Ie=a("exGp"),xe=a.n(Ie),Le=a("woOf"),Ne=a.n(Le),Se=a("//Fk"),Re=a.n(Se);function Pe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Re.a(function(r,s){ze({method:t,url:e,headers:{UserIp:yt.getters.getUserIp},data:"POST"===t||"PUT"===t?a:null,params:"GET"===t||"DELETE"===t?a:null}).then(function(e){r(e)}).catch(function(e){return!e.response||401!==e.response.code&&404!==e.response.status||(v.warning("user infomation has expried,please login!"),mt.push({name:"login"})),Re.a.reject(new Error("error"))})})}function Me(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return ze({method:t,url:e,headers:{UserIp:yt.getters.getUserIp},data:"POST"===t||"PUT"===t?a:null,params:"GET"===t||"DELETE"===t?a:null})}l.a.defaults.baseURL="/";var ze=l.a.create({timeout:12e4});ze.interceptors.response.use(function(e){var t=e.data;return 0!==t.code?(v.error(t.data||"error"),Re.a.reject(new Error(t.data||"error"))):Re.a.resolve(t)},function(e){return!e.response||401!==e.response.code&&404!==e.response.status||(v.warning("user infomation has expried,please login!"),mt.push({name:"login"})),Re.a.reject(new Error("error"))});var Ae=function(e){return Me("/cluster/getClusterList/"+e)},Ee=function(e){return Pe("/rdb/results?groupId="+e)},Ve={props:{groupId:{type:Number},from:{type:Object},edit:{type:Boolean},redisClusterList:{type:Array}},data:function(){var e=this;return{analyseisJobFrom:{id:"",clusterId:"",autoAnalyze:!1,schedule:"",analyzer:"0",dataPath:"",prefixes:"",report:!1,groupId:this.groupId,mailTo:""},rules:{clusterId:[{required:!0,message:"cluster can't be empty",trigger:"change"}],schedule:[{required:!0,message:"schedule can't be empty",trigger:"blur"}],analyzer:[{type:"array",required:!0,message:"analyzer can't be empty",trigger:"change"}],dataPath:[{required:!0,message:"dataPath can't be empty",trigger:"blur"}],mailTo:[{validator:function(t,a,r){if(e.analyseisJobFrom.report){if(""===a||null===a)return r(new Error("if you need open the report switch,you must input the email"));var s=/^([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;if(-1!==a.search(";"))a.split(";").map(function(e){if(!s.test(e))return r(new Error("email address is invaild,please check!"))});else if(!s.test(a))return r(new Error("email address is invaild,please check!"))}return r()},trigger:"blur"}]},scheduleCron:[],labelPosition:"right"}},methods:{cancelAnalyzeJobDialog:function(e){this.$refs[e].resetFields(),this.$emit("cancel",!1)},saveAnalyzeJob:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;var a,r=Ne()({},t.analyseisJobFrom);r.analyzer=r.analyzer.toString(),""===r.id?(a=r,Me("/rdb","POST",a)).then(function(e){v.success(e.data),t.$emit("cancel",!1),t.$emit("refresh",t.groupId)}):Me("/rdb","PUT",r).then(function(e){v.success(e.data),t.$emit("cancel",!1),t.$emit("refresh",t.groupId)})})},getRedisClusterList:function(){var e=this;Ae(this.groupId).then(function(t){e.redisClusterList=t.data})},inputChange:function(e){var t=this,a=e.trim();a&&Me("/rdb/test_corn","POST",{schedule:a}).then(function(e){t.scheduleCron=e.data})}},watch:{from:{immediate:!0,handler:function(e,t){var a=this;this.$nextTick(function(){e!==t&&a.edit&&(a.analyseisJobFrom=e,a.inputChange(a.analyseisJobFrom.schedule))})}},edit:{immediate:!0,handler:function(e,t){var a=this;this.$nextTick(function(){e!==t&&(a.edit=e)})}}},mounted:function(){}},Te=a("VU/8")(Ve,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form",{ref:"analyseisJobFrom",staticClass:"demo-ruleForm",attrs:{model:e.analyseisJobFrom,rules:e.rules,"label-width":"30%"}},[a("el-form-item",{attrs:{label:"Cluster Name",prop:"clusterId"}},[a("el-select",{staticClass:"input",attrs:{disabled:this.edit,placeholder:"Select Redis Cluster"},model:{value:e.analyseisJobFrom.clusterId,callback:function(t){e.$set(e.analyseisJobFrom,"clusterId",t)},expression:"analyseisJobFrom.clusterId"}},e._l(this.redisClusterList,function(e){return a("el-option",{key:e.clusterId,attrs:{label:e.clusterName,value:e.clusterId}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"Auto Analyze",prop:"autoAnalyze"}},[a("el-switch",{model:{value:e.analyseisJobFrom.autoAnalyze,callback:function(t){e.$set(e.analyseisJobFrom,"autoAnalyze",t)},expression:"analyseisJobFrom.autoAnalyze"}})],1),e._v(" "),e.analyseisJobFrom.autoAnalyze?a("el-form-item",{attrs:{label:"Schedule",prop:"schedule"}},[a("el-input",{staticClass:"input",attrs:{placeholder:"Please input schedule like this: 0 0/1 * * * ? (It is executed every minute)"},on:{input:e.inputChange},model:{value:e.analyseisJobFrom.schedule,callback:function(t){e.$set(e.analyseisJobFrom,"schedule",t)},expression:"analyseisJobFrom.schedule"}}),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{placement:"right",effect:"light"}},[a("div",{attrs:{slot:"content"},slot:"content"},[a("ul",e._l(e.scheduleCron,function(t){return a("li",{key:t},[e._v(e._s(t))])}),0)]),e._v(" "),a("i",{staticClass:"el-icon-message-solid"})])],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"DataPath",prop:"dataPath"}},[a("el-input",{staticClass:"input",attrs:{placeholder:"Please dataPath"},model:{value:e.analyseisJobFrom.dataPath,callback:function(t){e.$set(e.analyseisJobFrom,"dataPath",t)},expression:"analyseisJobFrom.dataPath"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Report",prop:"report"}},[a("el-switch",{model:{value:e.analyseisJobFrom.report,callback:function(t){e.$set(e.analyseisJobFrom,"report",t)},expression:"analyseisJobFrom.report"}})],1),e._v(" "),e.analyseisJobFrom.report?a("el-form-item",{attrs:{label:"Mail",prop:"mailTo"}},[a("el-input",{staticClass:"input",attrs:{type:"textarea",rows:2,placeholder:"Please input email address with ';'"},model:{value:e.analyseisJobFrom.mailTo,callback:function(t){e.$set(e.analyseisJobFrom,"mailTo",t)},expression:"analyseisJobFrom.mailTo"}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"Custom Prefixes",prop:"prefixes"}},[a("el-input",{staticClass:"input",attrs:{type:"textarea",rows:2,placeholder:"Please input your custom prefixe with ','"},model:{value:e.analyseisJobFrom.prefixes,callback:function(t){e.$set(e.analyseisJobFrom,"prefixes",t)},expression:"analyseisJobFrom.prefixes"}})],1),e._v(" "),a("el-form-item",[a("div",{staticClass:"footer"},[a("el-button",{attrs:{size:"mini",type:"info",plain:""},on:{click:function(t){return e.cancelAnalyzeJobDialog("analyseisJobFrom")}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.saveAnalyzeJob("analyseisJobFrom")}}},[e._v("Confirm")])],1)])],1)},staticRenderFns:[]},!1,function(e){a("OFz5")},"data-v-42a4004c",null).exports,De={props:{groupId:{type:Number},analyze:{type:Boolean},from:{type:Object},redisClusterList:{type:Array}},data:function(){var e=this;return{analyseisJobFrom:{id:"",clusterId:"",cluster:"",nodes:["-1"],schedule:"",analyzer:"0",dataPath:"",prefixes:"",report:!1,groupId:this.groupId,manual:!1,mailTo:""},isAllNodes:!1,loading:!1,rules:{name:[{required:!0,message:"name can't be empty",trigger:"blur"}],schedule:[{required:!0,message:"schedule can't be empty",trigger:"blur"}],mailTo:[{validator:function(t,a,r){if(e.analyseisJobFrom.report){if(""===a||null===a)return r(new Error("if you need open the report switch,you must input the email"));var s=/^([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;if(-1!==a.search(";"))a.split(";").map(function(e){if(!s.test(e))return r(new Error("email address is invaild,please check!"))});else if(!s.test(a))return r(new Error("email address is invaild,please check!"))}return r()},trigger:"blur"}]},redisNodeList:[],analyzeVisable:!1,labelPosition:"right"}},methods:{cancelAnalyzeJobDialog:function(e){this.$refs[e].resetFields(),this.$emit("cancel",!1)},AnalyzeJob:function(e){var t=this;return xe()(ke.a.mark(function e(){var a;return ke.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,(a=Ne()({},t.analyseisJobFrom)).manual=!0,e.next=5,(r=a,Me("/rdb/allocation_job","POST",r)).then(function(e){e.data.status?t.$router.push({name:"TaskProgress",params:{clusterId:a.clusterId,clusterName:a.cluster.clusterName}}):v.error(e.data.message),t.loading=!1});case 5:case"end":return e.stop()}var r},e,t)}))()},openAnalyzeDialog:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.analyzeVisable=!0})},getRedisNodeList:function(){var e,t=this;(e=this.from.clusterId,Me("/node-manage/getAllNodeList/"+e)).then(function(e){t.redisNodeList=e.data}),this.analyseisJobFrom.nodes=["0"],this.isAllNodes=!0},changeNodes:function(e){var t=this;0===e.length&&(this.isAllNodes=!1),e.map(function(e,a){"-1"===e&&(t.isAllNodes=!0,t.analyseisJobFrom.nodes=["-1"])})}},watch:{from:{immediate:!0,handler:function(e,t){var a=this;this.$nextTick(function(){e!==t&&(a.analyseisJobFrom=e,a.analyseisJobFrom.nodes=["-1"])})}},analyze:{immediate:!0,handler:function(e,t){var a=this;this.$nextTick(function(){e!==t&&(a.analyze=e)})}}},mounted:function(){this.getRedisNodeList()}},Ue={components:{addJob:Te,analyzeJob:a("VU/8")(De,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"analyseisJobFrom",staticClass:"demo-ruleForm",attrs:{model:e.analyseisJobFrom,rules:e.rules,"label-width":"30%"}},[a("el-form-item",{attrs:{label:"Cluster Name"}},[a("el-select",{staticClass:"input",attrs:{placeholder:"Select Redis Cluster",disabled:this.analyze},model:{value:e.analyseisJobFrom.clusterId,callback:function(t){e.$set(e.analyseisJobFrom,"clusterId",t)},expression:"analyseisJobFrom.clusterId"}},e._l(this.redisClusterList,function(e){return a("el-option",{key:e.clusterId,attrs:{label:e.clusterName,value:e.clusterId}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"Nodes",prop:"nodes"}},[a("el-select",{staticClass:"input",attrs:{placeholder:"Select Analyze Nodes",multiple:""},on:{change:e.changeNodes},model:{value:e.analyseisJobFrom.nodes,callback:function(t){e.$set(e.analyseisJobFrom,"nodes",t)},expression:"analyseisJobFrom.nodes"}},[a("el-option",{attrs:{value:"-1",label:"Cluster"}}),e._v(" "),e._l(this.redisNodeList,function(t){return a("el-option",{key:t.host+":"+t.port,attrs:{label:t.flags+" "+t.host+":"+t.port,value:t.host+":"+t.port,disabled:e.isAllNodes}})})],2)],1),e._v(" "),a("el-form-item",{attrs:{label:"DataPath",prop:"dataPath"}},[a("el-input",{staticClass:"input",attrs:{placeholder:"Please dataPath",disabled:this.analyze},model:{value:e.analyseisJobFrom.dataPath,callback:function(t){e.$set(e.analyseisJobFrom,"dataPath",t)},expression:"analyseisJobFrom.dataPath"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Report",prop:"report"}},[a("el-switch",{model:{value:e.analyseisJobFrom.report,callback:function(t){e.$set(e.analyseisJobFrom,"report",t)},expression:"analyseisJobFrom.report"}})],1),e._v(" "),e.analyseisJobFrom.report?a("el-form-item",{attrs:{label:"Mail",prop:"mailTo"}},[a("el-input",{staticClass:"input",attrs:{type:"textarea",rows:2,placeholder:"Please input email address with ';'"},model:{value:e.analyseisJobFrom.mailTo,callback:function(t){e.$set(e.analyseisJobFrom,"mailTo",t)},expression:"analyseisJobFrom.mailTo"}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"Custom Prefixes",prop:"prefixes"}},[a("el-input",{staticClass:"input",attrs:{type:"textarea",rows:2,placeholder:"Please input your custom prefixe with ','"},model:{value:e.analyseisJobFrom.prefixes,callback:function(t){e.$set(e.analyseisJobFrom,"prefixes",t)},expression:"analyseisJobFrom.prefixes"}})],1),e._v(" "),a("el-form-item",[a("div",{staticClass:"footer"},[a("el-button",{attrs:{size:"mini",type:"info",plain:""},on:{click:function(t){return e.cancelAnalyzeJobDialog("analyseisJobFrom")}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.openAnalyzeDialog("analyseisJobFrom")}}},[e._v("Analyze")])],1)])],1),e._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.loading,expression:"loading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{title:"Analyze Job",visible:e.analyzeVisable,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.analyzeVisable=t}}},[a("span",[e._v("\r\n        Are you sure to Analyze this job?\r\n      ")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.analyzeVisable=!1}}},[e._v("No")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.AnalyzeJob(e.analyseisJobFrom)}}},[e._v("Yes")])],1)])],1)},staticRenderFns:[]},!1,function(e){a("VG2S")},"data-v-4881161a",null).exports},data:function(){return{analyseisJobs:[],jobDialogVisible:!1,isEdit:!1,analyseisJobFrom:{id:"",clusterId:"",cluster:"",autoAnalyze:!1,schedule:"",analyzer:"0",dataPath:"",prefixes:"",report:!1,groupId:"",mailTo:""},deleteVisible:!1,loading:!1,jobDialogLoading:!1,analyseisVisable:!1,redisClusterList:[]}},methods:{editAnalysisJob:function(e,t){this.isEdit=!0,this.jobDialogVisible=!0,this.analyseisJobFrom=Ne()({},t)},handleDelete:function(e,t){this.deleteVisible=!0,this.analyseisJobFrom=t},handleAnalyze:function(e,t){this.jobDialogVisible=!0,this.analyseisVisable=!0,this.isEdit=!1,this.analyseisJobFrom=Ne()({},t)},deleteAnalyzeJob:function(e){var t=this;(function(e){return Me("/rdb?id="+e,"DELETE")})(e).then(function(e){t.deleteVisible=!1,t.analyseisJobFrom={},t.getAnalysisJobList(t.currentGroup.groupId)})},addAnalysisJob:function(){this.analyseisJobFrom={},this.isEdit=!1,this.jobDialogVisible=!0},changeAnalyzeToArray:function(e){return null!=e&&""!==e?e instanceof Array||(e=e.split(",")):e=[],e},getAnalysisJobList:function(e){var t=this;return xe()(ke.a.mark(function a(){return ke.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t.loading=!0,a.next=3,(r=e,Me("/rdb?groupId="+r)).then(function(e){var a=e.data;t.analyseisJobs=a,t.loading=!1});case 3:case"end":return a.stop()}var r},a,t)}))()},cancel:function(e){this.jobDialogVisible=e,this.analyseisVisable&&(this.analyseisVisable=e)},getRedisClusterList:function(e){var t=this;Ae(e).then(function(e){t.redisClusterList=e.data})}},computed:{currentGroup:function(){return yt.getters.getCurrentGroup}},watch:{currentGroup:function(e){this.getAnalysisJobList(e.groupId),this.getRedisClusterList(e.groupId)},visable:{immediate:!0,handler:function(e,t){var a=this;this.$nextTick(function(){a.jobDialogVisible=e})}}},mounted:function(){var e=this.currentGroup.groupId;this.getAnalysisJobList(e),this.getRedisClusterList(e)}},Ge=a("VU/8")(Ue,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.jobDialogVisible?e._e():a("div",{staticClass:"body-wrapper",attrs:{id:"analysis"}},[a("div",{staticClass:"header-wrapper"},[a("div"),e._v(" "),a("div",[a("el-button",{attrs:{size:"small",type:"primary",plain:"",icon:"el-icon-plus"},on:{click:function(t){return e.addAnalysisJob()}}},[e._v("New Job")])],1)]),e._v(" "),a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"table",attrs:{data:e.analyseisJobs,stripe:""}},[a("el-table-column",{attrs:{label:"Cluster Name",property:"cluster.clusterName"}}),e._v(" "),a("el-table-column",{attrs:{label:"Schedule",property:"schedule"},scopedSlots:e._u([{key:"default",fn:function(t){return[""!==t.row.schedule&&null!==t.row.schedule?a("span",[e._v(e._s(t.row.schedule))]):a("span",{attrs:{type:"success"}},[e._v("-")])]}}],null,!1,2803632085)}),e._v(" "),a("el-table-column",{attrs:{label:"AutoAnalyze",property:"autoAnalyze"},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.autoAnalyze?a("el-image",{attrs:{src:"../../../static/on.svg"}}):a("el-image",{attrs:{src:"../../../static/off.svg"}})]}}],null,!1,2876890297)}),e._v(" "),a("el-table-column",{attrs:{label:"Operation"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-edit"},on:{click:function(a){return e.editAnalysisJob(t.$index,t.row)}}},[e._v("Edit")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger",plain:"",icon:"el-icon-delete"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("Del")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"warning",icon:"el-icon-s-data"},on:{click:function(a){return e.handleAnalyze(t.$index,t.row)}}},[e._v("Analyze")])]}}],null,!1,2858135306)})],1)],1)]),e._v(" "),e.jobDialogVisible?a("div",{staticClass:"body-wrapper"},[a("div",{staticClass:"header-wrapper"},[this.isEdit?a("div",[e._v("Edit Job")]):e._e(),e._v(" "),this.analyseisVisable?a("div",[e._v("Analyze Job")]):e._e(),e._v(" "),this.isEdit||this.analyseisVisable?e._e():a("div",[e._v("Add Job")])]),e._v(" "),a("div",{staticClass:"addJob"},[this.analyseisVisable?a("analyzeJob",{attrs:{from:this.analyseisJobFrom,redisClusterList:this.redisClusterList,analyze:this.analyseisVisable},on:{cancel:e.cancel}}):a("addJob",{attrs:{groupId:this.currentGroup.groupId,from:this.analyseisJobFrom,edit:this.isEdit,redisClusterList:this.redisClusterList},on:{cancel:e.cancel,refresh:e.getAnalysisJobList}})],1)]):e._e(),e._v(" "),a("el-dialog",{attrs:{title:"Delete Alert Rule",visible:e.deleteVisible,width:"30%"},on:{"update:visible":function(t){e.deleteVisible=t}}},[a("span",[e._v("\n      Are you sure to delete\n      "),a("b",[e._v(e._s(e.analyseisJobFrom.name))]),e._v(" ?\n    ")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(t){e.deleteVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.deleteAnalyzeJob(e.analyseisJobFrom.id)}}},[e._v("Delete")])],1)])],1)},staticRenderFns:[]},!1,function(e){a("zP2M")},"data-v-27539129",null).exports,$e={data:function(){return{originalData:[],analyseisJobDetail:[],cancelButtonDisabled:!1,searchData:"",loading:!1,clusterName:""}},created:function(){var e=this,t=this.$route.params.clusterId;this.timer=setInterval(function(){e.getAllScheduleDetail(t)},3e3)},beforeDestroy:function(){this.timer&&clearInterval(this.timer)},methods:{getAllScheduleDetail:function(e){var t=this;(function(e){return Me("/rdb/schedule_detail/"+e)})(e).then(function(e){if(t.originalData=e.data,t.analyseisJobDetail=e.data,t.searchData){var a=t.originalData.filter(function(e,a){return e.instance.includes(t.searchData)});t.analyseisJobDetail=a}for(var r=0,s=0;s<t.originalData.length;s++)"DONE"===t.originalData[s].status&&(r+=1),"CANCELED"===t.originalData[s].status&&(t.originalData[s].process=0,t.cancelButtonDisabled=!0,t.loading=!1,t.stopTimer());r===t.originalData.length&&(t.cancelButtonDisabled=!0,t.stopTimer())})},backHistory:function(){this.$router.push({name:"jobList"})},stopTimer:function(){this.timer&&clearInterval(this.timer)},cancelAnalysis:function(){var e=this,t=this.originalData[0].scheduleID,a=this.$route.params.clusterId;this.$confirm("Are you sure you want to stop all task processes ?","Message",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning"}).then(function(){e.loading=!0,function(e,t){return Me("/rdb/cance_job/"+a+"/"+t)}(0,t).then(function(t){t.data.canceled?(e.cancelButtonDisabled=!0,e.$message({type:"success",message:"cancel job success!"}),e.loading=!1):(e.$message({type:"warning",message:"cancel job has error,Please pay attention to the task status!"}),e.loading=!1)})}).catch(function(){e.$message({type:"error",message:"cancel job has error,please check!"}),e.loading=!1})}},computed:{currentGroup:function(){return yt.getters.getCurrentGroup}},watch:{searchData:function(e){var t=this.originalData.filter(function(t,a){return t.instance.includes(e)});this.analyseisJobDetail=t}},mounted:function(){var e=this.$route.params.clusterId;this.clusterName=this.$route.params.clusterName,this.getAllScheduleDetail(e)}},Fe=a("VU/8")($e,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"body-wrapper",attrs:{id:"taskProgress"}},[a("div",{staticClass:"header-wrapper"},[a("div",{staticClass:"fieldStyle"},[a("el-image",{staticClass:"images",attrs:{src:"../../../static/back.svg"},on:{click:function(t){return e.backHistory()}}}),a("span",{staticStyle:{"margin-left":"30px","font-size":"20px"}},[e._v(e._s(e.clusterName))])],1),e._v(" "),a("div",{staticClass:"searchStyle"},[a("el-input",{attrs:{size:"mini","prefix-icon":"el-icon-search",placeholder:"input redis instance"},model:{value:e.searchData,callback:function(t){e.searchData=t},expression:"searchData"}})],1)]),e._v(" "),a("div",{staticClass:"cancelStyle"},[a("el-button",{attrs:{size:"mini",disabled:this.cancelButtonDisabled,type:"success"},on:{click:function(t){return e.cancelAnalysis()}}},[e._v("Cancel")])],1),e._v(" "),a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.analyseisJobDetail}},[a("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{sortable:"",label:"Redis Instance",property:"instance"}}),e._v(" "),a("el-table-column",{attrs:{label:"Status",property:"status"},scopedSlots:e._u([{key:"default",fn:function(t){return["RUNNING"===t.row.status?a("font",{attrs:{color:"#5485F7"}},[e._v("RUNNING")]):"DONE"===t.row.status?a("font",{attrs:{color:"#8000ff"}},[e._v("DONE")]):"READY"===t.row.status?a("font",{attrs:{color:"#0000a0"}},[e._v("READY")]):"CANCELED"===t.row.status?a("font",{attrs:{color:"999999"}},[e._v("CANCELED")]):"NOT_START"===t.row.status?a("font",{attrs:{color:"#FA7070"}},[e._v("NOT_START")]):"ERROR"===t.row.status?a("font",{attrs:{color:"#ff0000"}},[e._v("ERROR")]):"NOTINIT"===t.row.status?a("font",{attrs:{color:"#FA7070"}},[e._v("NOTINIT")]):"CHECKING"===t.row.status?a("font",{attrs:{color:"#FA7070"}},[e._v("CHECKING")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"Process",property:"process"},scopedSlots:e._u([{key:"default",fn:function(e){return[(e.row.status,a("el-progress",{attrs:{percentage:e.row.process}}))]}}])})],1)],1)])},staticRenderFns:[]},!1,function(e){a("9sqw")},"data-v-e42dde52",null).exports,Oe={data:function(){return{loading:!1,analyseResults:[],currentPage:1,pagesize:10,pageData:[],ConfigDetailVisible:!1,ConfigDetail:{},nodes:"",clusterName:""}},methods:{dateFormatter:function(e){return y(e.scheduleId)},handdleRowClick:function(e,t,a){e.done?this.toReportDetail(e):this.toTaskProgress(e)},handleCurrentChange:function(e){this.currentPage=e,this.pageData=this.analyseResults.slice((this.currentPage-1)*this.pagesize,this.currentPage*this.pagesize)},compareValue:function(e,t){return function(a,r){return"ascending"===t?a[e]-r[e]:r[e]-a[e]}},sortChange:function(e){e.order&&(this.analyseResults=this.analyseResults.sort(this.compareValue(e.prop,e.order)),this.pageData=this.analyseResults.slice((this.currentPage-1)*this.pagesize,this.currentPage*this.pagesize),this.currentPage=this.currentPage)},getAnalyseResults:function(e){var t=this;return xe()(ke.a.mark(function a(){var r;return ke.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t.loading=!0,a.next=3,Ee(e);case 3:r=a.sent,t.analyseResults=r.data,t.pageData=r.data.slice((t.currentPage-1)*t.pagesize,t.currentPage*t.pagesize),t.loading=!1;case 7:case"end":return a.stop()}},a,t)}))()},toTaskProgress:function(e){this.$router.push({name:"TaskProgress",params:{clusterId:e.clusterId,clusterName:e.clusterName}})},toReportDetail:function(e){this.$router.push({name:"jobResultDetail",params:{analyzeConfig:e.analyzeConfig,clusterName:e.clusterName},query:{detailId:e.id}})},closeHandler:function(){this.ConfigDetail={},this.clusterName="",this.nodes=""},getConfig:function(e,t){this.clusterName=t.clusterName,this.ConfigDetail=JSON.parse(t.analyzeConfig),this.ConfigDetailVisible=!0,this.setNodes(this.ConfigDetail.nodes)},setNodes:function(e){var t="";if(void 0==e)t="All Cluster Nodes";else for(var a in e)t="-1"===e[0]?"All Cluster Nodes":(t=t+e[a]+" ,").substring(0,t.lastIndexOf(","));this.nodes=t},getNodes:function(e,t){return this.getConfig(e,t),this.nodes}},computed:{currentGroup:function(){return yt.getters.getCurrentGroup}},watch:{currentGroup:function(e){this.getAnalyseResults(e.groupId),this.$router.push({name:"jobList",params:{groupId:e.groupId}})}},mounted:function(){var e=this.currentGroup.groupId;this.getAnalyseResults(e)}},Je={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"body-wrapper",attrs:{id:"jobList"}},[a("div",{staticClass:"header-wrapper"}),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{cursor:"pointer"},attrs:{data:e.pageData,"highlight-current-row":""},on:{"sort-change":e.sortChange,"row-click":e.handdleRowClick}},[a("el-table-column",{attrs:{type:"index"}}),e._v(" "),a("el-table-column",{attrs:{label:"Cluster Name",property:"clusterName"}}),e._v(" "),a("el-table-column",{attrs:{label:"IsCluster"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{attrs:{placement:"top",effect:"light"}},[a("div",{staticStyle:{width:"300px",display:"block","text-align":"center"},attrs:{slot:"content"},slot:"content"},[JSON.parse(t.row.analyzeConfig).nodes&&"-1"!==JSON.parse(t.row.analyzeConfig).nodes[0]?a("span",{attrs:{size:"small"}},[e._v(e._s(JSON.stringify(JSON.parse(t.row.analyzeConfig).nodes)))]):a("span",[e._v(" All Cluster Nodes")])]),e._v(" "),JSON.parse(t.row.analyzeConfig).nodes&&"-1"!==JSON.parse(t.row.analyzeConfig).nodes[0]?a("span",{attrs:{size:"small",type:"danger"}},[e._v("No")]):a("span",[e._v("Yes")])])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"Analyze Time",sortable:"",property:"scheduleId",formatter:e.dateFormatter}}),e._v(" "),a("el-table-column",{attrs:{label:"Status"},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.done?a("i",{staticClass:"el-icon-success status-icon normal-status"}):a("i",{staticClass:"el-icon-loading status-icon bad-status"})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"Config"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{staticStyle:{cursor:"pointer",color:"rgba(49, 128, 253, 0.65)"},on:{click:function(a){return a.stopPropagation(),e.getConfig(t.$index,t.row)}}},[e._v("\n          Detail\n        ")])]}}])})],1),e._v(" "),a("el-pagination",{staticClass:"pagination",attrs:{background:"","current-page":e.currentPage,"page-size":e.pagesize,layout:"prev, pager, next, jumper",total:e.analyseResults.length},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}}),e._v(" "),a("el-dialog",{attrs:{title:"Job Config",visible:e.ConfigDetailVisible,"close-on-click-modal":!1,width:"30%"},on:{"update:visible":function(t){e.ConfigDetailVisible=t},close:function(t){return e.closeHandler()}}},[a("div",{staticStyle:{padding:"10px 20px","text-align":"center"}},[a("ul",[a("li",{staticStyle:{padding:"15px 0px",display:"flex",borderTop:"1px solid #EEEFF3"}},[a("div",{staticStyle:{marginRight:"30px",textAlign:"right",width:"120px",color:"#999999"}},[e._v("Cluster Name:")]),e._v(" "),a("div",[e._v(e._s(e.clusterName))])]),e._v(" "),a("li",{staticStyle:{padding:"15px 0px",display:"flex",borderTop:"1px solid #EEEFF3"}},[a("div",{staticStyle:{marginRight:"30px",textAlign:"right",width:"120px",color:"#999999"}},[e._v("Nodes:")]),e._v(" "),a("div",{staticClass:"icoFontlist",attrs:{title:e.nodes}},[e._v(e._s(e.nodes))])]),e._v(" "),a("li",{staticStyle:{padding:"15px 0px",display:"flex",borderTop:"1px solid #EEEFF3"}},[a("div",{staticStyle:{marginRight:"30px",textAlign:"right",width:"120px",color:"#999999"}},[e._v("Auto Analyze:")]),e._v(" "),a("el-switch",{attrs:{disabled:"","active-color":"#00a000","inactive-color":"#404040"},model:{value:e.ConfigDetail.autoAnalyze,callback:function(t){e.$set(e.ConfigDetail,"autoAnalyze",t)},expression:"ConfigDetail.autoAnalyze"}})],1),e._v(" "),a("li",{staticStyle:{padding:"15px 0px",display:"flex",borderTop:"1px solid #EEEFF3"}},[a("div",{staticStyle:{marginRight:"30px",textAlign:"right",width:"120px",color:"#999999"}},[e._v("Schedule:")]),e._v(" "),a("div",[e._v(e._s(e.ConfigDetail.schedule))])]),e._v(" "),a("li",{staticStyle:{padding:"15px 0px",display:"flex",borderTop:"1px solid #EEEFF3"}},[a("div",{staticStyle:{marginRight:"30px",textAlign:"right",width:"120px",color:"#999999"}},[e._v("DataPath:")]),e._v(" "),a("div",{staticClass:"icoFontlist",attrs:{title:e.ConfigDetail.dataPath}},[e._v(e._s(e.ConfigDetail.dataPath))])]),e._v(" "),a("li",{staticStyle:{padding:"15px 0px",display:"flex",borderTop:"1px solid #EEEFF3"}},[a("div",{staticStyle:{marginRight:"30px",textAlign:"right",width:"120px",color:"#999999"}},[e._v("Custom Prefixes:")]),e._v(" "),a("div",{staticClass:"icoFontlist",attrs:{title:e.ConfigDetail.prefixes}},[e._v(e._s(e.ConfigDetail.prefixes))])]),e._v(" "),a("li",{staticStyle:{padding:"15px 0px",display:"flex",borderTop:"1px solid #EEEFF3"}},[a("div",{staticStyle:{marginRight:"30px",textAlign:"right",width:"120px",color:"#999999"}},[e._v("Report:")]),e._v(" "),a("el-switch",{attrs:{disabled:"","active-color":"#00a000","inactive-color":"#404040"},model:{value:e.ConfigDetail.report,callback:function(t){e.$set(e.ConfigDetail,"report",t)},expression:"ConfigDetail.report"}})],1),e._v(" "),a("li",{staticStyle:{padding:"15px 0px",display:"flex",borderTop:"1px solid #EEEFF3"}},[a("div",{staticStyle:{marginRight:"30px",textAlign:"right",width:"120px",color:"#999999"}},[e._v("Mail:")]),e._v(" "),a("div",{staticClass:"icoFontlist",attrs:{title:e.ConfigDetail.mailTo}},[e._v(e._s(e.ConfigDetail.mailTo))])])]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){e.ConfigDetailVisible=!1}}},[e._v("Ok")])],1)])])],1)},staticRenderFns:[]},qe=a("VU/8")(Oe,Je,!1,function(e){a("kjmf")},"data-v-0e52f2aa",null).exports,Be=a("Icdr");a("4UDB"),a("Oq2I"),a("miEh"),a("80cc");var Ke={props:{resultId:{type:String},selectPrefixValue:{type:String}},data:function(){return{id:"prefixKeysCount"}},methods:{initCharts:function(){var e=this;return xe()(ke.a.mark(function t(){var a,r,s,n,i,l;return ke.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Pe("/rdb/line/prefix/PrefixKeyByCount","GET",{analyzeResultId:e.resultId,prefixKey:e.selectPrefixValue});case 2:a=t.sent,r=a.data.time.map(function(e){return y(parseInt(e,10))}),s=a.data.data.map(function(e){return{name:e.key,type:"line",symbol:"circle",data:e.value.split(",").map(function(e){return parseInt(e,10)})}}),n={title:{text:"Prefix Keys Count"},tooltip:{trigger:"axis"},grid:{height:"400px",containLabel:!0},legend:{icon:"circle",bottom:0,padding:[0,50],data:s.map(function(e){return e.name}),formatter:function(e){return Be.format.truncateText(e,100,"10px Microsoft Yahei","")},tooltip:{show:!0}},xAxis:{type:"category",boundaryGap:!1,data:r},yAxis:{type:"value",scale:!0},series:s},i=document.getElementById(e.id),(l=Be.init(i)).clear(),l.setOption(n);case 10:case"end":return t.stop()}},t,e)}))()}},mounted:function(){this.initCharts()},watch:{selectPrefixValue:function(){this.initCharts()}}},He=a("VU/8")(Ke,{render:function(){var e=this.$createElement,t=this._self._c||e;return t("el-col",{staticClass:"chart-item",attrs:{xl:12,lg:12,md:24,sm:24}},[t("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[t("div",{staticClass:"chart",attrs:{id:this.id}})])],1)},staticRenderFns:[]},!1,function(e){a("/uQB")},"data-v-374e41ee",null).exports;function je(e){if(0===e)return"0 B";var t=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,t)).toFixed(1)+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t]}function We(e){return e.toString().replace(/(\d)(?=(\d{3})+(?:\.\d+)?$)/g,"$1,")}var Ze=a("Icdr");a("4UDB"),a("Oq2I"),a("miEh"),a("80cc");var Qe={props:{resultId:{type:String},selectPrefixValue:{type:String}},data:function(){return{id:"prefixKeysMemory"}},methods:{initCharts:function(){var e=this;return xe()(ke.a.mark(function t(){var a,r,s,n,i,l;return ke.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Pe("/rdb/line/prefix/PrefixKeyByMemory","GET",{analyzeResultId:e.resultId,prefixKey:e.selectPrefixValue});case 2:a=t.sent,r=a.data.time.map(function(e){return y(parseInt(e,10))}),s=a.data.data.map(function(e){return{name:e.key,type:"line",symbol:"circle",data:e.value.split(",").map(function(e){return parseInt(e,10)})}}),n={title:{text:"Prefix Keys Memory"},tooltip:{trigger:"axis",formatter:function(e){var t="";return e.forEach(function(e){t+=e.marker+" "+e.seriesName+" : "+je(e.value)+"</br>"}),t}},grid:{height:"400px",containLabel:!0},legend:{icon:"circle",bottom:0,padding:[0,50],data:s.map(function(e){return e.name}),formatter:function(e){return Ze.format.truncateText(e,100,"10px Microsoft Yahei","")},tooltip:{show:!0}},xAxis:{type:"category",boundaryGap:!1,data:r},yAxis:{type:"value",scale:!0,axisLabel:{formatter:function(e){return je(e)}}},series:s},i=document.getElementById(e.id),(l=Ze.init(i)).clear(),l.setOption(n);case 10:case"end":return t.stop()}},t,e)}))()}},mounted:function(){this.initCharts()},watch:{selectPrefixValue:function(){this.initCharts()}}},Ye=a("VU/8")(Qe,{render:function(){var e=this.$createElement,t=this._self._c||e;return t("el-col",{staticClass:"chart-item",attrs:{xl:12,lg:12,md:24,sm:24}},[t("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[t("div",{staticClass:"chart",attrs:{id:this.id}})])],1)},staticRenderFns:[]},!1,function(e){a("Zili")},"data-v-6a122700",null).exports,Xe=a("5YuA"),et=a("504h"),tt=a.n(et),at={components:{highcharts:Xe.Chart},props:{pieType:{type:String},resultId:{type:String}},data:function(){return{echartsData:[],chartOptions:{}}},methods:{myCallback:function(){},initCharts:function(){var e=this;return xe()(ke.a.mark(function t(){var a,r;return ke.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Pe("/rdb/chart/DataTypeAnalyze","GET",{analyzeResultId:e.resultId});case 2:a=t.sent,r=e.pieType,e.echartsData=a.data.map(function(t){return{name:t.dataType,y:"count"===e.pieType?parseInt(t.itemCount):parseInt(t.bytes)}}),e.chartOptions={chart:{height:300,plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},title:{text:"count"===e.pieType?"Key Count By Type":"Key Memory By Type"},credits:{enabled:!1},tooltip:{shadow:!0,animation:!0,formatter:function(){return"count"===r?" "+this.point.name+":<b>"+tt.a.numberFormat(this.point.percentage,1)+"%</b><br/>count:"+We(this.point.y):" "+this.point.name+":<b>"+tt.a.numberFormat(this.point.percentage,1)+"%</b><br/>memory:"+je(this.point.y)}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",colors:["#18BFA6","#84BF18"],dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:tt.a.theme&&tt.a.theme.contrastTextColor||"black"}}}},series:[{colorByPoint:!0,data:e.echartsData}]};case 6:case"end":return t.stop()}},t,e)}))()}},watch:{pieType:{immediate:!0,handler:function(e,t){var a=this;this.$nextTick(function(){e!==t&&(a.pieType=e)})}}},mounted:function(){this.initCharts()}},rt=a("VU/8")(at,{render:function(){var e=this.$createElement,t=this._self._c||e;return t("el-col",{staticClass:"chart-item",attrs:{xl:12,lg:12,md:24,sm:24}},[t("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[t("highcharts",{attrs:{options:this.chartOptions,callback:this.myCallback}})],1)],1)},staticRenderFns:[]},!1,function(e){a("yWEk")},"data-v-ee74d4e8",null).exports,st={props:{tabKey:{type:String},resultId:{type:String}},data:function(){return{tableData:[],currentPage:1,pagesize:10,pageData:[]}},methods:{initTable:function(){var e=this;return xe()(ke.a.mark(function t(){var a;return ke.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Pe("/rdb/top_key","GET",{analyzeResultId:e.resultId,type:e.tabKey});case 2:a=t.sent,e.tableData=a.data.map(function(e){return{bytes:parseInt(e.bytes),itemCount:parseInt(e.itemCount),key:e.key}}),e.pageData=e.tableData.slice((e.currentPage-1)*e.pagesize,e.currentPage*e.pagesize);case 5:case"end":return t.stop()}},t,e)}))()},compareValue:function(e,t){return function(a,r){return"ascending"===t?a[e]-r[e]:r[e]-a[e]}},sortChange:function(e){e.order&&(this.tableData=this.tableData.sort(this.compareValue(e.prop,e.order)),this.pageData=this.tableData.slice((this.currentPage-1)*this.pagesize,this.currentPage*this.pagesize),this.currentPage=this.currentPage)},handleCurrentChange:function(e){this.currentPage=e,this.pageData=this.tableData.slice((this.currentPage-1)*this.pagesize,this.currentPage*this.pagesize)},formatterCount:function(e,t,a){return We(a)},formatMemory:function(e,t,a){return je(a)}},mounted:function(){this.initTable()},watch:{scheduleId:{handler:function(){this.initTable()},deep:!0}}},nt=a("VU/8")(st,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-table",{attrs:{data:e.pageData},on:{"sort-change":e.sortChange}},[a("el-table-column",{attrs:{label:"PrefixKey",property:"key","show-overflow-tooltip":"","min-width":"500px"}}),e._v(" "),a("el-table-column",{attrs:{label:"itemCount",sortable:"",property:"itemCount",formatter:e.formatterCount,width:"300px"}}),e._v(" "),a("el-table-column",{attrs:{label:"Bytes",sortable:"",property:"bytes",formatter:e.formatMemory,"min-width":"300px"}})],1),e._v(" "),a("div",[a("el-pagination",{staticClass:"pagination",attrs:{background:"","current-page":e.currentPage,"page-size":e.pagesize,layout:"prev, pager, next, jumper",total:e.tableData.length},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}})],1)],1)},staticRenderFns:[]},!1,function(e){a("v8rd")},"data-v-0dd8268a",null).exports,it={props:{resultId:{type:String}},components:{Top1000KeysByTypeTable:nt},data:function(){return{activeName:"String"}},methods:{handleClick:function(e,t){}},mounted:function(){}},lt=a("VU/8")(it,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-col",{staticClass:"chart-item"},[a("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[a("div",{staticClass:"text-div"},[a("span",{staticClass:"text-span"},[e._v("Top 1000 Largest Keys By Type")])]),e._v(" "),a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"String",name:"String"}},[a("Top1000KeysByTypeTable",{attrs:{tabKey:"0",resultId:e.resultId}})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"Hash",name:"Hash"}},[a("Top1000KeysByTypeTable",{attrs:{tabKey:"5",resultId:e.resultId}})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"List",name:"List"}},[a("Top1000KeysByTypeTable",{attrs:{tabKey:"10",resultId:e.resultId}})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"Set",name:"Set"}},[a("Top1000KeysByTypeTable",{attrs:{tabKey:"15",resultId:e.resultId}})],1)],1)],1)],1)},staticRenderFns:[]},!1,function(e){a("bUHl")},"data-v-aa3a2d7a",null).exports,ot={props:{tableObj:{type:Object},initData:{type:Function}},data:function(){return{tableData:[],currentPage:1,pagesize:10,pageData:[],search:"",prefix:this.tableObj.searchColumn,length:0}},methods:{initTable:function(){var e=this;return xe()(ke.a.mark(function t(){return ke.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.initData().then(function(t){e.tableData=t.data.map(function(t){return e.tableObj.columns.forEach(function(e){e.sort&&(t[e.prop]=parseInt(t[e.prop]))}),t})});case 2:e.length=e.tableData.length,e.pageData=e.tableData.slice((e.currentPage-1)*e.pagesize,e.currentPage*e.pagesize);case 4:case"end":return t.stop()}},t,e)}))()},searchFilter:function(e){var t=this,a=this.tableData.filter(function(a){return!e||a[""+t.prefix].toLowerCase().includes(e.toLowerCase())});this.length=a.length,this.pageData=a.slice((this.currentPage-1)*this.pagesize,this.currentPage*this.pagesize)},compareValue:function(e,t){return function(a,r){return"ascending"===t?parseInt(a[e])-parseInt(r[e]):parseInt(r[e])-parseInt(a[e])}},sortChange:function(e){e.order&&(this.tableData=this.tableData.sort(this.compareValue(e.prop,e.order)),this.pageData=this.tableData.slice((this.currentPage-1)*this.pagesize,this.currentPage*this.pagesize),this.currentPage=this.currentPage)},handleCurrentChange:function(e){this.currentPage=e,this.pageData=this.tableData.slice((this.currentPage-1)*this.pagesize,this.currentPage*this.pagesize)},formatterCount:function(e,t,a){return We(a)},formatMemory:function(e,t,a){return je(a)}},mounted:function(){this.initTable()}},ut={beforeCreate:function(){document.querySelector("body").setAttribute("style","overflow:auto")},beforeDestroy:function(){document.querySelector("body").removeAttribute("style")},components:{PrefixKeysCount:He,PrefixKeysMemory:Ye,KeyByTypePie:rt,Top1000KeysByType:lt,Tables:a("VU/8")(ot,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-col",{staticClass:"chart-item",attrs:{xl:12,lg:12,md:24,sm:24}},[a("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:this.tableObj.title,expression:"this.tableObj.title"}],staticClass:"text-div"},[a("span",{staticClass:"text-span"},[e._v(e._s(this.tableObj.title))])]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:this.tableObj.searchVis,expression:"this.tableObj.searchVis"}],staticClass:"input"},[a("el-input",{attrs:{size:"small",placeholder:"search"},on:{input:e.searchFilter},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),a("el-table",{attrs:{data:e.pageData},on:{"sort-change":e.sortChange}},e._l(this.tableObj.columns,function(e){return a("el-table-column",{key:e.label,attrs:{"show-overflow-tooltip":e.show_tooltip,"min-width":e.min_width,label:e.label,sortable:e.sort,formatter:e.formatter,prop:e.prop}})}),1),e._v(" "),a("div",[a("el-pagination",{staticClass:"pagination",attrs:{background:"","current-page":e.currentPage,"page-size":e.pagesize,layout:"prev, pager, next, jumper",total:e.length},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}})],1)],1)],1)},staticRenderFns:[]},!1,function(e){a("Z+Fh")},"data-v-96e43418",null).exports},data:function(){return{selectPrefixValue:"",selectOptions:[],isCluster:"",analyseResults:[],name:"",top1000keysPrefix:{columns:[{label:"Prefix",type:"String",prop:"prefixKey",show_tooltip:!0,min_width:"200px"},{label:"Count",sort:!0,prop:"keyCount",type:Number,formatter:this.formatterCount},{label:"Memory Size",sort:!0,prop:"memorySize",type:Number,formatter:this.formatMemory}],searchVis:!0,searchColumn:"prefixKey",title:"Key Prefix Info"},keysTTL:{columns:[{label:"Prefix",prop:"prefix",type:"String",show_tooltip:!0,min_width:"200px"},{label:"TTL",sort:!0,prop:"TTL",type:Number,formatter:this.formatterCount},{label:"noTTL",sort:!0,prop:"noTTL",type:Number,formatter:this.formatterCount}],searchVis:!0,searchColumn:"prefix",title:"Keys TTL Info"},resultId:String(this.$route.query.detailId)}},methods:{backHistory:function(){this.$router.push({name:"jobList"})},dateFormatter:function(e){return y(e.scheduleId)},formatterCount:function(e,t,a){return We(a)},formatMemory:function(e,t,a){return je(a)},initTop1000Keys:function(){return Me("/rdb/table/prefix","GET",{analyzeResultId:this.resultId})},initKeysTTL:function(){return Me("/rdb/chart/TTLAnalyze","GET",{analyzeResultId:this.resultId})}},mounted:function(){var e,t=this,a=this.$route.params.analyzeConfig;if(a){var r=JSON.parse(a);r.nodes&&"-1"!==r.nodes[0]?this.isCluster=!1:(this.isCluster=!0,(e=this.resultId,Pe("/rdb/all/key_prefix","GET",{analyzeResultId:e})).then(function(e){0===e.code?t.selectOptions=e.data:console.error(e.message)}).catch(function(e){console.error(e)}));var s=this.$route.params.clusterName;this.name=s}else this.$router.push({name:"jobList"})},watch:{currentGroup:function(e){this.$router.push({name:"jobList",params:{groupId:e.groupId}})}},computed:{currentGroup:function(){return yt.getters.getCurrentGroup}}},ct=a("VU/8")(ut,{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"analysis"}},[a("el-card",[a("div",[a("el-image",{staticClass:"images",attrs:{src:"../../../static/back.svg"},on:{click:function(t){return e.backHistory()}}}),a("span",{staticStyle:{"margin-left":"30px","font-size":"20px"}},[e._v(e._s(e.name))])],1)]),e._v(" "),a("div",{staticClass:"main-body",staticStyle:{"margin-top":"20px"}},[a("KeyByTypePie",{attrs:{pieType:"count",resultId:e.resultId}}),e._v(" "),a("KeyByTypePie",{attrs:{pieType:"memory",resultId:e.resultId}}),e._v(" "),e.isCluster?a("div",[a("el-col",{staticClass:"chart-item"},[a("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[a("el-select",{attrs:{filterable:"",clearable:"",placeholder:"select key"},model:{value:e.selectPrefixValue,callback:function(t){e.selectPrefixValue=t},expression:"selectPrefixValue"}},e._l(e.selectOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),a("PrefixKeysCount",{attrs:{resultId:e.resultId,selectPrefixValue:e.selectPrefixValue}}),e._v(" "),a("PrefixKeysMemory",{attrs:{resultId:e.resultId,selectPrefixValue:e.selectPrefixValue}})],1):e._e(),e._v(" "),a("Tables",{attrs:{resultId:e.resultId,tableObj:e.top1000keysPrefix,initData:e.initTop1000Keys}}),e._v(" "),a("Tables",{attrs:{resultId:e.resultId,tableObj:e.keysTTL,initData:e.initKeysTTL}}),e._v(" "),a("Top1000KeysByType",{attrs:{resultId:e.resultId}})],1)],1)},staticRenderFns:[]},!1,function(e){a("IAAo")},"data-v-d342860a",null).exports;r.default.use(h.a);var dt=h.a.prototype.push;h.a.prototype.push=function(e){return dt.call(this,e).catch(function(e){return e})};var pt=new h.a({mode:"history",routes:[{path:"/login",name:"login",component:_,hidden:!0},{path:"/",name:"index",component:N,children:[{name:"dashboard",path:"/dashboard/group/:groupId",component:E},{name:"redis-monitor",path:"/redis-monitor/cluster/:clusterId",component:q},{name:"redis-manage",path:"/redis-manage/cluster/:clusterId",component:Q},{name:"installation",path:"/installation/group/:groupId",component:te},{name:"channel-manage",path:"/channel-manage/group/:groupId",component:re},{name:"rule-manage",path:"/rule-manage/group/:groupId",component:ne},{name:"alert-manage",path:"/alert-manage/cluster/:clusterId",component:le},{name:"machine-manage",path:"/machine-manage/group/:groupId",component:ue},{name:"group-manage",path:"/group-manage",component:de},{name:"user-manage",path:"/user-manage/group/:groupId",component:me},{name:"edit-history",path:"/history/group/:groupId",component:Ce},{name:"profile",path:"/profile/:userId",component:ve},{name:"data-operation",path:"/data-operation/group/:groupId",component:ge},{name:"Config",path:"/rct/config",component:Ge},{name:"TaskProgress",path:"/rct/taskProgress/:clusterId",component:Fe},{name:"jobList",path:"/rct/jobList",component:qe},{name:"jobResultDetail",path:"/rct/jobResultDetail",component:ct}]},{path:"/404",component:_e,name:"404",hidden:!0},{path:"*",hidden:!0,redirect:{path:"/404"}}]}),mt=pt;function ft(e,t,a,r,s){l()({method:e,url:t,headers:{UserIp:yt.getters.getUserIp},data:"POST"===e||"PUT"===e?a:null,params:"GET"===e||"DELETE"===e?a:null}).then(function(e){r(e)}).catch(function(e){!e.response||401!==e.response.code&&404!==e.response.status?s(e):(v.warning("user infomation has expried,please login!"),mt.push({name:"login"}))})}pt.beforeEach(function(e,t,a){var r=yt.getters.getUser,s=e.path;if("/login"!==s&&(o(r)||o(r.userId)||o(r.userName)||o(r.userRole))){var n=e.query.code;if(o(n))a({path:"login"});else{var i="/user/oauth2Login?code="+n;vt.get(i,null,function(e){var t=e.data;0===t.code?(yt.dispatch("setUser",t.data),a()):a({path:"login"})},function(){a({path:"login"})})}}else 1===r.userRole&&s.indexOf("group-manage")>0?a({name:"dashboard",params:{groupId:yt.getters.getCurrentGroup.groupId}}):2===r.userRole&&(s.indexOf("group-manage")>0||s.indexOf("user-manage")>0||s.indexOf("machine-manage")>0||s.indexOf("installation")>0||s.indexOf("channel-manage")>0||s.indexOf("rule-manage")>0||s.indexOf("redis-manage")>0||s.indexOf("alert-manage")>0||s.indexOf("edit-history")>0)?a({name:"dashboard",params:{groupId:yt.getters.getCurrentGroup.groupId}}):a()});var vt={get:function(e,t,a,r){return ft("GET",e,t,a,r)},post:function(e,t,a,r){return ft("POST",e,t,a,r)},put:function(e,t,a,r){return ft("PUT",e,t,a,r)},delete:function(e,t,a,r){return ft("DELETE",e,t,a,r)}},ht=a("lbHh");r.default.use(s.a);var gt={currentGroup:{},groupList:[],user:{userRole:2},installationEnvironmentList:[],authorization:{},userIp:""},bt={setCurrentGroup:function(e,t){(function(e,t){if(!o(e)&&!o(t)){var a={groupId:e,userId:t};vt.post("/user/getUserRole/",a,function(e){var t=e.data.data;gt.user.userRole=t},function(){gt.user.userRole=2})}})(t.groupId,e.user.userId),e.currentGroup=t},setGroupList:function(e,t){e.groupList=t},setUser:function(e,t){e.user=t},setUserRole:function(e,t){e.user.userRole=t},setInstallationEnvironmentList:function(e,t){e.installationEnvironmentList=t},setAuthorization:function(e,t){e.authorization=t},setUserIp:function(e,t){e.userIp=t}},_t={setCurrentGroup:function(e,t){e.commit("setCurrentGroup",t)},setGroupList:function(e,t){e.commit("setGroupList",t)},setUser:function(e,t){var a=t.avatar;o("")||o(a)||a.startsWith("")||a.startsWith("http")||(t.avatar=""+a),e.commit("setUser",t)},setUserRole:function(e,t){e.commit("setUserRole",t)},setInstallationEnvironmentList:function(e,t){e.commit("setInstallationEnvironmentList",t)},setAuthorization:function(e,t){e.commit("setAuthorization",t)},setUserIp:function(e,t){e.commit("setUserIp",t)}},yt=new s.a.Store({state:gt,getters:{getCurrentGroup:function(e){return e.currentGroup},getGroupList:function(e){return e.groupList},getUser:function(e){return e.user},getUserId:function(e){return e.user.userId},getUserRole:function(e){return e.user.userRole},getInstallationEnvironmentList:function(e){return e.installationEnvironmentList},getAuthorization:function(e){return e.authorization},getUserIp:function(e){return e.userIp}},actions:_t,mutations:bt,plugins:[Object(n.a)({storage:{getItem:function(e){return ht.get(e)},setItem:function(e,t){return ht.set(e,t,{expires:1})},removeItem:function(e){return ht.remove(e)}},reducer:function(e){return{user:e.user,currentGroup:e.currentGroup,groupList:e.groupList}}})]});var Ct={name:"App",methods:{getInstallationEnvironmentList:function(){vt.get("/system/getInstallationEnvironment",null,function(e){var t=[];e.data.data.forEach(function(e){var a="";0==e?a="Docker":1==e?a="Machine":3==e&&(a="Humpback"),o(a)||t.push({type:e,name:a})}),yt.dispatch("setInstallationEnvironmentList",t)},function(e){v.error("Get installation environment failed")})}},mounted:function(){this.getInstallationEnvironmentList()}},wt=a("VU/8")(Ct,{render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("transition",{attrs:{name:"fade",mode:"out-in"}},[t("router-view")],1)],1)},staticRenderFns:[]},!1,function(e){a("MQwG")},null,null).exports,kt=a("wUZ8"),It=a.n(kt);a("tvR6"),a("Xcu2"),a("7xIN"),r.default.use(m.a,{locale:It.a}),r.default.config.productionTip=!1,r.default.prototype.$axios=l.a,l.a.defaults.headers.post["Content-Type"]="application/json;charset=UTF-8",l.a.defaults.baseURL="",l.a.defaults.TIMEOUT=3e5,new r.default({el:"#app",vuex:s.a,router:mt,components:{App:wt},template:"<App/>"})},OFz5:function(e,t){},OQxI:function(e,t){},PsxY:function(e,t){},Qgiq:function(e,t){},TMx1:function(e,t){},V3UU:function(e,t){},V7r3:function(e,t){},VG2S:function(e,t){},Xcu2:function(e,t){},"Z+Fh":function(e,t){},Zili:function(e,t){},bUHl:function(e,t){},bY86:function(e,t){},bY8h:function(e,t){},"cf+J":function(e,t,a){e.exports=a.p+"static/img/background.f7a455c.png"},dqEZ:function(e,t){},ejuE:function(e,t){},gSgD:function(e,t){},kBQB:function(e,t){},kjmf:function(e,t){},"lPf+":function(e,t){},nLbs:function(e,t){},nhBv:function(e,t,a){e.exports=a.p+"static/img/redis-manager.e22ccc2.png"},rA2g:function(e,t){},tvR6:function(e,t){},v8rd:function(e,t){},yWEk:function(e,t){},zP2M:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.5dc9befa69bddf725751.js.map